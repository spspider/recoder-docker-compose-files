[
    {
        "id": "65bf31c16d103884",
        "type": "tab",
        "label": "my_room",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "8ee561e21c0a30f6",
        "type": "tab",
        "label": "bine cu apa",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "a69381581f637ec6",
        "type": "tab",
        "label": "roof",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "6f216e4069410c84",
        "type": "tab",
        "label": "Kitchen",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "47e2824120b2a9e0",
        "type": "tab",
        "label": "camera",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "d2d769b0.c57da8",
        "type": "tab",
        "label": "Telegram",
        "disabled": false,
        "info": ""
    },
    {
        "id": "ca3d3fb4de74fc4f",
        "type": "tab",
        "label": "Camera-DVR",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "d10b6744b70a9f6d",
        "type": "tab",
        "label": "AIChat",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "81965ae3.dd08a8",
        "type": "tab",
        "label": "Main",
        "disabled": true,
        "info": ""
    },
    {
        "id": "d8baf37f.71552",
        "type": "tab",
        "label": "EntranceDoor",
        "disabled": false,
        "info": ""
    },
    {
        "id": "28839e10.005852",
        "type": "tab",
        "label": "Balcony",
        "disabled": true,
        "info": ""
    },
    {
        "id": "c22de8d6.aec338",
        "type": "tab",
        "label": "Bathroom",
        "disabled": true,
        "info": ""
    },
    {
        "id": "a5eb6fcc.fc0cb",
        "type": "tab",
        "label": "fan",
        "disabled": true,
        "info": ""
    },
    {
        "id": "af702991.bdca58",
        "type": "tab",
        "label": "reload all",
        "disabled": false,
        "info": ""
    },
    {
        "id": "772e6979.67cd08",
        "type": "tab",
        "label": "System"
    },
    {
        "id": "86d9b15ce96130b5",
        "type": "tab",
        "label": "Examples",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "1",
        "type": "tab",
        "label": "Audio Stream",
        "disabled": false,
        "info": ""
    },
    {
        "id": "e9df3544.ca85a8",
        "type": "ui_base",
        "theme": {
            "name": "theme-dark",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "reset": false
            },
            "themeState": {
                "base-color": {
                    "default": "#097479",
                    "value": "#097479",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#097479",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#111111",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#333333",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#0eb8c0",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#555555",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#333333",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#eeeeee",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#097479",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#333333",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "9543e72b.76c248",
        "type": "ui_tab",
        "name": "Ванна",
        "icon": "dashboard",
        "order": 3,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "4c91d370.525c2c",
        "type": "ui_tab",
        "name": "двери",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "6db9f969.6989a8",
        "type": "ui_tab",
        "name": "Квартира",
        "icon": "dashboard",
        "order": 2,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "ca786bad.5ac7a8",
        "type": "telegram bot",
        "botname": "node_red_home_bot_bot",
        "usernames": "",
        "chatids": "",
        "baseapiurl": "",
        "testenvironment": false,
        "updatemode": "polling",
        "pollinterval": "300",
        "usesocks": false,
        "sockshost": "",
        "socksport": "6667",
        "socksusername": "anonymous",
        "sockspassword": "",
        "bothost": "",
        "botpath": "",
        "localbotport": "8443",
        "publicbotport": "8443",
        "privatekey": "",
        "certificate": "",
        "useselfsignedcertificate": false,
        "sslterminated": false,
        "verboselogging": false
    },
    {
        "id": "cad186fc.6717b8",
        "type": "ui_group",
        "name": "Ванна2",
        "tab": "9543e72b.76c248",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "4a84c495.0fce7c",
        "type": "ui_group",
        "name": "двери2",
        "tab": "4c91d370.525c2c",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "6a1fd3d5.2b832c",
        "type": "ui_group",
        "name": "двери3",
        "tab": "4c91d370.525c2c",
        "order": 3,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "7caf40b8.ebe01",
        "type": "ui_group",
        "name": "баклон2",
        "tab": "6db9f969.6989a8",
        "order": 3,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "6e18ecf1.e2d0c4",
        "type": "ui_tab",
        "name": "Computer",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "ce3b49b9.4b9e18",
        "type": "ui_group",
        "name": "Computer",
        "tab": "6e18ecf1.e2d0c4",
        "order": 1,
        "disp": true,
        "width": "12",
        "collapse": false
    },
    {
        "id": "fc599eb8.f87e",
        "type": "ui_group",
        "name": "TCPU-diff",
        "tab": "6e18ecf1.e2d0c4",
        "order": 2,
        "disp": true,
        "width": "12",
        "collapse": false
    },
    {
        "id": "4b290438.730fbc",
        "type": "ui_group",
        "name": "двери",
        "tab": "4c91d370.525c2c",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "650233e5.37ad3c",
        "type": "ui_group",
        "name": "Балкон",
        "tab": "6db9f969.6989a8",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "6ed8da82.791bd4",
        "type": "ui_group",
        "name": "Теплый пол",
        "tab": "6db9f969.6989a8",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "7db79158682fc8ec",
        "type": "ui_tab",
        "name": "MyRoom",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "d933d053d66f5444",
        "type": "ui_group",
        "name": "Room",
        "tab": "7db79158682fc8ec",
        "order": 1,
        "disp": true,
        "width": 6,
        "collapse": false,
        "className": ""
    },
    {
        "id": "a7804332c06e238f",
        "type": "mqtt-broker",
        "name": "mqtthivemq",
        "broker": "177e3ee7cf004e6ebed04b25d4c51a26.s1.eu.hivemq.cloud",
        "port": "8883",
        "tls": "",
        "clientid": "node-red-amd",
        "autoConnect": true,
        "usetls": true,
        "protocolVersion": 4,
        "keepalive": 60,
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "e6013c6f.69328",
        "type": "ui_tab",
        "name": "System",
        "icon": "computer"
    },
    {
        "id": "7853403.230cdc",
        "type": "ui_group",
        "name": "CPU Load",
        "tab": "e6013c6f.69328",
        "order": 2,
        "disp": true,
        "width": "6"
    },
    {
        "id": "1d1da0fc.6ab84f",
        "type": "ui_group",
        "name": "Memory",
        "tab": "e6013c6f.69328",
        "order": 3,
        "disp": true,
        "width": "6"
    },
    {
        "id": "a9912d64.97094",
        "type": "ui_group",
        "name": "System Information",
        "tab": "e6013c6f.69328",
        "order": 1,
        "disp": true,
        "width": "6"
    },
    {
        "id": "1d2608aa5cac07fa",
        "type": "ui_group",
        "name": "Roof",
        "tab": "7db79158682fc8ec",
        "order": 2,
        "disp": true,
        "width": 6,
        "collapse": false,
        "className": ""
    },
    {
        "id": "170adc9ec64f9f80",
        "type": "telegram bot",
        "botname": "alinka_telegram_bot",
        "usernames": "",
        "chatids": "",
        "baseapiurl": "",
        "testenvironment": false,
        "updatemode": "polling",
        "pollinterval": 300,
        "usesocks": false,
        "sockshost": "",
        "socksprotocol": "socks5",
        "socksport": 6667,
        "socksusername": "anonymous",
        "sockspassword": "",
        "bothost": "",
        "botpath": "",
        "localbotport": 8443,
        "publicbotport": 8443,
        "privatekey": "",
        "certificate": "",
        "useselfsignedcertificate": false,
        "sslterminated": false,
        "verboselogging": false
    },
    {
        "id": "f027919d2a75152b",
        "type": "ui_group",
        "name": "room",
        "tab": "7db79158682fc8ec",
        "order": 3,
        "disp": true,
        "width": 6,
        "collapse": false,
        "className": ""
    },
    {
        "id": "c891fa983d6dd35e",
        "type": "ui_tab",
        "name": "Kitchen",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "b77886c396feb2d9",
        "type": "ui_group",
        "name": "Heater",
        "tab": "c891fa983d6dd35e",
        "order": 1,
        "disp": true,
        "width": 6,
        "collapse": false,
        "className": ""
    },
    {
        "id": "4f355165578101f1",
        "type": "ui_tab",
        "name": "Afara",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "5db072261e302c51",
        "type": "ui_group",
        "name": "well",
        "tab": "4f355165578101f1",
        "order": 1,
        "disp": true,
        "width": 6,
        "collapse": false,
        "className": ""
    },
    {
        "id": "8818288d473df902",
        "type": "influxdb",
        "hostname": "influxdb",
        "port": 8086,
        "protocol": "http",
        "database": "smart_home",
        "name": "",
        "usetls": false,
        "tls": "",
        "influxdbVersion": "1.x",
        "url": "http://localhost:8086",
        "timeout": 10,
        "rejectUnauthorized": true
    },
    {
        "id": "e1eafc56a30f1862",
        "type": "function",
        "z": "65bf31c16d103884",
        "name": "myroom",
        "func": "function setStoredValue(objectValue) {\n    var storedValues = global.get(\"storedValues\") || {}; // Retrieve existing data or initialize an empty object\n    var parameterName = objectValue.name; // Example: \"Curtain in my room switch up\"\n    var parameterNumber = objectValue.topic; // Example: 0\n    var parameterValue = objectValue.payload; // Example: 100\n    // If the entry already exists, update only the payload\n    if (storedValues.hasOwnProperty(parameterName)) {\n        storedValues[parameterName].payload = parameterValue;\n    } else {\n        // Otherwise, create a new entry\n        storedValues[parameterName] = {\n            topic: parameterNumber,\n            payload: parameterValue\n        };\n    }\n    global.set(\"storedValues\", storedValues); // Save back to global context\n    return null; // No output needed\n}\n\nvar name = {}\nname[0] = \"Curtain room switch up example:{\\\"curain_up\\\":\\\"0\\\"}\"\nname[1] = \"Curtain in my room switch down example:{\\\"curain_down\\\":\\\"0\\\"}\"\nname[2] = \"light in backyard\"\nname[3] = \"light in my room slider from 0 to 50\"\nname[4] = \"light in my room powerful\"\nname[5] = \"temp in my room\"\nname[6] = \"light Night powerful\"\n\nvar topicObjects = [];\nvar parsed = (msg.payload);\nvar topic = (msg.topic)\nvar  outputCount_number = node.outputCount\nif (topic == \"initial\") {\n    for (var i = 0; i < parsed.stat.length; i++) {\n        var topicObject = {\n            payload: parseFloat(parsed.stat[i]),\n            topic: i,\n            name: name[i]\n        };\n        setStoredValue(topicObject);\n        topicObjects.push(topicObject);\n    }\n    return topicObjects;\n}\nelse {// topic is not initial\n    for (var i = 0; i < outputCount_number; i++) {\n        if (i == parseInt(topic)) {\n            topicObject = {\n                payload: parseInt(parsed),\n                topic: parseInt(topic),\n                name: name[i]\n            }\n            setStoredValue(topicObject);\n            topicObjects.push(topicObject);\n        };\n        topicObjects.push(null);\n    }\n    return topicObjects;\n} \n\n",
        "outputs": 7,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 280,
        "wires": [
            [
                "b45d60b7e981e616"
            ],
            [
                "6995750bd463cad0"
            ],
            [
                "7f436f8ca4c71427"
            ],
            [
                "dde3ab414f281068"
            ],
            [
                "a48233ad1ad88800"
            ],
            [
                "a5d85328c784360f"
            ],
            [
                "f8a9809c8cd54691"
            ]
        ]
    },
    {
        "id": "10c5484d040931b8",
        "type": "inject",
        "z": "65bf31c16d103884",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "120",
        "crontab": "",
        "once": true,
        "onceDelay": "10",
        "topic": "initial",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 280,
        "wires": [
            [
                "72bb3936b01bf837"
            ]
        ]
    },
    {
        "id": "d6b6998323b52267",
        "type": "http request",
        "z": "65bf31c16d103884",
        "name": "myroom",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 520,
        "y": 280,
        "wires": [
            [
                "e1eafc56a30f1862",
                "89bba9a35c4a3784",
                "fccacc261f6084fc"
            ]
        ]
    },
    {
        "id": "b45d60b7e981e616",
        "type": "ui_switch",
        "z": "65bf31c16d103884",
        "name": "curtainUp",
        "label": "curtain Up",
        "tooltip": "",
        "group": "f027919d2a75152b",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "0",
        "topicType": "str",
        "style": "",
        "onvalue": "0",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 880,
        "y": 200,
        "wires": [
            [
                "8a2e1486aafc8c18"
            ]
        ]
    },
    {
        "id": "6995750bd463cad0",
        "type": "ui_switch",
        "z": "65bf31c16d103884",
        "name": "curtainDown",
        "label": "curtain Down",
        "tooltip": "",
        "group": "f027919d2a75152b",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "1",
        "topicType": "str",
        "style": "",
        "onvalue": "0",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 890,
        "y": 240,
        "wires": [
            [
                "9929503dd4e66aa4"
            ]
        ]
    },
    {
        "id": "3e96ad22e502c317",
        "type": "http request",
        "z": "65bf31c16d103884",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1550,
        "y": 240,
        "wires": [
            [
                "9eb949a941dbc63b"
            ]
        ]
    },
    {
        "id": "7f436f8ca4c71427",
        "type": "ui_switch",
        "z": "65bf31c16d103884",
        "name": "Light backyard",
        "label": "Light backyard",
        "tooltip": "",
        "group": "d933d053d66f5444",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "2",
        "topicType": "str",
        "style": "",
        "onvalue": "0",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 900,
        "y": 280,
        "wires": [
            [
                "db9de5c8ae2b786e"
            ]
        ]
    },
    {
        "id": "e8446166ae58b128",
        "type": "rbe",
        "z": "65bf31c16d103884",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 1050,
        "y": 320,
        "wires": [
            [
                "680b5ec7fd0f4487"
            ]
        ]
    },
    {
        "id": "a48233ad1ad88800",
        "type": "ui_switch",
        "z": "65bf31c16d103884",
        "name": "power Light",
        "label": "power Light",
        "tooltip": "",
        "group": "d933d053d66f5444",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "4",
        "topicType": "str",
        "style": "",
        "onvalue": "0",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 890,
        "y": 360,
        "wires": [
            [
                "3f1d4ec111668b15"
            ]
        ]
    },
    {
        "id": "3f1d4ec111668b15",
        "type": "rbe",
        "z": "65bf31c16d103884",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 1050,
        "y": 360,
        "wires": [
            [
                "680b5ec7fd0f4487"
            ]
        ]
    },
    {
        "id": "9929503dd4e66aa4",
        "type": "rbe",
        "z": "65bf31c16d103884",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 1030,
        "y": 240,
        "wires": [
            [
                "842067f3ca74b50a",
                "680b5ec7fd0f4487"
            ]
        ]
    },
    {
        "id": "8a2e1486aafc8c18",
        "type": "rbe",
        "z": "65bf31c16d103884",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 1030,
        "y": 200,
        "wires": [
            [
                "842067f3ca74b50a",
                "680b5ec7fd0f4487"
            ]
        ]
    },
    {
        "id": "dde3ab414f281068",
        "type": "ui_slider",
        "z": "65bf31c16d103884",
        "name": "",
        "label": "slider",
        "tooltip": "",
        "group": "d933d053d66f5444",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "3",
        "topicType": "str",
        "min": 0,
        "max": "200",
        "step": 1,
        "className": "",
        "x": 890,
        "y": 320,
        "wires": [
            [
                "e8446166ae58b128"
            ]
        ]
    },
    {
        "id": "db9de5c8ae2b786e",
        "type": "rbe",
        "z": "65bf31c16d103884",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 1050,
        "y": 280,
        "wires": [
            [
                "680b5ec7fd0f4487"
            ]
        ]
    },
    {
        "id": "fa7f17f0960f9899",
        "type": "mqtt in",
        "z": "65bf31c16d103884",
        "name": "mqtt-messages",
        "topic": "",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "a7804332c06e238f",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 540,
        "y": 560,
        "wires": [
            [
                "329027747ad8fbdf"
            ]
        ]
    },
    {
        "id": "067d0297fdf0092b",
        "type": "mqtt out",
        "z": "65bf31c16d103884",
        "name": "",
        "topic": "",
        "qos": "0",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "a7804332c06e238f",
        "x": 1900,
        "y": 560,
        "wires": []
    },
    {
        "id": "75c151df5906ff28",
        "type": "function",
        "z": "65bf31c16d103884",
        "name": "subscribe",
        "func": "var subcsciptionLoop = []\nlet otherSetup = flow.get(\"OtherSetup\");\n\nfor (var i = 0; i < 7; i++) {\n    var subscriptionVar = {\n        action: \"subscribe\",\n        topic: \"node-red/\" + otherSetup.deviceID + \"/control/\" + i\n    }\n    subcsciptionLoop.push(subscriptionVar);\n}\nreturn [subcsciptionLoop];",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 560,
        "wires": [
            [
                "fa7f17f0960f9899"
            ]
        ]
    },
    {
        "id": "4de5acada9816682",
        "type": "inject",
        "z": "65bf31c16d103884",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "10",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 560,
        "wires": [
            [
                "75c151df5906ff28"
            ]
        ]
    },
    {
        "id": "329027747ad8fbdf",
        "type": "function",
        "z": "65bf31c16d103884",
        "name": "decoder",
        "func": "var topicIn = msg.topic; //node-red/room/control/0\nvar parts = topicIn.split('/');\nvar lastPart = parts[parts.length - 1];\nvar number = parseInt(lastPart, 10);\n\nmsg.topic = number;\nmsg.payload = msg.payload;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 560,
        "wires": [
            [
                "e1eafc56a30f1862"
            ]
        ]
    },
    {
        "id": "9eb949a941dbc63b",
        "type": "function",
        "z": "65bf31c16d103884",
        "name": "encoder node-red/<deviceID>/{{topic}}",
        "func": "let otherSetup = flow.get(\"OtherSetup\");\nmsg.topic = \"node-red/\" + otherSetup.deviceID + \"/\" + msg.topic;\nmsg.qos = 0;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1650,
        "y": 560,
        "wires": [
            [
                "067d0297fdf0092b"
            ]
        ]
    },
    {
        "id": "7e31b05aed36e8da",
        "type": "ui_chart",
        "z": "65bf31c16d103884",
        "name": "",
        "group": "f027919d2a75152b",
        "order": 7,
        "width": 0,
        "height": 0,
        "label": "temp",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "86400",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 1190,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "842067f3ca74b50a",
        "type": "delay",
        "z": "65bf31c16d103884",
        "d": true,
        "name": "",
        "pauseType": "delay",
        "timeout": "35",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1260,
        "y": 200,
        "wires": [
            [
                "94997020bfecbf87"
            ]
        ]
    },
    {
        "id": "94997020bfecbf87",
        "type": "function",
        "z": "65bf31c16d103884",
        "d": true,
        "name": "msg payload = 1",
        "func": "msg.payload = 1;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 140,
        "wires": [
            [
                "6995750bd463cad0",
                "b45d60b7e981e616"
            ]
        ]
    },
    {
        "id": "a5d85328c784360f",
        "type": "function",
        "z": "65bf31c16d103884",
        "name": "set topic and payload filter",
        "func": "if (msg.payload > 60){\n    return null;\n}\nmsg.topic = 5;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 480,
        "wires": [
            [
                "7e31b05aed36e8da"
            ]
        ]
    },
    {
        "id": "f8a9809c8cd54691",
        "type": "ui_slider",
        "z": "65bf31c16d103884",
        "name": "power Night Light",
        "label": "power Night Light",
        "tooltip": "",
        "group": "d933d053d66f5444",
        "order": 9,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "6",
        "topicType": "str",
        "min": 0,
        "max": "256",
        "step": 1,
        "className": "",
        "x": 910,
        "y": 400,
        "wires": [
            [
                "0fd075e9f7ca29d0"
            ]
        ]
    },
    {
        "id": "0fd075e9f7ca29d0",
        "type": "rbe",
        "z": "65bf31c16d103884",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 1070,
        "y": 400,
        "wires": [
            [
                "680b5ec7fd0f4487"
            ]
        ]
    },
    {
        "id": "15db536cf6e755fa",
        "type": "http in",
        "z": "65bf31c16d103884",
        "name": "",
        "url": "/ir",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 500,
        "wires": [
            [
                "c5fa60a3915d5189",
                "737a66def327bbb0"
            ]
        ]
    },
    {
        "id": "c5fa60a3915d5189",
        "type": "function",
        "z": "65bf31c16d103884",
        "name": "message",
        "func": "// Define an object with code mappings to topic and payload\nconst codeMappings = {\n    \"20DF4EB1\": { topic: 6, payload: 0 },\n    \"20DF8E71\": { topic: 6, payload: 10 },\n    \"20DFC639\": { topic: 6, payload: 100 },\n    \"20DF8679\": { topic: 6, payload: 300 },\n    \"20DFF10E\": { topic: 4, payload: 0 },\n    \"20DF0DF2\": { topic: 4, payload: 1 },\n    \"20DF5DA2\": { topic: 3, payload: 0 },\n    \"20DF718E\": { topic: 3, payload: 20 },\n    // Add more mappings as needed\n};\n\n// Get the mapping for the given code\nconst mapping = codeMappings[msg.payload.code] || { topic: 0, payload: \"unknown\" };\n\n// Set the topic and payload based on the mapping\nmsg.topic = mapping.topic;\nmsg.payload = mapping.payload;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 500,
        "wires": [
            [
                "e1eafc56a30f1862"
            ]
        ]
    },
    {
        "id": "737a66def327bbb0",
        "type": "http response",
        "z": "65bf31c16d103884",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 300,
        "y": 440,
        "wires": []
    },
    {
        "id": "89bba9a35c4a3784",
        "type": "function",
        "z": "65bf31c16d103884",
        "name": "convert to inno DB",
        "func": "// Получение данных\nlet data = msg.payload;\nlet stat = data.stat.map(parseFloat);  // Преобразуем все строки в float\nlet otherSetup = flow.get(\"OtherSetup\");\n\nif (otherSetup === undefined) {\n    return msg;\n}\n\n// Получение описаний из контекста\nlet descr = flow.get(\"pinDescr\") || [];\n\n// Подготовка полей\nlet fields = {};\n\nfor (let i = 0; i < stat.length; i++) {\n    let rawName = descr[i] || (\"pin_\" + i); // если нет имени, используем pin_0, pin_1 и т.д.\n    let cleanName = rawName.toString().replace(/\\s+/g, \"_\").replace(/[^\\w]/g, \"_\"); // удаляем пробелы и спецсимволы\n    fields[cleanName] = stat[i]; // Присваиваем значение\n}\n\n// Итоговое сообщение\nmsg.payload = [\n    {\n        measurement: otherSetup.deviceID,  // имя измерения — можешь изменить\n        fields: fields,\n        tags: {\n            location: otherSetup.deviceID\n        },\n        timestamp: new Date()\n    }\n];\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 620,
        "wires": [
            [
                "aced5d5dc767001f"
            ]
        ]
    },
    {
        "id": "0a6efcf104f32b87",
        "type": "inject",
        "z": "65bf31c16d103884",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 40,
        "wires": [
            [
                "0abaa6401bfcd92f"
            ]
        ]
    },
    {
        "id": "7826811d42a41158",
        "type": "http request",
        "z": "65bf31c16d103884",
        "name": "myroom",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 600,
        "y": 40,
        "wires": [
            [
                "f880076bcb5f8b83"
            ]
        ]
    },
    {
        "id": "f880076bcb5f8b83",
        "type": "function",
        "z": "65bf31c16d103884",
        "name": "pinDescription",
        "func": "flow.set(\"pinDescr\", msg.payload.descr);\nmsg.url = \"http://\"+flow.get(\"ip\")+\"/other_setup.txt\"\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 40,
        "wires": [
            [
                "d9e327325d06ccd5"
            ]
        ]
    },
    {
        "id": "aced5d5dc767001f",
        "type": "influxdb batch",
        "z": "65bf31c16d103884",
        "influxdb": "8818288d473df902",
        "precision": "",
        "retentionPolicy": "",
        "name": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "organisation",
        "bucket": "bucket",
        "x": 1330,
        "y": 620,
        "wires": []
    },
    {
        "id": "d9e327325d06ccd5",
        "type": "http request",
        "z": "65bf31c16d103884",
        "name": "get",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 970,
        "y": 40,
        "wires": [
            [
                "754d901ddd4e4f90"
            ]
        ]
    },
    {
        "id": "754d901ddd4e4f90",
        "type": "function",
        "z": "65bf31c16d103884",
        "name": "Other setup",
        "func": "flow.set(\"OtherSetup\", msg.payload); // сохраняем только descr[]\nreturn null; // ничего не передаём дальше\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "0abaa6401bfcd92f",
        "type": "function",
        "z": "65bf31c16d103884",
        "name": "set IP address and name",
        "func": "flow.set(\"ip\", \"192.168.1.150\"); \nmsg.url = \"http://\"+flow.get(\"ip\")+\"/pin_setup.txt\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 40,
        "wires": [
            [
                "7826811d42a41158"
            ]
        ]
    },
    {
        "id": "72bb3936b01bf837",
        "type": "function",
        "z": "65bf31c16d103884",
        "name": "getIP",
        "func": "msg.url = \"http://\"+flow.get(\"ip\")+\"/sendAJAX?json={t:127,v:0}\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 280,
        "wires": [
            [
                "d6b6998323b52267"
            ]
        ]
    },
    {
        "id": "680b5ec7fd0f4487",
        "type": "function",
        "z": "65bf31c16d103884",
        "name": "set URL",
        "func": "msg.url = \"http://\" + flow.get(\"ip\") + \"/sendAJAX?json={t:\" + msg.topic + \",v:\" + msg.payload + \"}\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1360,
        "y": 240,
        "wires": [
            [
                "3e96ad22e502c317"
            ]
        ]
    },
    {
        "id": "80ac29eafd1641c6",
        "type": "function",
        "z": "65bf31c16d103884",
        "name": "convert to inno DB",
        "func": "let data = msg.payload;\nlet otherSetup = flow.get(\"OtherSetup\");\n\nif (otherSetup === undefined || typeof data !== \"object\" || data === null || Array.isArray(data)) {\n    node.warn(\"Неверный формат данных: ожидался объект, а не массив.\");\n    return null;\n}\n\nlet fields = {};\n\nfor (let key in data) {\n    // Отфильтровываем ключи, которые выглядят как чистые числа (например, \"0\", \"1\", и т.п.)\n    if (/^\\d+$/.test(key)) {\n        node.warn(\"Пропущен числовой ключ: \" + key);\n        continue;\n    }\n\n    let value = data[key];\n\n    // Очистка ключа\n    let cleanKey = key.toString().replace(/\\s+/g, \"_\").replace(/[^\\w]/g, \"_\");\n\n    // Типизация значений\n    if (typeof value === \"number\") {\n        fields[cleanKey] = value;\n    } else if (typeof value === \"string\") {\n        fields[cleanKey] = value.toString().replace(/\\s+/g, \"_\").replace(/[^\\w\\.\\-]/g, \"_\");\n    } else {\n        fields[cleanKey] = JSON.stringify(value);\n    }\n}\n\nmsg.payload = [\n    {\n        measurement: otherSetup.deviceID + \"_system\",\n        fields: fields,\n        tags: {\n            location: otherSetup.deviceID + \"_system\"\n        },\n        timestamp: new Date()\n    }\n];\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 700,
        "wires": [
            [
                "fb85e5f794574fa3"
            ]
        ]
    },
    {
        "id": "fb85e5f794574fa3",
        "type": "influxdb batch",
        "z": "65bf31c16d103884",
        "influxdb": "8818288d473df902",
        "precision": "",
        "retentionPolicy": "",
        "name": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "organisation",
        "bucket": "bucket",
        "x": 1330,
        "y": 700,
        "wires": []
    },
    {
        "id": "10a6564e966b7f18",
        "type": "http request",
        "z": "65bf31c16d103884",
        "name": "wifi-all",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 810,
        "y": 700,
        "wires": [
            [
                "80ac29eafd1641c6"
            ]
        ]
    },
    {
        "id": "fccacc261f6084fc",
        "type": "function",
        "z": "65bf31c16d103884",
        "name": "getIP",
        "func": "msg.url = \"http://\"+flow.get(\"ip\")+\"/all\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 700,
        "wires": [
            [
                "10a6564e966b7f18"
            ]
        ]
    },
    {
        "id": "0556346d05a00c85",
        "type": "function",
        "z": "8ee561e21c0a30f6",
        "name": "bine",
        "func": "\nvar topicObjects = [];\nvar parsed = (msg.payload);\nvar topic = (msg.topic)\nvar  outputCount_number = node.outputCount\nif (topic == \"initial\") {\n    for (var i = 0; i < parsed.stat.length; i++) {\n        var topicObject = {\n            payload: parseFloat(parsed.stat[i]),\n            topic: i,\n        };\n        topicObjects.push(topicObject);\n    }\n    return topicObjects;\n}\nelse {// topic is not initial\n    for (var i = 0; i < outputCount_number; i++) {\n        if (i == parseInt(topic)) {\n            topicObject = {\n                payload: parseInt(parsed),\n                topic: parseInt(topic),\n            }\n            topicObjects.push(topicObject);\n        };\n        topicObjects.push(null);\n    }\n    return topicObjects;\n} \n\n",
        "outputs": 10,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 240,
        "wires": [
            [],
            [],
            [],
            [],
            [],
            [
                "f0bff3ed08479aa2"
            ],
            [
                "fea2179dfe918dfb"
            ],
            [
                "0aa4cd3f64a0886b"
            ],
            [
                "0b0e7b5e639196c5"
            ],
            [
                "779e20ca1ece3683"
            ]
        ]
    },
    {
        "id": "736d4b87e5b174b1",
        "type": "inject",
        "z": "8ee561e21c0a30f6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "120",
        "crontab": "",
        "once": true,
        "onceDelay": "10",
        "topic": "initial",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 240,
        "wires": [
            [
                "c086e1307c764e66"
            ]
        ]
    },
    {
        "id": "c086e1307c764e66",
        "type": "http request",
        "z": "8ee561e21c0a30f6",
        "name": "bine",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "192.168.1.153/sendAJAX?json={%22t%22:127,%22v%22:0}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 410,
        "y": 240,
        "wires": [
            [
                "0556346d05a00c85",
                "d915c51c93f0dc5c",
                "a303f6faaa5b8736"
            ]
        ]
    },
    {
        "id": "f0bff3ed08479aa2",
        "type": "ui_switch",
        "z": "8ee561e21c0a30f6",
        "name": "",
        "label": "switch1",
        "tooltip": "",
        "group": "5db072261e302c51",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "5",
        "topicType": "str",
        "style": "",
        "onvalue": "1",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "0",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 780,
        "y": 120,
        "wires": [
            [
                "dbbc30b078185b19"
            ]
        ]
    },
    {
        "id": "cbb21692f599eebe",
        "type": "ui_switch",
        "z": "8ee561e21c0a30f6",
        "name": "",
        "label": "switch2",
        "tooltip": "",
        "group": "5db072261e302c51",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "6",
        "topicType": "str",
        "style": "",
        "onvalue": "1",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "0",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 920,
        "y": 180,
        "wires": [
            [
                "2a88f0642cf44aa6",
                "c4b19581c2b36d16"
            ]
        ]
    },
    {
        "id": "255b7b92a1e2f811",
        "type": "http request",
        "z": "8ee561e21c0a30f6",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://192.168.1.153/sendAJAX?json={%22t%22:{{topic}},%22v%22:{{payload}}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1410,
        "y": 260,
        "wires": [
            [
                "d310abc6f163d5e7"
            ]
        ]
    },
    {
        "id": "2a88f0642cf44aa6",
        "type": "rbe",
        "z": "8ee561e21c0a30f6",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 1070,
        "y": 180,
        "wires": [
            [
                "255b7b92a1e2f811"
            ]
        ]
    },
    {
        "id": "dbbc30b078185b19",
        "type": "rbe",
        "z": "8ee561e21c0a30f6",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 930,
        "y": 120,
        "wires": [
            [
                "255b7b92a1e2f811"
            ]
        ]
    },
    {
        "id": "591df3cde7e3886a",
        "type": "ui_chart",
        "z": "8ee561e21c0a30f6",
        "name": "",
        "group": "5db072261e302c51",
        "order": 7,
        "width": 0,
        "height": 0,
        "label": "Humidity",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "86400",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 1080,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "779e20ca1ece3683",
        "type": "function",
        "z": "8ee561e21c0a30f6",
        "name": "set topic and payload filter",
        "func": "if (msg.payload > 60){\n    return null;\n}\nmsg.topic = 5;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 380,
        "wires": [
            [
                "591df3cde7e3886a"
            ]
        ]
    },
    {
        "id": "595c732b357dde6a",
        "type": "mqtt in",
        "z": "8ee561e21c0a30f6",
        "name": "mqtt-messages",
        "topic": "",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "a7804332c06e238f",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 600,
        "y": 520,
        "wires": [
            [
                "abdb5dd91ba7dfe5"
            ]
        ]
    },
    {
        "id": "60c43f89349480bf",
        "type": "inject",
        "z": "8ee561e21c0a30f6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "10",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 520,
        "wires": [
            [
                "6005578bbcc79b94"
            ]
        ]
    },
    {
        "id": "abdb5dd91ba7dfe5",
        "type": "function",
        "z": "8ee561e21c0a30f6",
        "name": "decoder",
        "func": "var topicIn = msg.topic; //node-red/room/control/0\nvar parts = topicIn.split('/');\nvar lastPart = parts[parts.length - 1];\nvar number = parseInt(lastPart, 10);\n\nmsg.topic = number;\nmsg.payload = msg.payload;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 520,
        "wires": [
            [
                "0556346d05a00c85"
            ]
        ]
    },
    {
        "id": "063917b9542f62ea",
        "type": "ui_chart",
        "z": "8ee561e21c0a30f6",
        "name": "",
        "group": "5db072261e302c51",
        "order": 7,
        "width": 0,
        "height": 0,
        "label": "temp",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "86400",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 1070,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "0aa4cd3f64a0886b",
        "type": "function",
        "z": "8ee561e21c0a30f6",
        "name": "set topic and payload filter",
        "func": "if (msg.payload > 60){\n    return null;\n}\nmsg.topic = 5;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 300,
        "wires": [
            [
                "063917b9542f62ea"
            ]
        ]
    },
    {
        "id": "229f42e6df64a732",
        "type": "ui_chart",
        "z": "8ee561e21c0a30f6",
        "name": "",
        "group": "5db072261e302c51",
        "order": 7,
        "width": 0,
        "height": 0,
        "label": "power",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "86400",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 1070,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "0b0e7b5e639196c5",
        "type": "function",
        "z": "8ee561e21c0a30f6",
        "name": "set topic and payload filter",
        "func": "if (msg.payload > 60){\n    return null;\n}\nmsg.topic = 5;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 340,
        "wires": [
            [
                "229f42e6df64a732"
            ]
        ]
    },
    {
        "id": "d079eeae25a7c54e",
        "type": "inject",
        "z": "8ee561e21c0a30f6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 60,
        "wires": [
            [
                "3c33beb1c49138e3"
            ]
        ]
    },
    {
        "id": "f40db6a1c2784016",
        "type": "http request",
        "z": "8ee561e21c0a30f6",
        "name": "fontana",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 560,
        "y": 60,
        "wires": [
            [
                "07dd68d8a35db20a"
            ]
        ]
    },
    {
        "id": "07dd68d8a35db20a",
        "type": "function",
        "z": "8ee561e21c0a30f6",
        "name": "pinDescription",
        "func": "flow.set(\"pinDescr\", msg.payload.descr); // сохраняем только descr[]\nreturn msg; // ничего не передаём дальше\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 60,
        "wires": [
            [
                "1ad63619284b7c7d"
            ]
        ]
    },
    {
        "id": "f814578304301c1e",
        "type": "http request",
        "z": "8ee561e21c0a30f6",
        "name": "get",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1130,
        "y": 60,
        "wires": [
            [
                "b6f99def57664cf4"
            ]
        ]
    },
    {
        "id": "b6f99def57664cf4",
        "type": "function",
        "z": "8ee561e21c0a30f6",
        "name": "Other setup",
        "func": "flow.set(\"OtherSetup\", msg.payload); // сохраняем только descr[]\nreturn null; // ничего не передаём дальше\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1290,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "1ad63619284b7c7d",
        "type": "function",
        "z": "8ee561e21c0a30f6",
        "name": "request other setup",
        "func": "msg.url = \"http://\"+flow.get(\"ip\")+\"/other_setup.txt\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 60,
        "wires": [
            [
                "f814578304301c1e"
            ]
        ]
    },
    {
        "id": "3c33beb1c49138e3",
        "type": "function",
        "z": "8ee561e21c0a30f6",
        "name": "set IP address and name",
        "func": "flow.set(\"ip\", \"192.168.1.153\"); \nmsg.url = \"http://\"+flow.get(\"ip\")+\"/pin_setup.txt\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 60,
        "wires": [
            [
                "f40db6a1c2784016"
            ]
        ]
    },
    {
        "id": "0817de9c0b020be6",
        "type": "mqtt out",
        "z": "8ee561e21c0a30f6",
        "name": "",
        "topic": "",
        "qos": "0",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "a7804332c06e238f",
        "x": 2120,
        "y": 500,
        "wires": []
    },
    {
        "id": "d310abc6f163d5e7",
        "type": "function",
        "z": "8ee561e21c0a30f6",
        "name": "encoder node-red/room/{{topic}}",
        "func": "let otherSetup = flow.get(\"OtherSetup\");\nmsg.topic = \"node-red/\" + otherSetup.deviceID + \"/\" + msg.topic;\nmsg.qos = 0;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 500,
        "wires": [
            [
                "0817de9c0b020be6"
            ]
        ]
    },
    {
        "id": "6005578bbcc79b94",
        "type": "function",
        "z": "8ee561e21c0a30f6",
        "name": "subscribe",
        "func": "var subcsciptionLoop = []\nlet otherSetup = flow.get(\"OtherSetup\");\n\nfor (var i = 0; i < 7; i++) {\n    var subscriptionVar = {\n        action: \"subscribe\",\n        topic: \"node-red/\" + otherSetup.deviceID + \"/control/\" + i\n    }\n    subcsciptionLoop.push(subscriptionVar);\n}\nreturn [subcsciptionLoop];",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 520,
        "wires": [
            [
                "595c732b357dde6a"
            ]
        ]
    },
    {
        "id": "d915c51c93f0dc5c",
        "type": "function",
        "z": "8ee561e21c0a30f6",
        "name": "convert to inno DB",
        "func": "// Получение данных\nlet data = msg.payload;\nlet stat = data.stat.map(parseFloat);  // Преобразуем все строки в float\nlet otherSetup = flow.get(\"OtherSetup\");\n\n\n// Получение описаний из контекста\nlet descr = flow.get(\"pinDescr\") || [];\n\n// Подготовка полей\nlet fields = {};\n\nfor (let i = 0; i < stat.length; i++) {\n    let rawName = descr[i] || (\"pin_\" + i); // если нет имени, используем pin_0, pin_1 и т.д.\n    let cleanName = rawName.toString().replace(/\\s+/g, \"_\").replace(/[^\\w]/g, \"_\"); // удаляем пробелы и спецсимволы\n    fields[cleanName] = stat[i]; // Присваиваем значение\n}\n\n// Итоговое сообщение\nmsg.payload = [\n    {\n        measurement: otherSetup.deviceID,  // имя измерения — можешь изменить\n        fields: fields,\n        tags: {\n            location: otherSetup.deviceID\n        },\n        timestamp: new Date()\n    }\n];\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 460,
        "wires": [
            [
                "cb6807b01094fd9a"
            ]
        ]
    },
    {
        "id": "cb6807b01094fd9a",
        "type": "influxdb batch",
        "z": "8ee561e21c0a30f6",
        "influxdb": "8818288d473df902",
        "precision": "",
        "retentionPolicy": "",
        "name": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "organisation",
        "bucket": "bucket",
        "x": 930,
        "y": 460,
        "wires": []
    },
    {
        "id": "e7b0f4719fa16892",
        "type": "inject",
        "z": "8ee561e21c0a30f6",
        "name": "watering on at 08.00",
        "props": [
            {
                "p": "topic",
                "v": "6",
                "vt": "num"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "00 08 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "1",
        "payloadType": "num",
        "x": 860,
        "y": 620,
        "wires": [
            [
                "6d4c9872d5d18297",
                "c4b19581c2b36d16"
            ]
        ]
    },
    {
        "id": "ec98a9a401c05f80",
        "type": "function",
        "z": "8ee561e21c0a30f6",
        "name": "convert to inno DB",
        "func": "let data = msg.payload;\nlet otherSetup = flow.get(\"OtherSetup\");\n\nif (otherSetup === undefined || typeof data !== \"object\" || data === null || Array.isArray(data)) {\n    node.warn(\"Неверный формат данных: ожидался объект, а не массив.\");\n    return null;\n}\n\nlet fields = {};\n\nfor (let key in data) {\n    // Отфильтровываем ключи, которые выглядят как чистые числа (например, \"0\", \"1\", и т.п.)\n    if (/^\\d+$/.test(key)) {\n        node.warn(\"Пропущен числовой ключ: \" + key);\n        continue;\n    }\n\n    let value = data[key];\n\n    // Очистка ключа\n    let cleanKey = key.toString().replace(/\\s+/g, \"_\").replace(/[^\\w]/g, \"_\");\n\n    // Типизация значений\n    if (typeof value === \"number\") {\n        fields[cleanKey] = value;\n    } else if (typeof value === \"string\") {\n        fields[cleanKey] = value.toString().replace(/\\s+/g, \"_\").replace(/[^\\w\\.\\-]/g, \"_\");\n    } else {\n        fields[cleanKey] = JSON.stringify(value);\n    }\n}\n\nmsg.payload = [\n    {\n        measurement: otherSetup.deviceID + \"_system\",\n        fields: fields,\n        tags: {\n            location: otherSetup.deviceID + \"_system\"\n        },\n        timestamp: new Date()\n    }\n];\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 880,
        "wires": [
            [
                "8911d5bdb4f3c9eb"
            ]
        ]
    },
    {
        "id": "8911d5bdb4f3c9eb",
        "type": "influxdb batch",
        "z": "8ee561e21c0a30f6",
        "influxdb": "8818288d473df902",
        "precision": "",
        "retentionPolicy": "",
        "name": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "organisation",
        "bucket": "bucket",
        "x": 1230,
        "y": 880,
        "wires": []
    },
    {
        "id": "e0d177ad0cf587b1",
        "type": "http request",
        "z": "8ee561e21c0a30f6",
        "name": "wifi-all",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 710,
        "y": 880,
        "wires": [
            [
                "ec98a9a401c05f80"
            ]
        ]
    },
    {
        "id": "a303f6faaa5b8736",
        "type": "function",
        "z": "8ee561e21c0a30f6",
        "name": "getIP",
        "func": "msg.url = \"http://\"+flow.get(\"ip\")+\"/all\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 880,
        "wires": [
            [
                "e0d177ad0cf587b1"
            ]
        ]
    },
    {
        "id": "6d4c9872d5d18297",
        "type": "function",
        "z": "8ee561e21c0a30f6",
        "name": "set URL",
        "func": "msg.url = \"http://\" + flow.get(\"ip\") + \"/sendAJAX?json={t:\" + msg.topic + \",v:\" + msg.payload + \"}\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1560,
        "y": 720,
        "wires": [
            [
                "7ee180c697053c20"
            ]
        ]
    },
    {
        "id": "7ee180c697053c20",
        "type": "http request",
        "z": "8ee561e21c0a30f6",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1730,
        "y": 720,
        "wires": [
            [
                "d310abc6f163d5e7"
            ]
        ]
    },
    {
        "id": "2421ac0f71f32e47",
        "type": "inject",
        "z": "8ee561e21c0a30f6",
        "name": "watering on at 20.00",
        "props": [
            {
                "p": "topic",
                "v": "6",
                "vt": "num"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "00 20 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "1",
        "payloadType": "num",
        "x": 860,
        "y": 660,
        "wires": [
            [
                "6d4c9872d5d18297",
                "c4b19581c2b36d16"
            ]
        ]
    },
    {
        "id": "47fc0ccfa200debf",
        "type": "inject",
        "z": "8ee561e21c0a30f6",
        "name": "16.00",
        "props": [
            {
                "p": "topic",
                "v": "6",
                "vt": "num"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "00 16 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "1",
        "payloadType": "num",
        "x": 810,
        "y": 700,
        "wires": [
            [
                "6d4c9872d5d18297",
                "c4b19581c2b36d16"
            ]
        ]
    },
    {
        "id": "d38d203aa4e80c74",
        "type": "delay",
        "z": "8ee561e21c0a30f6",
        "name": "",
        "pauseType": "rate",
        "timeout": "10",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "10",
        "rateUnits": "minute",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 1320,
        "y": 540,
        "wires": [
            [
                "da6e9301267b2d18"
            ]
        ]
    },
    {
        "id": "da6e9301267b2d18",
        "type": "change",
        "z": "8ee561e21c0a30f6",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "6",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1500,
        "y": 540,
        "wires": [
            [
                "6d4c9872d5d18297"
            ]
        ]
    },
    {
        "id": "fea2179dfe918dfb",
        "type": "rbe",
        "z": "8ee561e21c0a30f6",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 770,
        "y": 180,
        "wires": [
            [
                "cbb21692f599eebe"
            ]
        ]
    },
    {
        "id": "c4b19581c2b36d16",
        "type": "delay",
        "z": "8ee561e21c0a30f6",
        "name": "",
        "pauseType": "delay",
        "timeout": "10",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1130,
        "y": 540,
        "wires": [
            [
                "d38d203aa4e80c74"
            ]
        ]
    },
    {
        "id": "3c1987dcc97c0950",
        "type": "function",
        "z": "a69381581f637ec6",
        "name": "myroom",
        "func": "var topicObjects = [];\nvar parsed = (msg.payload);\nvar topic = (msg.topic)\n\n\n\nvar outputCount_number = node.outputCount\nif (topic == \"initial\") {\n    for (var i = 0; i < parsed.stat.length; i++) {\n        var topicObject = {\n            payload: parseFloat(parsed.stat[i]),\n            topic: i\n        };\n        topicObjects.push(topicObject);\n    }\n}\nelse {// topic is not initial\n    for (var i = 0; i < outputCount_number; i++) {\n        if (i == parseInt(topic)) {\n            topicObject = {\n                payload: parseFloat(parsed),\n                topic: parseInt(topic)\n            }\n            topicObjects.push(topicObject);\n        };\n        topicObjects.push(null);\n    }\n}\n\nreturn topicObjects;",
        "outputs": 4,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 220,
        "wires": [
            [
                "68b8f5b24c81ca18"
            ],
            [],
            [
                "087ce8cf184d7dbb",
                "36ca1aa910c3c841"
            ],
            []
        ]
    },
    {
        "id": "101ccdf189e1cff4",
        "type": "inject",
        "z": "a69381581f637ec6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "120",
        "crontab": "",
        "once": false,
        "onceDelay": "10",
        "topic": "initial",
        "payload": "",
        "payloadType": "date",
        "x": 210,
        "y": 220,
        "wires": [
            [
                "b2b4a0fa144078ac"
            ]
        ]
    },
    {
        "id": "b2b4a0fa144078ac",
        "type": "http request",
        "z": "a69381581f637ec6",
        "name": "myroom",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "192.168.1.151/sendAJAX?json={%22t%22:127,%22v%22:0}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 400,
        "y": 220,
        "wires": [
            [
                "3c1987dcc97c0950",
                "c8ce4ebd28a2b778",
                "71cf6148d16e509a",
                "be8bf7398d4274c7"
            ]
        ]
    },
    {
        "id": "68b8f5b24c81ca18",
        "type": "ui_switch",
        "z": "a69381581f637ec6",
        "name": "light car",
        "label": "light car",
        "tooltip": "",
        "group": "1d2608aa5cac07fa",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "0",
        "topicType": "str",
        "style": "",
        "onvalue": "0",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 760,
        "y": 140,
        "wires": [
            [
                "883b31fc5a7146c5"
            ]
        ]
    },
    {
        "id": "cbbe677965b8d8aa",
        "type": "http request",
        "z": "a69381581f637ec6",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://192.168.1.151/sendAJAX?json={%22t%22:{{topic}},%22v%22:{{payload}}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1170,
        "y": 240,
        "wires": [
            [
                "087ce8cf184d7dbb"
            ]
        ]
    },
    {
        "id": "883b31fc5a7146c5",
        "type": "rbe",
        "z": "a69381581f637ec6",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 910,
        "y": 140,
        "wires": [
            [
                "cbbe677965b8d8aa"
            ]
        ]
    },
    {
        "id": "7ae5c35c50beaf21",
        "type": "mqtt in",
        "z": "a69381581f637ec6",
        "name": "mqtt-messages",
        "topic": "",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "a7804332c06e238f",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 500,
        "y": 500,
        "wires": [
            [
                "d7ad5768a115e0fa"
            ]
        ]
    },
    {
        "id": "d66a2bdd1265524a",
        "type": "mqtt out",
        "z": "a69381581f637ec6",
        "name": "",
        "topic": "",
        "qos": "0",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "a7804332c06e238f",
        "x": 1630,
        "y": 480,
        "wires": []
    },
    {
        "id": "cfdba40e5be55a13",
        "type": "function",
        "z": "a69381581f637ec6",
        "name": "subscribe",
        "func": "var subcsciptionLoop = []\n\nfor (var i = 0; i < 6; i++) {\n    var subscriptionVar = {\n        action: \"subscribe\",\n        topic: \"node-red/roof/control/\" + i\n    }\n    subcsciptionLoop.push(subscriptionVar);\n}\nreturn [subcsciptionLoop];",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 500,
        "wires": [
            [
                "7ae5c35c50beaf21"
            ]
        ]
    },
    {
        "id": "6582a88230d87d39",
        "type": "inject",
        "z": "a69381581f637ec6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 500,
        "wires": [
            [
                "cfdba40e5be55a13"
            ]
        ]
    },
    {
        "id": "d7ad5768a115e0fa",
        "type": "function",
        "z": "a69381581f637ec6",
        "name": "decoder",
        "func": "var topicIn = msg.topic; //node-red/room/control/0\nvar parts = topicIn.split('/');\nvar lastPart = parts[parts.length - 1];\nvar number = parseInt(lastPart, 10);\n\nmsg.topic = number;\nmsg.payload = msg.payload;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 500,
        "wires": [
            [
                "3c1987dcc97c0950"
            ]
        ]
    },
    {
        "id": "087ce8cf184d7dbb",
        "type": "function",
        "z": "a69381581f637ec6",
        "name": "encoder node-red/room/{{topic}}",
        "func": "msg.topic = \"node-red/roof/\" + msg.topic;\nmsg.qos = 0;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 480,
        "wires": [
            [
                "d66a2bdd1265524a"
            ]
        ]
    },
    {
        "id": "ce9b2a3b7b2e04f1",
        "type": "function",
        "z": "a69381581f637ec6",
        "name": "Error",
        "func": "if (msg.payload.startsWith(\"Error:\")){\nmsg.url = \"192.168.1.150/function?json={reboot:1}\"\n\nreturn msg;\n}\nreturn null;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 400,
        "wires": [
            [
                "c96f813582677fe2"
            ]
        ]
    },
    {
        "id": "c96f813582677fe2",
        "type": "http request",
        "z": "a69381581f637ec6",
        "name": "reboot",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1110,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "344dbb3b2b9a1329",
        "type": "ui_chart",
        "z": "a69381581f637ec6",
        "name": "temp",
        "group": "1d2608aa5cac07fa",
        "order": 6,
        "width": 0,
        "height": 0,
        "label": "temp roof",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "86400",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 970,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "36ca1aa910c3c841",
        "type": "function",
        "z": "a69381581f637ec6",
        "name": "set topic and payload filter",
        "func": "if (msg.payload > 60){\n    return null;\n}\nmsg.topic = 2;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 300,
        "wires": [
            [
                "344dbb3b2b9a1329"
            ]
        ]
    },
    {
        "id": "c8ce4ebd28a2b778",
        "type": "function",
        "z": "a69381581f637ec6",
        "name": "AI input",
        "func": "var name = {}\nname[0] = \"car light\"\nname[1] = \"nothig connected to this switch\"\nname[2] = \"temperature at the roof\"\nname[3] = \"PC Power button\"\n\n\n\nfunction setStoredValue(objectValue) {\n    var storedValues = global.get(\"storedValues\") || {}; // Retrieve existing data or initialize an empty object\n    var parameterName = objectValue.name; // Example: \"Curtain in my room switch up\"\n    var parameterNumber = objectValue.topic; // Example: 0\n    var parameterValue = objectValue.payload; // Example: 100\n    // If the entry already exists, update only the payload\n    if (storedValues.hasOwnProperty(parameterName)) {\n        storedValues[parameterName].payload = parameterValue;\n    } else {\n        // Otherwise, create a new entry\n        storedValues[parameterName] = {\n            topic: parameterNumber,\n            payload: parameterValue\n        };\n    }\n    global.set(\"storedValues\", storedValues); // Save back to global context\n    return null; // No output needed\n}\n\nvar topicObjects = [];\nvar parsed = (msg.payload);\nvar topic = (msg.topic)\nvar outputCount_number = node.outputCount\nif (topic == \"initial\") {\n    for (var i = 0; i < parsed.stat.length; i++) {\n        var topicObject = {\n            payload: parseFloat(parsed.stat[i]),\n            topic: i,\n            name: name[i]\n        };\n        setStoredValue(topicObject);\n        topicObjects.push(topicObject);\n    }\n    return topicObjects;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "76488f9c03ac4385",
        "type": "inject",
        "z": "a69381581f637ec6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 40,
        "wires": [
            [
                "3d2f65caada09ebe"
            ]
        ]
    },
    {
        "id": "8256e8fda13a1e08",
        "type": "http request",
        "z": "a69381581f637ec6",
        "name": "fontana",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 600,
        "y": 40,
        "wires": [
            [
                "a6cd8dc47d58ee8f"
            ]
        ]
    },
    {
        "id": "a6cd8dc47d58ee8f",
        "type": "function",
        "z": "a69381581f637ec6",
        "name": "pinDescription",
        "func": "flow.set(\"pinDescr\", msg.payload.descr); // сохраняем только descr[]\nreturn msg; // ничего не передаём дальше\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 40,
        "wires": [
            [
                "1e5f3a459c7d7b65"
            ]
        ]
    },
    {
        "id": "5cef213c59567620",
        "type": "http request",
        "z": "a69381581f637ec6",
        "name": "get",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1170,
        "y": 40,
        "wires": [
            [
                "f0c587eed0e3c90b"
            ]
        ]
    },
    {
        "id": "f0c587eed0e3c90b",
        "type": "function",
        "z": "a69381581f637ec6",
        "name": "Other setup",
        "func": "flow.set(\"OtherSetup\", msg.payload); // сохраняем только descr[]\nreturn null; // ничего не передаём дальше\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1330,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "1e5f3a459c7d7b65",
        "type": "function",
        "z": "a69381581f637ec6",
        "name": "request other setup",
        "func": "msg.url = \"http://\"+flow.get(\"ip\")+\"/other_setup.txt\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 40,
        "wires": [
            [
                "5cef213c59567620"
            ]
        ]
    },
    {
        "id": "3d2f65caada09ebe",
        "type": "function",
        "z": "a69381581f637ec6",
        "name": "set IP address and name",
        "func": "flow.set(\"ip\", \"192.168.1.151\"); \nmsg.url = \"http://\"+flow.get(\"ip\")+\"/pin_setup.txt\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 40,
        "wires": [
            [
                "8256e8fda13a1e08"
            ]
        ]
    },
    {
        "id": "71cf6148d16e509a",
        "type": "function",
        "z": "a69381581f637ec6",
        "name": "convert to inno DB",
        "func": "// Получение данных\nlet data = msg.payload;\nlet stat = data.stat.map(parseFloat);  // Преобразуем все строки в float\nlet otherSetup = flow.get(\"OtherSetup\");\n\n\n// Получение описаний из контекста\nlet descr = flow.get(\"pinDescr\") || [];\n\n// Подготовка полей\nlet fields = {};\n\nfor (let i = 0; i < stat.length; i++) {\n    let rawName = descr[i] || (\"pin_\" + i); // если нет имени, используем pin_0, pin_1 и т.д.\n    let cleanName = rawName.toString().replace(/\\s+/g, \"_\").replace(/[^\\w]/g, \"_\"); // удаляем пробелы и спецсимволы\n    fields[cleanName] = stat[i]; // Присваиваем значение\n}\n\n// Итоговое сообщение\nmsg.payload = [\n    {\n        measurement: otherSetup.deviceID,  // имя измерения — можешь изменить\n        fields: fields,\n        tags: {\n            location: otherSetup.deviceID\n        },\n        timestamp: new Date()\n    }\n];\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 360,
        "wires": [
            [
                "96eaa97b26cfc8da"
            ]
        ]
    },
    {
        "id": "96eaa97b26cfc8da",
        "type": "influxdb batch",
        "z": "a69381581f637ec6",
        "influxdb": "8818288d473df902",
        "precision": "",
        "retentionPolicy": "",
        "name": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "organisation",
        "bucket": "bucket",
        "x": 890,
        "y": 360,
        "wires": []
    },
    {
        "id": "37c191451fee0117",
        "type": "function",
        "z": "a69381581f637ec6",
        "name": "convert to inno DB",
        "func": "let data = msg.payload;\nlet otherSetup = flow.get(\"OtherSetup\");\n\nif (otherSetup === undefined || typeof data !== \"object\" || data === null || Array.isArray(data)) {\n    node.warn(\"Неверный формат данных: ожидался объект, а не массив.\");\n    return null;\n}\n\nlet fields = {};\n\nfor (let key in data) {\n    // Отфильтровываем ключи, которые выглядят как чистые числа (например, \"0\", \"1\", и т.п.)\n    if (/^\\d+$/.test(key)) {\n        node.warn(\"Пропущен числовой ключ: \" + key);\n        continue;\n    }\n\n    let value = data[key];\n\n    // Очистка ключа\n    let cleanKey = key.toString().replace(/\\s+/g, \"_\").replace(/[^\\w]/g, \"_\");\n\n    // Типизация значений\n    if (typeof value === \"number\") {\n        fields[cleanKey] = value;\n    } else if (typeof value === \"string\") {\n        fields[cleanKey] = value.toString().replace(/\\s+/g, \"_\").replace(/[^\\w\\.\\-]/g, \"_\");\n    } else {\n        fields[cleanKey] = JSON.stringify(value);\n    }\n}\n\nmsg.payload = [\n    {\n        measurement: otherSetup.deviceID + \"_system\",\n        fields: fields,\n        tags: {\n            location: otherSetup.deviceID + \"_system\"\n        },\n        timestamp: new Date()\n    }\n];\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 600,
        "wires": [
            [
                "3259ace5b27881bf"
            ]
        ]
    },
    {
        "id": "3259ace5b27881bf",
        "type": "influxdb batch",
        "z": "a69381581f637ec6",
        "influxdb": "8818288d473df902",
        "precision": "",
        "retentionPolicy": "",
        "name": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "organisation",
        "bucket": "bucket",
        "x": 1210,
        "y": 600,
        "wires": []
    },
    {
        "id": "1a44ad4350ae5c35",
        "type": "http request",
        "z": "a69381581f637ec6",
        "name": "wifi-all",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 690,
        "y": 600,
        "wires": [
            [
                "37c191451fee0117"
            ]
        ]
    },
    {
        "id": "be8bf7398d4274c7",
        "type": "function",
        "z": "a69381581f637ec6",
        "name": "getIP",
        "func": "msg.url = \"http://\"+flow.get(\"ip\")+\"/all\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 600,
        "wires": [
            [
                "1a44ad4350ae5c35"
            ]
        ]
    },
    {
        "id": "ccedcfa9da7ec94b",
        "type": "function",
        "z": "6f216e4069410c84",
        "name": "myroom",
        "func": "var topicObjects = [];\nvar parsed = (msg.payload);\nvar topic = (msg.topic)\n\n\n\nvar outputCount_number = node.outputCount\nif (topic == \"initial\") {\n    for (var i = 0; i < parsed.stat.length; i++) {\n        var topicObject = {\n            payload: parseFloat(parsed.stat[i]),\n            topic: i\n        };\n        topicObjects.push(topicObject);\n    }\n}\nelse {// topic is not initial\n    for (var i = 0; i < outputCount_number; i++) {\n        if (i == parseInt(topic)) {\n            topicObject = {\n                payload: parseFloat(parsed),\n                topic: parseInt(topic)\n            }\n            topicObjects.push(topicObject);\n        };\n        topicObjects.push(null);\n    }\n}\n\nreturn topicObjects;",
        "outputs": 4,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 200,
        "wires": [
            [
                "f1a39fb940e62af5"
            ],
            [
                "2020e22b1243eeb7"
            ],
            [
                "273e84219a8674aa"
            ],
            [
                "2c891dbe36586bb0",
                "0774783d6db9a21c"
            ]
        ]
    },
    {
        "id": "6fd32159444b4f26",
        "type": "inject",
        "z": "6f216e4069410c84",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "30",
        "crontab": "",
        "once": true,
        "onceDelay": "10",
        "topic": "initial",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 200,
        "wires": [
            [
                "afb489434bc39f28"
            ]
        ]
    },
    {
        "id": "63c330a41529fc76",
        "type": "http request",
        "z": "6f216e4069410c84",
        "name": "kitchen",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 580,
        "y": 200,
        "wires": [
            [
                "ccedcfa9da7ec94b",
                "ec53b758719b9a4e",
                "24ee13caa85ba5fb",
                "ed2b68d6f359d488"
            ]
        ]
    },
    {
        "id": "f1a39fb940e62af5",
        "type": "ui_switch",
        "z": "6f216e4069410c84",
        "name": "",
        "label": "heater",
        "tooltip": "",
        "group": "b77886c396feb2d9",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "onvalue": "0",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 1010,
        "y": 180,
        "wires": [
            [
                "5d34d3b760025339"
            ]
        ]
    },
    {
        "id": "2020e22b1243eeb7",
        "type": "ui_switch",
        "z": "6f216e4069410c84",
        "name": "",
        "label": "pump",
        "tooltip": "",
        "group": "b77886c396feb2d9",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "onvalue": "0",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 1010,
        "y": 220,
        "wires": [
            [
                "5ea792dcc7b34d10"
            ]
        ]
    },
    {
        "id": "a723fdfb47e5c23b",
        "type": "http request",
        "z": "6f216e4069410c84",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1610,
        "y": 200,
        "wires": [
            [
                "182cca3f3a9cf8ce"
            ]
        ]
    },
    {
        "id": "5d34d3b760025339",
        "type": "rbe",
        "z": "6f216e4069410c84",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 1150,
        "y": 180,
        "wires": [
            [
                "187244cfea11d867"
            ]
        ]
    },
    {
        "id": "5ea792dcc7b34d10",
        "type": "rbe",
        "z": "6f216e4069410c84",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 1150,
        "y": 220,
        "wires": [
            [
                "187244cfea11d867"
            ]
        ]
    },
    {
        "id": "2c891dbe36586bb0",
        "type": "ui_text",
        "z": "6f216e4069410c84",
        "group": "b77886c396feb2d9",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "remote heater",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 1040,
        "y": 340,
        "wires": []
    },
    {
        "id": "0774783d6db9a21c",
        "type": "function",
        "z": "6f216e4069410c84",
        "name": "set topic",
        "func": "var followheater = true\nif (global.get(\"followheater\") !== undefined || global.get(\"followheater\") !== null) {\n    followheater = global.get(\"followheater\");\n}\nif (followheater) {\n    var msg1 = {\n        topic: 0,\n        payload: msg.payload\n    };\n    var msg2 = {\n        topic: 1,\n        payload: msg.payload\n    };\n\n    return [[msg1, msg2]]\n}\nelse {\n    return null\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 300,
        "wires": [
            [
                "187244cfea11d867"
            ]
        ]
    },
    {
        "id": "273e84219a8674aa",
        "type": "ui_chart",
        "z": "6f216e4069410c84",
        "name": "",
        "group": "b77886c396feb2d9",
        "order": 3,
        "width": 0,
        "height": 0,
        "label": "Temp heater",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "86400",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 1030,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "fd8f9ed781ef193d",
        "type": "ui_switch",
        "z": "6f216e4069410c84",
        "name": "Follow heater?",
        "label": "Follow heater?",
        "tooltip": "",
        "group": "b77886c396feb2d9",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 880,
        "y": 80,
        "wires": [
            [
                "001cf15b67a334ac"
            ]
        ]
    },
    {
        "id": "001cf15b67a334ac",
        "type": "function",
        "z": "6f216e4069410c84",
        "name": "set follow heater value",
        "func": "if (msg.payload == true) {\n    global.set('followheater', true);\n} else {\n    global.set('followheater', false);\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1100,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "f4812a266f27b107",
        "type": "function",
        "z": "6f216e4069410c84",
        "name": "get followheater",
        "func": "msg.payload = global.get(\"followheater\");\nif (msg.payload === undefined || msg.payload === null) {\n    msg.payload = true;\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 80,
        "wires": [
            [
                "fd8f9ed781ef193d"
            ]
        ]
    },
    {
        "id": "754f04efa789aaa6",
        "type": "inject",
        "z": "6f216e4069410c84",
        "name": "set follow heater",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "10",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 470,
        "y": 80,
        "wires": [
            [
                "f4812a266f27b107"
            ]
        ]
    },
    {
        "id": "ec53b758719b9a4e",
        "type": "function",
        "z": "6f216e4069410c84",
        "name": "AI input",
        "func": "var name = {}\nname[0] = \"switch of heater inverted\"\nname[1] = \"switch of warm floor pump inverted\"\nname[2] = \"temperature at heater box\"\nname[3] = \"status of heater of remote controller, inverted\"\n\n\n\nfunction setStoredValue(objectValue) {\n    var storedValues = global.get(\"storedValues\") || {}; // Retrieve existing data or initialize an empty object\n    var parameterName = objectValue.name; // Example: \"Curtain in my room switch up\"\n    var parameterNumber = objectValue.topic; // Example: 0\n    var parameterValue = objectValue.payload; // Example: 100\n    // If the entry already exists, update only the payload\n    if (storedValues.hasOwnProperty(parameterName)) {\n        storedValues[parameterName].payload = parameterValue;\n    } else {\n        // Otherwise, create a new entry\n        storedValues[parameterName] = {\n            topic: parameterNumber,\n            payload: parameterValue\n        };\n    }\n    global.set(\"storedValues\", storedValues); // Save back to global context\n    return null; // No output needed\n}\n\nvar topicObjects = [];\nvar parsed = (msg.payload);\nvar topic = (msg.topic)\nvar outputCount_number = node.outputCount\nif (topic == \"initial\") {\n    for (var i = 0; i < parsed.stat.length; i++) {\n        var topicObject = {\n            payload: parseFloat(parsed.stat[i]),\n            topic: i,\n            name: name[i]\n        };\n        setStoredValue(topicObject);\n        topicObjects.push(topicObject);\n    }\n    return topicObjects;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "4516e3f2317221ac",
        "type": "inject",
        "z": "6f216e4069410c84",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 40,
        "wires": [
            [
                "29f63d6ac854bc89"
            ]
        ]
    },
    {
        "id": "eda4caf3978b0cbd",
        "type": "http request",
        "z": "6f216e4069410c84",
        "name": "fontana",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 560,
        "y": 40,
        "wires": [
            [
                "c9a8a460e30e798e"
            ]
        ]
    },
    {
        "id": "c9a8a460e30e798e",
        "type": "function",
        "z": "6f216e4069410c84",
        "name": "pinDescription",
        "func": "flow.set(\"pinDescr\", msg.payload.descr); // сохраняем только descr[]\nreturn msg; // ничего не передаём дальше\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 40,
        "wires": [
            [
                "dff2516340131fa3"
            ]
        ]
    },
    {
        "id": "819ca8ca70ae6a10",
        "type": "http request",
        "z": "6f216e4069410c84",
        "name": "get",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1130,
        "y": 40,
        "wires": [
            [
                "ee3a16b1e7bd4074"
            ]
        ]
    },
    {
        "id": "ee3a16b1e7bd4074",
        "type": "function",
        "z": "6f216e4069410c84",
        "name": "Other setup",
        "func": "flow.set(\"OtherSetup\", msg.payload); // сохраняем только descr[]\nreturn null; // ничего не передаём дальше\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1290,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "dff2516340131fa3",
        "type": "function",
        "z": "6f216e4069410c84",
        "name": "request other setup",
        "func": "msg.url = \"http://\"+flow.get(\"ip\")+\"/other_setup.txt\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 40,
        "wires": [
            [
                "819ca8ca70ae6a10"
            ]
        ]
    },
    {
        "id": "29f63d6ac854bc89",
        "type": "function",
        "z": "6f216e4069410c84",
        "name": "set IP address and name",
        "func": "flow.set(\"ip\", \"192.168.1.152\"); \nmsg.url = \"http://\"+flow.get(\"ip\")+\"/pin_setup.txt\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 40,
        "wires": [
            [
                "eda4caf3978b0cbd"
            ]
        ]
    },
    {
        "id": "afb489434bc39f28",
        "type": "function",
        "z": "6f216e4069410c84",
        "name": "getIP",
        "func": "msg.url = \"http://\"+flow.get(\"ip\")+\"/sendAJAX?json={t:127,v:0}\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 200,
        "wires": [
            [
                "63c330a41529fc76"
            ]
        ]
    },
    {
        "id": "187244cfea11d867",
        "type": "function",
        "z": "6f216e4069410c84",
        "name": "set URL",
        "func": "msg.url = \"http://\" + flow.get(\"ip\") + \"/sendAJAX?json={t:\" + msg.topic + \",v:\" + msg.payload + \"}\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1440,
        "y": 200,
        "wires": [
            [
                "a723fdfb47e5c23b"
            ]
        ]
    },
    {
        "id": "9111fc9e11172a65",
        "type": "mqtt in",
        "z": "6f216e4069410c84",
        "name": "mqtt-messages",
        "topic": "",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "a7804332c06e238f",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 520,
        "y": 480,
        "wires": [
            [
                "22281bb1d5d9f55b"
            ]
        ]
    },
    {
        "id": "96fcd313cdd154ca",
        "type": "function",
        "z": "6f216e4069410c84",
        "name": "subscribe",
        "func": "var subcsciptionLoop = []\nlet otherSetup = flow.get(\"OtherSetup\");\n\nfor (var i = 0; i < 7; i++) {\n    var subscriptionVar = {\n        action: \"subscribe\",\n        topic: \"node-red/\" + otherSetup.deviceID + \"/control/\" + i\n    }\n    subcsciptionLoop.push(subscriptionVar);\n}\nreturn [subcsciptionLoop];",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 480,
        "wires": [
            [
                "9111fc9e11172a65"
            ]
        ]
    },
    {
        "id": "ff247e5163d89f5d",
        "type": "inject",
        "z": "6f216e4069410c84",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "10",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 480,
        "wires": [
            [
                "96fcd313cdd154ca"
            ]
        ]
    },
    {
        "id": "22281bb1d5d9f55b",
        "type": "function",
        "z": "6f216e4069410c84",
        "name": "decoder",
        "func": "var topicIn = msg.topic; //node-red/room/control/0\nvar parts = topicIn.split('/');\nvar lastPart = parts[parts.length - 1];\nvar number = parseInt(lastPart, 10);\n\nmsg.topic = number;\nmsg.payload = msg.payload;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 480,
        "wires": [
            [
                "63c330a41529fc76"
            ]
        ]
    },
    {
        "id": "16a44fe9d944d97d",
        "type": "mqtt out",
        "z": "6f216e4069410c84",
        "name": "",
        "topic": "",
        "qos": "0",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "a7804332c06e238f",
        "x": 1350,
        "y": 480,
        "wires": []
    },
    {
        "id": "182cca3f3a9cf8ce",
        "type": "function",
        "z": "6f216e4069410c84",
        "name": "encoder node-red/room/{{topic}}",
        "func": "let otherSetup = flow.get(\"OtherSetup\");\nmsg.topic = \"node-red/\" + otherSetup.deviceID + \"/\" + msg.topic;\nmsg.qos = 0;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 480,
        "wires": [
            [
                "16a44fe9d944d97d"
            ]
        ]
    },
    {
        "id": "24ee13caa85ba5fb",
        "type": "function",
        "z": "6f216e4069410c84",
        "name": "convert to inno DB",
        "func": "// Получение данных\nlet data = msg.payload;\nlet stat = data.stat.map(parseFloat);  // Преобразуем все строки в float\nlet otherSetup = flow.get(\"OtherSetup\");\n\n\n// Получение описаний из контекста\nlet descr = flow.get(\"pinDescr\") || [];\n\n// Подготовка полей\nlet fields = {};\n\nfor (let i = 0; i < stat.length; i++) {\n    let rawName = descr[i] || (\"pin_\" + i); // если нет имени, используем pin_0, pin_1 и т.д.\n    let cleanName = rawName.toString().replace(/\\s+/g, \"_\").replace(/[^\\w]/g, \"_\"); // удаляем пробелы и спецсимволы\n    fields[cleanName] = stat[i]; // Присваиваем значение\n}\n\n// Итоговое сообщение\nmsg.payload = [\n    {\n        measurement: otherSetup.deviceID,  // имя измерения — можешь изменить\n        fields: fields,\n        tags: {\n            location: otherSetup.deviceID\n        },\n        timestamp: new Date()\n    }\n];\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 400,
        "wires": [
            [
                "85d75674b95fb28b"
            ]
        ]
    },
    {
        "id": "85d75674b95fb28b",
        "type": "influxdb batch",
        "z": "6f216e4069410c84",
        "influxdb": "8818288d473df902",
        "precision": "",
        "retentionPolicy": "",
        "name": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "organisation",
        "bucket": "bucket",
        "x": 1170,
        "y": 400,
        "wires": []
    },
    {
        "id": "00be3aba9f7301d0",
        "type": "function",
        "z": "6f216e4069410c84",
        "name": "convert to inno DB",
        "func": "let data = msg.payload;\nlet otherSetup = flow.get(\"OtherSetup\");\n\nif (otherSetup === undefined || typeof data !== \"object\" || data === null || Array.isArray(data)) {\n    node.warn(\"Неверный формат данных: ожидался объект, а не массив.\");\n    return null;\n}\n\nlet fields = {};\n\nfor (let key in data) {\n    // Отфильтровываем ключи, которые выглядят как чистые числа (например, \"0\", \"1\", и т.п.)\n    if (/^\\d+$/.test(key)) {\n        node.warn(\"Пропущен числовой ключ: \" + key);\n        continue;\n    }\n\n    let value = data[key];\n\n    // Очистка ключа\n    let cleanKey = key.toString().replace(/\\s+/g, \"_\").replace(/[^\\w]/g, \"_\");\n\n    // Типизация значений\n    if (typeof value === \"number\") {\n        fields[cleanKey] = value;\n    } else if (typeof value === \"string\") {\n        fields[cleanKey] = value.toString().replace(/\\s+/g, \"_\").replace(/[^\\w\\.\\-]/g, \"_\");\n    } else {\n        fields[cleanKey] = JSON.stringify(value);\n    }\n}\n\nmsg.payload = [\n    {\n        measurement: otherSetup.deviceID + \"_system\",\n        fields: fields,\n        tags: {\n            location: otherSetup.deviceID + \"_system\"\n        },\n        timestamp: new Date()\n    }\n];\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1070,
        "y": 580,
        "wires": [
            [
                "19c4f6a249173bc6"
            ]
        ]
    },
    {
        "id": "19c4f6a249173bc6",
        "type": "influxdb batch",
        "z": "6f216e4069410c84",
        "influxdb": "8818288d473df902",
        "precision": "",
        "retentionPolicy": "",
        "name": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "organisation",
        "bucket": "bucket",
        "x": 1350,
        "y": 580,
        "wires": []
    },
    {
        "id": "a2054f8b1f7694c7",
        "type": "http request",
        "z": "6f216e4069410c84",
        "name": "wifi-all",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 830,
        "y": 580,
        "wires": [
            [
                "00be3aba9f7301d0"
            ]
        ]
    },
    {
        "id": "ed2b68d6f359d488",
        "type": "function",
        "z": "6f216e4069410c84",
        "name": "getIP",
        "func": "msg.url = \"http://\"+flow.get(\"ip\")+\"/all\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 580,
        "wires": [
            [
                "a2054f8b1f7694c7"
            ]
        ]
    },
    {
        "id": "27305ebce4a2d493",
        "type": "inject",
        "z": "47e2824120b2a9e0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "3",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 300,
        "y": 340,
        "wires": [
            [
                "7df1bdd34f900e31"
            ]
        ]
    },
    {
        "id": "7df1bdd34f900e31",
        "type": "http request",
        "z": "47e2824120b2a9e0",
        "name": "",
        "method": "GET",
        "ret": "bin",
        "paytoqs": "ignore",
        "url": "http://192.168.1.163:8080/shot.jpg",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 490,
        "y": 340,
        "wires": [
            [
                "0a4bc3d7ef6e5525",
                "4583c5f156b24838",
                "4ee01d95e0d70df1",
                "3cf004cc123213e4",
                "7b8b57b6fd86e466",
                "0c77107bad11e9ca"
            ]
        ]
    },
    {
        "id": "0a4bc3d7ef6e5525",
        "type": "good-object-detection",
        "z": "47e2824120b2a9e0",
        "name": "",
        "returnValue": 0,
        "model": "yolov8n",
        "threshold": "0.4",
        "absolutePathDir": "",
        "x": 860,
        "y": 340,
        "wires": [
            [
                "5a0bcede9b2f95bb"
            ]
        ]
    },
    {
        "id": "d41c11332894c274",
        "type": "telegram sender",
        "z": "47e2824120b2a9e0",
        "name": "sender",
        "bot": "ca786bad.5ac7a8",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1770,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "1661ecf3d0a55af0",
        "type": "function",
        "z": "47e2824120b2a9e0",
        "name": "checkForPersonArrays",
        "func": "\n\nfunction checkForPersonArrays(input) {\n    // Check if the input object has a property named 'person' and it's an array\n    if (input.hasOwnProperty('person') && Array.isArray(input.person)) {\n        let personArray = input.person;\n        let personCount = personArray.length;\n        return personCount;\n    } else {\n        return null; // Return null if 'person' array is not found\n    }\n}\n\nlet result = checkForPersonArrays(msg.payload.data);\nif (result != null) {\n    msg.payload = result\n    // node.error(msg.payload);\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "4517be7281db9072",
        "type": "ui_text",
        "z": "47e2824120b2a9e0",
        "group": "d933d053d66f5444",
        "order": 6,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "objects",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 1320,
        "y": 260,
        "wires": []
    },
    {
        "id": "ad14deb3db078355",
        "type": "inject",
        "z": "47e2824120b2a9e0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "6",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 290,
        "y": 860,
        "wires": [
            [
                "0c3744b75951e07b"
            ]
        ]
    },
    {
        "id": "0c3744b75951e07b",
        "type": "http request",
        "z": "47e2824120b2a9e0",
        "name": "",
        "method": "GET",
        "ret": "bin",
        "paytoqs": "ignore",
        "url": "http://192.168.1.162:8080/shot.jpg",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 520,
        "y": 740,
        "wires": [
            [
                "1fbe083c1961f2c2",
                "0fe980fc2f64cdc1"
            ]
        ]
    },
    {
        "id": "1fbe083c1961f2c2",
        "type": "good-object-detection",
        "z": "47e2824120b2a9e0",
        "name": "",
        "returnValue": 0,
        "model": "yolov8n",
        "threshold": "0.5",
        "absolutePathDir": "",
        "x": 740,
        "y": 740,
        "wires": [
            [
                "56fb91a6414ddd32"
            ]
        ]
    },
    {
        "id": "ec2f807dbbc0c3f4",
        "type": "telegram sender",
        "z": "47e2824120b2a9e0",
        "name": "AlinkaBot",
        "bot": "170adc9ec64f9f80",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1660,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "c4b1621834b168c9",
        "type": "function",
        "z": "47e2824120b2a9e0",
        "name": "check persons on a photo",
        "func": "\n\nfunction checkForPersonArrays(input) {\n    // Check if the input object has a property named 'person' and it's an array\n    if (input.hasOwnProperty('person') && Array.isArray(input.person)) {\n        let personArray = input.person;\n        let personCount = personArray.length;\n        return personCount;\n    } else {\n        return null; // Return null if 'person' array is not found\n    }\n}\n\nlet result = checkForPersonArrays(msg.payload.data);\nif (result != null) {\n    msg.payload = result\n    // node.error(msg.payload);\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "7ff3e570548d8d87",
        "type": "function",
        "z": "47e2824120b2a9e0",
        "name": "message",
        "func": "var content = msg.payload;\n    // \"chatId\": [\"843873284\", \"584925756\"],\nvar TelegramChatIds = global.get(\"TelegramChatIds\");\n\nif (!Array.isArray(TelegramChatIds)) {\n    node.error(\"TelegramChatIds is not an array\");\n    return null;\n}\n\nvar ObjectPayload = {\n        \"chatId\": \"584925756\",\n        \"type\": \"message\",\n        \"content\": \"camera front: \"+JSON.stringify(content) // Convert content to a string\n};\nmsg.payload = ObjectPayload;\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1200,
        "y": 700,
        "wires": [
            [
                "ec2f807dbbc0c3f4"
            ]
        ]
    },
    {
        "id": "c44682f7751424cf",
        "type": "ui_text",
        "z": "47e2824120b2a9e0",
        "group": "d933d053d66f5444",
        "order": 6,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "front camera",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 1210,
        "y": 660,
        "wires": []
    },
    {
        "id": "c0a81247331a26e9",
        "type": "function",
        "z": "47e2824120b2a9e0",
        "name": "filter data",
        "func": "var originImg = {\n    payload: msg.payload.originImg,\n    topic: \"\"\n};\n\nfunction checkForDataArrays(input) {\n    let result = {};\n\n    // Iterate over each property in the input object\n    for (let key in input) {\n        if (Array.isArray(input[key])) {\n            // Add the array name and its count to the result object\n            result[key] = input[key].length;\n        }\n    }\n\n    // Return the result object if it has any properties, otherwise return null\n    return Object.keys(result).length > 0 ? result : null;\n}\n\nlet result = checkForDataArrays(msg.payload.data);\nif (result != null) {\n    msg.payload = result;\n    originImg.topic = JSON.stringify(result);\n    return [msg, originImg];\n} else {\n    return [null]; // Return null if no arrays are found\n}\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 780,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "88d8ff214f48ece7",
        "type": "function",
        "z": "47e2824120b2a9e0",
        "name": "Create image for Telegram",
        "func": "var TelegramChatIds = global.get(\"TelegramChatIds\");\n\n\n\nmsg.payload = { chatId: TelegramChatIds, type: \"photo\", content: msg.payload, caption: msg.topic};\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1440,
        "y": 740,
        "wires": [
            [
                "95114cabc3339005"
            ]
        ]
    },
    {
        "id": "95114cabc3339005",
        "type": "telegram sender",
        "z": "47e2824120b2a9e0",
        "name": "Alinka bot",
        "bot": "170adc9ec64f9f80",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1660,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "47abe4fc60e4e1ae",
        "type": "image viewer",
        "z": "47e2824120b2a9e0",
        "name": "Camera view detector",
        "width": 160,
        "data": "payload",
        "dataType": "msg",
        "active": true,
        "x": 1660,
        "y": 1020,
        "wires": [
            []
        ]
    },
    {
        "id": "63af9dad70803d6a",
        "type": "function",
        "z": "47e2824120b2a9e0",
        "name": "annotate",
        "func": "function checkForDataArrays(input) {\n    let result = {};\n    for (let key in input) {\n        if (Array.isArray(input[key])) {\n            result[key] = input[key].length;\n        }\n    }\n    return Object.keys(result).length > 0 ? result : null;\n}\n\n\nif (msg.payload.data != null && Object.keys(msg.payload.data).length > 0) {\n\n    msg.annotations = [];\n    msg.payload = msg.payload.originImg;\n    for (let key in msg.payload.data) {\n        if (Array.isArray(msg.payload.data[key])) {\n            msg.payload.data[key].forEach(obj => {\n                msg.annotations.push({\n                    type: \"rect\",\n                    x: obj.x,\n                    y: obj.y,\n                    w: obj.w,\n                    h: obj.h,\n                    stroke: \"red\",\n                    label: key,\n                    probability: obj.prob\n                });\n            });\n        }\n    }\n    msg.topic = checkForDataArrays(msg.payload.data)\n\n\nreturn msg;\n}\n\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1180,
        "y": 1020,
        "wires": [
            [
                "5c93b68cdeb0678f"
            ]
        ]
    },
    {
        "id": "98bcd80fe51e2b3d",
        "type": "function",
        "z": "47e2824120b2a9e0",
        "name": "message",
        "func": "var content = msg.payload;\n// \"chatId\": [\"843873284\", \"584925756\"],\nvar TelegramChatIds = global.get(\"TelegramChatIds\")[0];\n\n\nvar ObjectPayload = {\n    \"chatId\": TelegramChatIds,\n    \"type\": \"message\",\n    \"content\": \"camera front: \" + JSON.stringify(content) // Convert content to a string\n};\nmsg.payload = ObjectPayload;\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1320,
        "y": 300,
        "wires": [
            [
                "e38efc3224e9772c"
            ]
        ]
    },
    {
        "id": "e38efc3224e9772c",
        "type": "rbe",
        "z": "47e2824120b2a9e0",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 1490,
        "y": 300,
        "wires": [
            [
                "d41c11332894c274"
            ]
        ]
    },
    {
        "id": "5a0bcede9b2f95bb",
        "type": "function",
        "z": "47e2824120b2a9e0",
        "name": "filter data",
        "func": "var msg_data = {\n    payload: msg.payload.data,\n    topic: \"text\"\n}\n\nvar msg_image = {\n    payload: msg.payload.originImg,\n    topic: \"image\"\n};\nfunction checkForDataArrays(input) {\n    let result = {};\n    for (let key in input) {\n        if (Array.isArray(input[key])) {\n            result[key] = input[key].length;\n        }\n    }\n    return Object.keys(result).length > 0 ? result : null;\n\n}\n\nlet result = checkForDataArrays(msg_data.payload);\nif (result != null) {\n    msg_data.payload = result;\n    msg_image.topic = JSON.stringify(result);\n    return [msg_data, msg_image];\n} else {\n    msg_data.payload = \"nothing detected\";\n    msg_image.topic = \"nothing detected\";\n    return [null, null];\n}\n\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 340,
        "wires": [
            [
                "98bcd80fe51e2b3d",
                "4517be7281db9072",
                "b0cc2bedc1b68787"
            ],
            [
                "02bb2c609c4f254a",
                "d1afd76befff7d33"
            ]
        ]
    },
    {
        "id": "02bb2c609c4f254a",
        "type": "function",
        "z": "47e2824120b2a9e0",
        "name": "Create image for Telegram",
        "func": "var TelegramChatIds = global.get(\"TelegramChatIds\")[0];\n\n\n\nmsg.payload = { chatId: TelegramChatIds, type: \"photo\", content: msg.payload, caption: msg.topic };\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1560,
        "y": 400,
        "wires": [
            [
                "4305a75aa44524fd"
            ]
        ]
    },
    {
        "id": "4305a75aa44524fd",
        "type": "telegram sender",
        "z": "47e2824120b2a9e0",
        "name": "",
        "bot": "ca786bad.5ac7a8",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1810,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "d1afd76befff7d33",
        "type": "image viewer",
        "z": "47e2824120b2a9e0",
        "name": "Camera view detector",
        "width": 160,
        "data": "payload",
        "dataType": "msg",
        "active": true,
        "x": 1540,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "763258556ff0476b",
        "type": "function",
        "z": "47e2824120b2a9e0",
        "name": "cutimage",
        "func": "let result = msg.payload.data;\nif (result != null && Object.keys(result).length > 0) {\n    msg.payload = result;\n    // node.error(msg.payload);\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "fc5fb9ef18216633",
        "type": "good-object-detection",
        "z": "47e2824120b2a9e0",
        "name": "",
        "returnValue": 0,
        "model": "yolov8n",
        "threshold": 0.5,
        "absolutePathDir": "",
        "x": 940,
        "y": 1020,
        "wires": [
            [
                "63af9dad70803d6a"
            ]
        ]
    },
    {
        "id": "97cfa6434ae1021c",
        "type": "inject",
        "z": "47e2824120b2a9e0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 540,
        "y": 1020,
        "wires": [
            [
                "39cb28a5e74d29d4"
            ]
        ]
    },
    {
        "id": "39cb28a5e74d29d4",
        "type": "file in",
        "z": "47e2824120b2a9e0",
        "name": "read img.jpg",
        "filename": "/data/IMG.jpg",
        "filenameType": "str",
        "format": "",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 730,
        "y": 1020,
        "wires": [
            [
                "fc5fb9ef18216633"
            ]
        ]
    },
    {
        "id": "955a9193feae1567",
        "type": "function",
        "z": "47e2824120b2a9e0",
        "name": "Create image for Telegram",
        "func": "var cId = 843873284;\n\n\n\nmsg.payload = { chatId: cId, type:\"photo\", content:msg.payload, caption:\"Snapshot\"+JSON.stringify(msg.topic)};\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1660,
        "y": 940,
        "wires": [
            [
                "c1d9dc180bad3de2"
            ]
        ]
    },
    {
        "id": "c1d9dc180bad3de2",
        "type": "telegram sender",
        "z": "47e2824120b2a9e0",
        "name": "",
        "bot": "ca786bad.5ac7a8",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1910,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "b4abdbbab8b1a068",
        "type": "function",
        "z": "47e2824120b2a9e0",
        "name": "annotate Example",
        "func": "if (msg.payload.data != null && Object.keys(msg.payload.data).length > 0) {\n    if (msg.payload.data) {\n        msg.annotations = [];\n        msg.payload = msg.payload.originImg;\n        msg.annotations = [\n            {\n                type: \"circle\",\n                x: 50, y: 50, r: 20,\n                lineWidth: 10\n\n            },\n            {\n                type: \"rect\",\n                x: 30, y: 30, w: 40, h: 40,\n                stroke: \"blue\"\n            }\n        ]\n    }\n\n    return msg;\n}\n\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 1100,
        "wires": [
            []
        ]
    },
    {
        "id": "5c93b68cdeb0678f",
        "type": "annotate-image",
        "z": "47e2824120b2a9e0",
        "name": "",
        "fill": "",
        "stroke": "#ffC000",
        "lineWidth": 5,
        "fontSize": 24,
        "fontColor": "#ffC000",
        "x": 1400,
        "y": 1020,
        "wires": [
            [
                "47abe4fc60e4e1ae",
                "955a9193feae1567"
            ]
        ]
    },
    {
        "id": "5e18c7cbf398fdda",
        "type": "mqtt in",
        "z": "47e2824120b2a9e0",
        "name": "",
        "topic": "camera/front",
        "qos": "2",
        "datatype": "auto",
        "broker": "a7804332c06e238f",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 290,
        "y": 740,
        "wires": [
            [
                "0c3744b75951e07b"
            ]
        ]
    },
    {
        "id": "56fb91a6414ddd32",
        "type": "function",
        "z": "47e2824120b2a9e0",
        "name": "create Data",
        "func": "var msg_data = {\n    payload: msg.payload.data,\n    topic: \"text\"\n}\n\nvar msg_image = {\n    payload: msg.payload.originImg,\n    topic: \"image\"\n};\nfunction checkForDataArrays(input) {\n    let result = {};\n    for (let key in input) {\n        if (Array.isArray(input[key])) {\n            result[key] = input[key].length;\n        }\n    }\n    return Object.keys(result).length > 0 ? result : null;\n\n}\n\nlet result = checkForDataArrays(msg_data.payload);\nif (result != null) {\n    msg_data.payload = result;\n    msg_image.topic = JSON.stringify(result);\n} else {\n    msg_data.payload = \"nothing detected\";\n    msg_image.topic = \"nothing detected\";\n}\n\nreturn [msg_data, msg_image];",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "7ff3e570548d8d87",
                "c44682f7751424cf"
            ],
            [
                "88d8ff214f48ece7",
                "53b88a16c65bd4af"
            ]
        ]
    },
    {
        "id": "53b88a16c65bd4af",
        "type": "image viewer",
        "z": "47e2824120b2a9e0",
        "name": "Camera view detector",
        "width": 160,
        "data": "payload",
        "dataType": "msg",
        "active": true,
        "x": 1440,
        "y": 780,
        "wires": [
            []
        ]
    },
    {
        "id": "866d7c3685924c66",
        "type": "inject",
        "z": "47e2824120b2a9e0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 280,
        "y": 640,
        "wires": [
            [
                "0c3744b75951e07b"
            ]
        ]
    },
    {
        "id": "7682a3f9e0bd1694",
        "type": "http in",
        "z": "47e2824120b2a9e0",
        "name": "",
        "url": "/myroomcamera",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 300,
        "y": 420,
        "wires": [
            [
                "7df1bdd34f900e31"
            ]
        ]
    },
    {
        "id": "793f39abe9f8cda8",
        "type": "change",
        "z": "47e2824120b2a9e0",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "headers",
                "pt": "msg",
                "to": "{\"content-type\":\"image/png\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1450,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "b0cc2bedc1b68787",
        "type": "http response",
        "z": "47e2824120b2a9e0",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 1500,
        "y": 220,
        "wires": []
    },
    {
        "id": "b1163c3636f82954",
        "type": "mqtt in",
        "z": "47e2824120b2a9e0",
        "name": "",
        "topic": "camera/myroom",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "a7804332c06e238f",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 280,
        "y": 240,
        "wires": [
            [
                "7df1bdd34f900e31"
            ]
        ]
    },
    {
        "id": "b40fa0f0d65a204e",
        "type": "file",
        "z": "47e2824120b2a9e0",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1060,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "4583c5f156b24838",
        "type": "function",
        "z": "47e2824120b2a9e0",
        "name": "generatefilename",
        "func": "\n\n// Получение текущей даты и времени\nvar now = new Date();\nvar year = now.getFullYear();\nvar month = (\"0\" + (now.getMonth() + 1)).slice(-2);\nvar day = (\"0\" + now.getDate()).slice(-2);\nvar hour = (\"0\" + now.getHours()).slice(-2);\nvar minute = (\"0\" + now.getMinutes()).slice(-2);\nvar second = (\"0\" + now.getSeconds()).slice(-2);\n\n// Формирование имени файла\nvar filename = year + month + day + \"_\" + hour + minute + second + \".jpg\";\n\n// Путь к файлу\nvar filepath = '/data/camerashoots/myroom/' + filename;\n\nmsg.filename = filepath\n// Возвращаем сообщение для дальнейшей обработки\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 100,
        "wires": [
            [
                "b40fa0f0d65a204e"
            ]
        ]
    },
    {
        "id": "4ee01d95e0d70df1",
        "type": "image viewer",
        "z": "47e2824120b2a9e0",
        "name": "view",
        "width": 160,
        "data": "payload",
        "dataType": "msg",
        "active": true,
        "x": 810,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "e71e04b73366529d",
        "type": "file",
        "z": "47e2824120b2a9e0",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1100,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "0fe980fc2f64cdc1",
        "type": "function",
        "z": "47e2824120b2a9e0",
        "name": "generatefilename",
        "func": "\n\n// Получение текущей даты и времени\nvar now = new Date();\nvar year = now.getFullYear();\nvar month = (\"0\" + (now.getMonth() + 1)).slice(-2);\nvar day = (\"0\" + now.getDate()).slice(-2);\nvar hour = (\"0\" + now.getHours()).slice(-2);\nvar minute = (\"0\" + now.getMinutes()).slice(-2);\nvar second = (\"0\" + now.getSeconds()).slice(-2);\n\n// Формирование имени файла\nvar filename = year + month + day + \"_\" + hour + minute + second + \".jpg\";\n\n// Путь к файлу\nvar filepath = '/data/camerashoots/camerafront/' + filename;\n\nmsg.filename = filepath\n// Возвращаем сообщение для дальнейшей обработки\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 920,
        "wires": [
            [
                "e71e04b73366529d"
            ]
        ]
    },
    {
        "id": "88cee15f39447d53",
        "type": "ui_chart",
        "z": "47e2824120b2a9e0",
        "name": "",
        "group": "f027919d2a75152b",
        "order": 9,
        "width": 0,
        "height": 0,
        "label": "move detection",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "1",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "86400",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#2177b5",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 1200,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "3cf004cc123213e4",
        "type": "function",
        "z": "47e2824120b2a9e0",
        "name": "msg payload",
        "func": "msg.payload = 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 240,
        "wires": [
            [
                "88cee15f39447d53"
            ]
        ]
    },
    {
        "id": "7b8b57b6fd86e466",
        "type": "delay",
        "z": "47e2824120b2a9e0",
        "name": "",
        "pauseType": "delay",
        "timeout": "500",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 750,
        "y": 180,
        "wires": [
            [
                "98f45d8791d3185c"
            ]
        ]
    },
    {
        "id": "98f45d8791d3185c",
        "type": "change",
        "z": "47e2824120b2a9e0",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 970,
        "y": 180,
        "wires": [
            [
                "88cee15f39447d53"
            ]
        ]
    },
    {
        "id": "0c77107bad11e9ca",
        "type": "delay",
        "z": "47e2824120b2a9e0",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 730,
        "y": 140,
        "wires": [
            [
                "1865a57ac346c432"
            ]
        ]
    },
    {
        "id": "1865a57ac346c432",
        "type": "change",
        "z": "47e2824120b2a9e0",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 970,
        "y": 140,
        "wires": [
            [
                "88cee15f39447d53"
            ]
        ]
    },
    {
        "id": "95ff1632.6243b8",
        "type": "telegram sender",
        "z": "d2d769b0.c57da8",
        "name": "sender",
        "bot": "170adc9ec64f9f80",
        "haserroroutput": false,
        "outputs": 1,
        "x": 770,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "92568c50.87034",
        "type": "telegram receiver",
        "z": "d2d769b0.c57da8",
        "name": "",
        "bot": "ca786bad.5ac7a8",
        "saveDataDir": "",
        "filterCommands": false,
        "x": 130,
        "y": 220,
        "wires": [
            [
                "f8e08d57.743f4",
                "f9bd0ea73fb5b228"
            ],
            []
        ]
    },
    {
        "id": "fca261f6.1b4e6",
        "type": "catch",
        "z": "d2d769b0.c57da8",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 120,
        "y": 360,
        "wires": [
            [
                "a1b079ea.70ea18"
            ]
        ]
    },
    {
        "id": "2e8b7a81.d0b546",
        "type": "telegram sender",
        "z": "d2d769b0.c57da8",
        "d": true,
        "name": "Error",
        "bot": "ca786bad.5ac7a8",
        "haserroroutput": false,
        "outputs": 1,
        "x": 410,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "72b99f41.af20b",
        "type": "function",
        "z": "d2d769b0.c57da8",
        "d": true,
        "name": "message",
        "func": "var content = msg.topic + \" payload:\" + msg.payload;\ncontent = \"smart home loaded\"\nvar TelegramChatIds = global.get(\"TelegramChatIds\");\nvar ObjectPayload = {\n    \"chatId\": TelegramChatIds,\n    \"type\": \"message\",\n    \"content\": content\n}\n\nmsg.payload = ObjectPayload;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 100,
        "wires": [
            [
                "95ff1632.6243b8",
                "e818309d9e9d7308"
            ]
        ]
    },
    {
        "id": "6d3ac462.a2e47c",
        "type": "inject",
        "z": "d2d769b0.c57da8",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 100,
        "wires": [
            [
                "9138f065.10c7"
            ]
        ]
    },
    {
        "id": "a1b079ea.70ea18",
        "type": "function",
        "z": "d2d769b0.c57da8",
        "name": "message",
        "func": "var content = msg.topic+\" payload:\"+msg.payload;\nvar ObjectPayload={\n    \"chatId\": \"843873284\",\n    \"type\": \"message\",\n    \"content\":content \n}\nmsg.payload=ObjectPayload;\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 280,
        "y": 360,
        "wires": [
            [
                "2e8b7a81.d0b546"
            ]
        ]
    },
    {
        "id": "f8e08d57.743f4",
        "type": "function",
        "z": "d2d769b0.c57da8",
        "d": true,
        "name": "reply telegram",
        "func": "//var content = msg.topic+\" payload:\"+msg.payload;\nvar msg_get_ip=null;\nvar payoladmsg = (msg.payload);\n\nvar content_that_Object ={payload: payoladmsg.content};\nvar content_send;\n\nif (content_that_Object.payload==\"ip\"){\n   content_send= context.get ('ip');\n   \n    var ObjectPayload={\n        \"chatId\": [\"843873284\", \"584925756\"],\n        \"type\": \"message\",\n        \"content\":content_send \n    }\n    \n    msg.payload=ObjectPayload;\n    \n    msg_get_ip={\n        \"topic\":1,\n        \"payload\":1\n    }\n    msg=null;\n}\n\n\n\n\n\n\nreturn [msg,msg_get_ip];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 180,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "9138f065.10c7",
        "type": "change",
        "z": "d2d769b0.c57da8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "TelegramChatIds",
                "pt": "global",
                "to": "[\"843873284\",\"584925756\"]",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "TelegramChatIds",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 100,
        "wires": [
            [
                "72b99f41.af20b"
            ]
        ]
    },
    {
        "id": "6172b419c2fe9006",
        "type": "telegram sender",
        "z": "d2d769b0.c57da8",
        "name": "sender",
        "bot": "ca786bad.5ac7a8",
        "haserroroutput": false,
        "outputs": 1,
        "x": 590,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "f9bd0ea73fb5b228",
        "type": "function",
        "z": "d2d769b0.c57da8",
        "d": true,
        "name": "reverse message back",
        "func": "var ObjectPayload={\n    \"chatId\": msg.originalMessage.chat.id,\n    \"type\": \"message\",\n    \"content\": JSON.stringify(\"chatId:\" + msg.originalMessage.chat.id) \n}\nmsg.payload=ObjectPayload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 220,
        "wires": [
            [
                "6172b419c2fe9006"
            ]
        ]
    },
    {
        "id": "e818309d9e9d7308",
        "type": "debug",
        "z": "d2d769b0.c57da8",
        "name": "debug 3",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 780,
        "y": 40,
        "wires": []
    },
    {
        "id": "31914d7f1df11b2e",
        "type": "inject",
        "z": "d2d769b0.c57da8",
        "name": "",
        "props": [
            {
                "p": "payload",
                "v": "",
                "vt": "date"
            },
            {
                "p": "topic",
                "v": "",
                "vt": "str"
            }
        ],
        "repeat": "86400",
        "crontab": "",
        "once": true,
        "onceDelay": "30",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 520,
        "wires": [
            [
                "72af64b1b61356ba"
            ]
        ]
    },
    {
        "id": "72af64b1b61356ba",
        "type": "http request",
        "z": "d2d769b0.c57da8",
        "name": "IP",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://api.ipify.org?format=json",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 290,
        "y": 520,
        "wires": [
            [
                "416feb9b988ef2e6"
            ]
        ]
    },
    {
        "id": "197138408b6055d7",
        "type": "telegram sender",
        "z": "d2d769b0.c57da8",
        "name": "sender",
        "bot": "ca786bad.5ac7a8",
        "haserroroutput": false,
        "outputs": 1,
        "x": 630,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "416feb9b988ef2e6",
        "type": "function",
        "z": "d2d769b0.c57da8",
        "name": "message",
        "func": "var thatIP = msg.payload.ip;\n\nvar storedIP = context.get('ip') || 0;\nif (storedIP !== thatIP) {\n    context.set(\"ip\", thatIP);\n    msg.payload = \"http://\" + thatIP + \":1880/ui\";\n}\nelse {\n    return null;\n}\nif (thatIP === undefined) {\n    return null;\n}\n\n\nvar content = msg.payload;\nvar TelegramChatIds = global.get(\"TelegramChatIds\")[0];\n\nvar ObjectPayload = {\n    \"chatId\": TelegramChatIds,\n    \"type\": \"message\",\n    \"content\": JSON.stringify(content) // Convert content to a string\n};\nmsg.payload = ObjectPayload;\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 520,
        "wires": [
            [
                "197138408b6055d7"
            ]
        ]
    },
    {
        "id": "f2334125f861be3e",
        "type": "http request",
        "z": "d2d769b0.c57da8",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://192.168.1.160:11500/chat",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 690,
        "y": 720,
        "wires": [
            [
                "ca69743dcc655799"
            ]
        ]
    },
    {
        "id": "ba897e7672fa2150",
        "type": "function",
        "z": "d2d769b0.c57da8",
        "name": "payload",
        "func": "function retriveValues() {\n    var keys = [\"storedValues\"];\n    var retrievedValues = {};\n\n    keys.forEach(function (key) {\n        retrievedValues[key] = global.get(key) || { description: key, value: \"Not set\" };\n    });\n\n    return JSON.stringify(retrievedValues.storedValues);\n}\n\nmsg.payload = JSON.stringify(\n    {\n        \"messages\": [\n            {\n                \"role\": \"system\",\n                \"content\": \"You are an AI, you have some initial input of home devices stats ```json\" + retriveValues() + \"```provide short answer\"\n            },\n            {\n                \"role\": \"user\",\n                \"content\": \"|||Previous messages, to understand conext:\" + msg.payload.history + \"||| actual input from user:|||\" + msg.payload.content  +\"||| provide short answer ||| answer on a language user asks, do not write your thinking\"\n            }\n        ],\n        \"model\": \"nvidia/llama-3.1-nemotron-70b-instruct:free\"\n    }\n);\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 720,
        "wires": [
            [
                "f2334125f861be3e"
            ]
        ]
    },
    {
        "id": "c48b17bbe732db28",
        "type": "telegram receiver",
        "z": "d2d769b0.c57da8",
        "name": "",
        "bot": "ca786bad.5ac7a8",
        "saveDataDir": "",
        "filterCommands": false,
        "x": 110,
        "y": 720,
        "wires": [
            [
                "46efd3259ec4edb9"
            ],
            []
        ]
    },
    {
        "id": "d287173c2dabc345",
        "type": "telegram sender",
        "z": "d2d769b0.c57da8",
        "name": "sender",
        "bot": "ca786bad.5ac7a8",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1070,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "ca69743dcc655799",
        "type": "function",
        "z": "d2d769b0.c57da8",
        "name": "message",
        "func": "var content = msg.payload;\nvar TelegramChatIds = global.get(\"TelegramChatIds\")[0];\n\n// Parse the JSON content to extract the \"text\" field\nvar parsedContent = JSON.parse(content);\nvar textContent = parsedContent.text;\n\nvar ObjectPayload = {\n    \"chatId\": TelegramChatIds,\n    \"type\": \"message\",\n    \"content\": textContent\n};\n\nmsg.payload = ObjectPayload;\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 900,
        "y": 720,
        "wires": [
            [
                "d287173c2dabc345"
            ]
        ]
    },
    {
        "id": "46efd3259ec4edb9",
        "type": "function",
        "z": "d2d769b0.c57da8",
        "name": "save history",
        "func": "// Retrieve the history of inputs from global context\nlet history = global.get('inputHistory') || [];\n\n// Get the current input from the message payload\nlet currentInput = msg.payload.content;\n\n// Add the current input to the history array\nhistory.push(currentInput);\n\n// Update the global context with the new history\nglobal.set('inputHistory', history);\n\nlet previousInputsString = history.slice(0, -1).join(\"\\n\");\n\n// Ensure the actual input text is treated as a string\nlet actualInputText = currentInput;\n\n// Prepare the output payload\nmsg.payload.content = {\n    \"previous text inputs\": previousInputsString, // All elements except the last one\n    \"actual input text\": actualInputText // The last element\n};\n\nmsg.payload.history = previousInputsString //: actualInputText // The last element\nmsg.payload.content = actualInputText;\n// Return the message\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 720,
        "wires": [
            [
                "ba897e7672fa2150"
            ]
        ]
    },
    {
        "id": "c094f1214166e433",
        "type": "mqtt in",
        "z": "ca3d3fb4de74fc4f",
        "name": "",
        "topic": "camera/front/cat-image",
        "qos": "2",
        "datatype": "auto",
        "broker": "a7804332c06e238f",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 220,
        "y": 220,
        "wires": [
            [
                "2726137ef90a1f95",
                "291702e0ff462450"
            ]
        ]
    },
    {
        "id": "2726137ef90a1f95",
        "type": "image viewer",
        "z": "ca3d3fb4de74fc4f",
        "name": "Camera view detector",
        "width": 160,
        "data": "payload",
        "dataType": "msg",
        "active": true,
        "x": 520,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "c5cc823fa5b872ac",
        "type": "mqtt in",
        "z": "ca3d3fb4de74fc4f",
        "name": "",
        "topic": "camera/front/alinka-image",
        "qos": "2",
        "datatype": "auto",
        "broker": "a7804332c06e238f",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 230,
        "y": 280,
        "wires": [
            [
                "13c6f15136d03daa",
                "291702e0ff462450"
            ]
        ]
    },
    {
        "id": "13c6f15136d03daa",
        "type": "image viewer",
        "z": "ca3d3fb4de74fc4f",
        "name": "Camera view detector",
        "width": 160,
        "data": "payload",
        "dataType": "msg",
        "active": true,
        "x": 500,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "291702e0ff462450",
        "type": "function",
        "z": "ca3d3fb4de74fc4f",
        "name": "Create image for Telegram",
        "func": "var TelegramChatIds = global.get(\"TelegramChatIds\");\n\n\n\nmsg.payload = { chatId: TelegramChatIds, type: \"photo\", content: msg.payload, caption: msg.topic};\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 280,
        "wires": [
            [
                "62e298fc09687353"
            ]
        ]
    },
    {
        "id": "62e298fc09687353",
        "type": "telegram sender",
        "z": "ca3d3fb4de74fc4f",
        "name": "Alinka bot",
        "bot": "170adc9ec64f9f80",
        "haserroroutput": false,
        "outputs": 1,
        "x": 780,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "7bc1fdd740a684a6",
        "type": "http request",
        "z": "d10b6744b70a9f6d",
        "d": true,
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://192.168.1.160:11500/chat",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 450,
        "y": 140,
        "wires": [
            [
                "bec2630c3be51374"
            ]
        ]
    },
    {
        "id": "e5448d8f8c89111b",
        "type": "function",
        "z": "d10b6744b70a9f6d",
        "d": true,
        "name": "payload",
        "func": "function retriveValues() {\n    var keys = [\"storedValues\"];\n    var retrievedValues = {};\n\n    keys.forEach(function (key) {\n        retrievedValues[key] = global.get(key) || { description: key, value: \"Not set\" };\n    });\n\n    return JSON.stringify(retrievedValues.storedValues);\n}\n\n\nmsg.payload = JSON.stringify(\n    {\n        \"messages\": [\n            {\n                \"role\": \"system\",\n                \"content\": \"You are an AI that strictly returns responses in valid JSON format. input to you: ```json\" + retriveValues() + \"```\"\n            },\n            {\n                \"role\": \"user\",\n                \"content\": \"you an AI assistant in smart home, you have some payload of objects controlled remotely, based on provided input, you have to decide which if them needs to be controlled\"\n            }\n        ],\n        \"model\": \"nvidia/llama-3.1-nemotron-70b-instruct:free\"\n    }\n);\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 140,
        "wires": [
            [
                "7bc1fdd740a684a6",
                "79bbce7f92a89d38"
            ]
        ]
    },
    {
        "id": "3819eee374404559",
        "type": "inject",
        "z": "d10b6744b70a9f6d",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 140,
        "wires": [
            [
                "e5448d8f8c89111b"
            ]
        ]
    },
    {
        "id": "bec2630c3be51374",
        "type": "debug",
        "z": "d10b6744b70a9f6d",
        "d": true,
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 140,
        "wires": []
    },
    {
        "id": "0a803a0c1f15e6bc",
        "type": "http request",
        "z": "d10b6744b70a9f6d",
        "d": true,
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://192.168.1.160:11500",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 450,
        "y": 220,
        "wires": [
            [
                "4897306c6fab8876"
            ]
        ]
    },
    {
        "id": "e49c81bd046c9308",
        "type": "inject",
        "z": "d10b6744b70a9f6d",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 220,
        "wires": [
            [
                "0a803a0c1f15e6bc"
            ]
        ]
    },
    {
        "id": "4897306c6fab8876",
        "type": "debug",
        "z": "d10b6744b70a9f6d",
        "d": true,
        "name": "debug 2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 220,
        "wires": []
    },
    {
        "id": "c33440d41f076cfa",
        "type": "inject",
        "z": "d10b6744b70a9f6d",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 260,
        "y": 380,
        "wires": [
            [
                "fd2b90dfe2b4eb63"
            ]
        ]
    },
    {
        "id": "fd2b90dfe2b4eb63",
        "type": "function",
        "z": "d10b6744b70a9f6d",
        "d": true,
        "name": "function 1",
        "func": "// Get all flow variables  \nlet flowKeys = flow.keys();\nlet flowValues = {};\nflowKeys.forEach(key => {\n    flowValues[key] = flow.get(key);\n});\n\n// Get all global variables  \nlet globalKeys = global.keys();\nlet globalValues = {};\nglobalKeys.forEach(key => {\n    globalValues[key] = global.get(key);\n});\n\n// Send the retrieved values as output  \nmsg.payload = {\n    flowVariables: flowValues,\n    globalVariables: globalValues\n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 380,
        "wires": [
            [
                "f7019058255df373"
            ]
        ]
    },
    {
        "id": "f7019058255df373",
        "type": "debug",
        "z": "d10b6744b70a9f6d",
        "d": true,
        "name": "debug 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 380,
        "wires": []
    },
    {
        "id": "3f9022e8ea5d98bc",
        "type": "inject",
        "z": "d10b6744b70a9f6d",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 260,
        "y": 480,
        "wires": [
            [
                "b6a024376eec1653"
            ]
        ]
    },
    {
        "id": "b6a024376eec1653",
        "type": "function",
        "z": "d10b6744b70a9f6d",
        "d": true,
        "name": "function 2",
        "func": "var allFlow = flow.keys();\nvar allFlowValues = {};\nallFlow.forEach(key => {\n    allFlowValues[key] = flow.get(key);\n});\nreturn { payload: allFlowValues };\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 480,
        "wires": [
            [
                "22ab953b4bf8e794"
            ]
        ]
    },
    {
        "id": "22ab953b4bf8e794",
        "type": "debug",
        "z": "d10b6744b70a9f6d",
        "d": true,
        "name": "debug 5",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 480,
        "wires": []
    },
    {
        "id": "79bbce7f92a89d38",
        "type": "debug",
        "z": "d10b6744b70a9f6d",
        "d": true,
        "name": "debug 8",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 100,
        "wires": []
    },
    {
        "id": "f02311ac.c8019",
        "type": "http request",
        "z": "81965ae3.dd08a8",
        "name": "теплый пол",
        "method": "GET",
        "ret": "obj",
        "paytoqs": false,
        "url": "http://192.168.1.111/sendAJAX?json={%22t%22:127,%22v%22:0}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 390,
        "y": 180,
        "wires": [
            [
                "8c360f8d.a7efe",
                "f7f494e6.d6dec8"
            ]
        ]
    },
    {
        "id": "8c360f8d.a7efe",
        "type": "function",
        "z": "81965ae3.dd08a8",
        "name": "теплый пол",
        "func": "var parsed =(msg.payload);\nvar stat0 ={payload: parsed.stat[0]};//батарея балкон\nvar stat1 ={payload: parsed.stat[1]};//насос\nvar stat2 ={payload: parsed.stat[2]};//кухня\nvar stat3 ={payload: parsed.stat[3]};//температура\nvar stat4 ={payload: parsed.stat[4]};//коридор\nvar stat5 ={payload: parsed.stat[5]};//комната1\nvar stat6 ={payload: parsed.stat[6]};//комната2\nvar stat7 ={payload: parsed.stat[7]};//балкон\nreturn [ stat0, stat1, stat2, stat3, stat4,stat5,stat6,stat7 ];",
        "outputs": 8,
        "noerr": 0,
        "x": 570,
        "y": 200,
        "wires": [
            [
                "f4d4155f.185418"
            ],
            [
                "b2470924.3d1688"
            ],
            [
                "94e3cba2.a20498"
            ],
            [
                "62054911.675008"
            ],
            [
                "6e48c23a.b0701c"
            ],
            [
                "da5fb0a7.8c545"
            ],
            [
                "d7f8c4fb.ea6ad8"
            ],
            [
                "49ca05d9.483c5c"
            ]
        ]
    },
    {
        "id": "d764a357.0ba21",
        "type": "http request",
        "z": "81965ae3.dd08a8",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "http://192.168.1.111/sendAJAX?json={%22t%22:0,%22v%22:{{payload}}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1030,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "f4d4155f.185418",
        "type": "ui_switch",
        "z": "81965ae3.dd08a8",
        "name": "",
        "label": "батарея балкон",
        "tooltip": "",
        "group": "6ed8da82.791bd4",
        "order": 1,
        "width": "0",
        "height": "0",
        "passthru": true,
        "decouple": "false",
        "topic": "testTopic",
        "style": "",
        "onvalue": "0",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "x": 800,
        "y": 140,
        "wires": [
            [
                "d764a357.0ba21"
            ]
        ]
    },
    {
        "id": "b2470924.3d1688",
        "type": "ui_switch",
        "z": "81965ae3.dd08a8",
        "name": "",
        "label": "насос",
        "tooltip": "",
        "group": "6ed8da82.791bd4",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "0",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "x": 770,
        "y": 160,
        "wires": [
            [
                "e4ea292.acec6d8"
            ]
        ]
    },
    {
        "id": "e4ea292.acec6d8",
        "type": "http request",
        "z": "81965ae3.dd08a8",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "http://192.168.1.111/sendAJAX?json={%22t%22:1,%22v%22:{{payload}}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1030,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "4bb63ff0.33de7",
        "type": "http request",
        "z": "81965ae3.dd08a8",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "http://192.168.1.111/sendAJAX?json={%22t%22:2,%22v%22:{{payload}}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1030,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "94e3cba2.a20498",
        "type": "ui_switch",
        "z": "81965ae3.dd08a8",
        "name": "",
        "label": "кухня",
        "tooltip": "",
        "group": "6ed8da82.791bd4",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "testTopic",
        "style": "",
        "onvalue": "0",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "x": 770,
        "y": 180,
        "wires": [
            [
                "4bb63ff0.33de7"
            ]
        ]
    },
    {
        "id": "e7a46c71.fc4af",
        "type": "http request",
        "z": "81965ae3.dd08a8",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "http://192.168.1.111/sendAJAX?json={%22t%22:4,%22v%22:{{payload}}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1030,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "6e48c23a.b0701c",
        "type": "ui_switch",
        "z": "81965ae3.dd08a8",
        "name": "",
        "label": "коридор",
        "tooltip": "",
        "group": "6ed8da82.791bd4",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "testTopic",
        "style": "",
        "onvalue": "0",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "x": 780,
        "y": 220,
        "wires": [
            [
                "e7a46c71.fc4af"
            ]
        ]
    },
    {
        "id": "da5fb0a7.8c545",
        "type": "ui_switch",
        "z": "81965ae3.dd08a8",
        "name": "",
        "label": "комната1",
        "tooltip": "",
        "group": "6ed8da82.791bd4",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "0",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "x": 780,
        "y": 240,
        "wires": [
            [
                "d86230d9.11cec"
            ]
        ]
    },
    {
        "id": "d86230d9.11cec",
        "type": "http request",
        "z": "81965ae3.dd08a8",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "http://192.168.1.111/sendAJAX?json={%22t%22:5,%22v%22:{{payload}}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1030,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "727b90e1.19a7d",
        "type": "http request",
        "z": "81965ae3.dd08a8",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "http://192.168.1.111/sendAJAX?json={%22t%22:6,%22v%22:{{payload}}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1030,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "d7f8c4fb.ea6ad8",
        "type": "ui_switch",
        "z": "81965ae3.dd08a8",
        "name": "",
        "label": "комната2",
        "tooltip": "",
        "group": "6ed8da82.791bd4",
        "order": 6,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "testTopic",
        "style": "",
        "onvalue": "0",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "x": 780,
        "y": 260,
        "wires": [
            [
                "727b90e1.19a7d"
            ]
        ]
    },
    {
        "id": "49ca05d9.483c5c",
        "type": "ui_switch",
        "z": "81965ae3.dd08a8",
        "name": "",
        "label": "балкон",
        "tooltip": "",
        "group": "6ed8da82.791bd4",
        "order": 8,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "0",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "x": 780,
        "y": 280,
        "wires": [
            [
                "a907f66e.c1e888"
            ]
        ]
    },
    {
        "id": "a907f66e.c1e888",
        "type": "http request",
        "z": "81965ae3.dd08a8",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "http://192.168.1.111/sendAJAX?json={%22t%22:7,%22v%22:{{payload}}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1030,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "8cdeb8d8.999788",
        "type": "debug",
        "z": "81965ae3.dd08a8",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 930,
        "y": 340,
        "wires": []
    },
    {
        "id": "1c3bd674.a8d83a",
        "type": "inject",
        "z": "81965ae3.dd08a8",
        "name": "в 20:00",
        "repeat": "",
        "crontab": "00 20 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "1",
        "payloadType": "num",
        "x": 520,
        "y": 300,
        "wires": [
            [
                "da5fb0a7.8c545"
            ]
        ]
    },
    {
        "id": "c31e5aa8.33da98",
        "type": "inject",
        "z": "81965ae3.dd08a8",
        "name": "в 05:00",
        "repeat": "",
        "crontab": "0 5-18 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "0",
        "payloadType": "num",
        "x": 520,
        "y": 340,
        "wires": [
            [
                "a18f6f3f.96df2"
            ]
        ]
    },
    {
        "id": "a18f6f3f.96df2",
        "type": "function",
        "z": "81965ae3.dd08a8",
        "name": "check temp outer",
        "func": "var temp_outer= {payload:(global.get('temp_outer'))};\nvar set_outer_temp=global.get('temp_outside_slider');\nvar info={\n    \"topic\":\"warm_floor\",\n    \"payload\":\"теплый пол не включен из-за температуры снаружи:\" + temp_outer.payload + \" установленная температура:\" + set_outer_temp + \"\"\n};\nif (global.get(\"temp_outer_message\")===0){\n    info=null;\n}\nif (temp_outer.payload>set_outer_temp){//если температура больше 10 то отключать теплый пол\n    msg.payload=1;\n    msg.topic=\"warm_floor\";\n    global.set(\"temp_outer_message\",1);\n// global.set(\"temp_outer\",GlobalTemp);\n// msg.payload = global.get(\"Temp\");\n}else{\n    msg.payload=0;\n    info=null;\n}\n\nreturn [msg,info];",
        "outputs": 2,
        "noerr": 0,
        "x": 710,
        "y": 340,
        "wires": [
            [
                "8cdeb8d8.999788",
                "d7f8c4fb.ea6ad8",
                "da5fb0a7.8c545",
                "6e48c23a.b0701c",
                "94e3cba2.a20498",
                "b2470924.3d1688",
                "49ca05d9.483c5c"
            ],
            [
                "72f1b51c.7e504c"
            ]
        ]
    },
    {
        "id": "5e8604b7.d91a1c",
        "type": "telegram sender",
        "z": "81965ae3.dd08a8",
        "name": "sender",
        "bot": "ca786bad.5ac7a8",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1030,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "72f1b51c.7e504c",
        "type": "function",
        "z": "81965ae3.dd08a8",
        "name": "message",
        "func": "var content = msg.topic+\" :\"+msg.payload;\nif (msg.payload===null){return;}\nvar TelegramChatIds = global.get(\"TelegramChatIds\");\nvar ObjectPayload={\n    \"chatId\": TelegramChatIds,\n    \"type\": \"message\",\n    \"content\":content \n}\nmsg.payload=ObjectPayload;\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 900,
        "y": 380,
        "wires": [
            [
                "5e8604b7.d91a1c"
            ]
        ]
    },
    {
        "id": "45bfc2d4.4b0aec",
        "type": "ui_slider",
        "z": "81965ae3.dd08a8",
        "name": "outside_temp",
        "label": "порог температуры снаружи",
        "tooltip": "порог температуры воздуха снаружи, при которой включается теплый пол {{global.get('temp_outer')}}",
        "group": "7caf40b8.ebe01",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "set_outside_temp",
        "min": 0,
        "max": "25",
        "step": 1,
        "x": 1380,
        "y": 300,
        "wires": [
            [
                "ce15cff2.e9314"
            ]
        ]
    },
    {
        "id": "ce15cff2.e9314",
        "type": "change",
        "z": "81965ae3.dd08a8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "temp_outside_slider",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1430,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "8dca860d.33d308",
        "type": "change",
        "z": "81965ae3.dd08a8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "temp_outside_slider",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1380,
        "y": 260,
        "wires": [
            [
                "45bfc2d4.4b0aec"
            ]
        ]
    },
    {
        "id": "cfa31919.293f38",
        "type": "inject",
        "z": "81965ae3.dd08a8",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1210,
        "y": 260,
        "wires": [
            [
                "8dca860d.33d308"
            ]
        ]
    },
    {
        "id": "f7f494e6.d6dec8",
        "type": "function",
        "z": "81965ae3.dd08a8",
        "name": "Error",
        "func": "msg.payload = msg.payload+\"\";\nif (msg.payload.startsWith(\"Error:\")){\n\nvar content = msg.topic+\" :\"+msg.payload;\nvar TelegramChatIds = global.get(\"TelegramChatIds\");\nvar ObjectPayload={\n    \"chatId\": TelegramChatIds,\n    \"type\": \"message\",\n    \"content\":content \n}\nmsg.payload=ObjectPayload;\n\n    var nowDate = new Date();\n    var Hour = nowDate.getHours();\n    if ((Hour>2)&&(Hour<6)){\n        return null;\n    }\nreturn msg;\n}\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 310,
        "y": 240,
        "wires": [
            [
                "a84256d.760f5a8"
            ]
        ]
    },
    {
        "id": "a84256d.760f5a8",
        "type": "rbe",
        "z": "81965ae3.dd08a8",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 430,
        "y": 240,
        "wires": [
            [
                "1aa667d0.92ab88"
            ]
        ]
    },
    {
        "id": "1aa667d0.92ab88",
        "type": "telegram sender",
        "z": "81965ae3.dd08a8",
        "name": "sender",
        "bot": "ca786bad.5ac7a8",
        "haserroroutput": false,
        "outputs": 1,
        "x": 550,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "26c3771.2ad2388",
        "type": "inject",
        "z": "81965ae3.dd08a8",
        "name": "",
        "repeat": "10",
        "crontab": "",
        "once": true,
        "onceDelay": "60",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 160,
        "wires": [
            [
                "f02311ac.c8019"
            ]
        ]
    },
    {
        "id": "62054911.675008",
        "type": "ui_text",
        "z": "81965ae3.dd08a8",
        "group": "4a84c495.0fce7c",
        "order": 5,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "теплый пол",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 790,
        "y": 200,
        "wires": []
    },
    {
        "id": "77675f42.b01e6",
        "type": "http request",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "192.168.1.110/sendAJAX?json={\"t\":7,\"v\":0}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1210,
        "y": 340,
        "wires": [
            [
                "caaab49f.00b618"
            ]
        ]
    },
    {
        "id": "d0a0f55b.f34a48",
        "type": "http request",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "включить свет",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1160,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "73b123a9.7a039c",
        "type": "switch",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "дет внутри",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 810,
        "y": 380,
        "wires": [
            [
                "710a0cfd.9b6084",
                "7ff3c529.78e03c"
            ],
            []
        ]
    },
    {
        "id": "2ba1d512.35030a",
        "type": "function",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "двери",
        "func": "\nfunction returnTrueFalse(message_input_value){\n    if (message_input_value == 1){\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n\nvar parsed =(msg.payload);\nvar stat0 ={payload: parsed.stat[0],topic:\"открытие двери\"};//открытие двери\nvar stat1 ={payload: parsed.stat[1]};//звонок\nvar stat2 ={payload: parsed.stat[2]};//детектор движения\nvar stat3 ={payload: parsed.stat[3]};//3 - домофон питание\nvar stat4 ={payload: parsed.stat[4]};//домофон вкл D4\nvar stat5 ={payload: parsed.stat[5]};//замок D3\nvar stat6 ={payload: parsed.stat[6]};///мощность\n//var stat7 ={payload: returnTrueFalse(parsed.stat[7])};///свет D6\nvar stat7 ={payload: parsed.stat[7]};///свет D6\n\nvar stat8 ={payload: parsed.stat[8],topic:\"детектор внутри\"};\n\nreturn [ stat0, stat1, stat2 , stat3 , stat4 , stat5 , stat6, stat7 , stat8 ];\n\n",
        "outputs": 9,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 240,
        "wires": [
            [
                "e9876976.3e6738"
            ],
            [
                "c26ba1e0.a9fb"
            ],
            [
                "3a65dada.6bd4a6"
            ],
            [],
            [],
            [],
            [],
            [
                "69920448.0b3e6c"
            ],
            [
                "201a139.6ac00ec"
            ]
        ]
    },
    {
        "id": "3ddbc6cc.585d1a",
        "type": "inject",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "10",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 120,
        "wires": [
            [
                "1c79d414.eb201c"
            ]
        ]
    },
    {
        "id": "1c79d414.eb201c",
        "type": "http request",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "двери",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://192.168.1.110/sendAJAX?json={%22t%22:127,%22v%22:0}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 330,
        "y": 180,
        "wires": [
            [
                "2ba1d512.35030a",
                "8df66265.84674",
                "13f5ea65.9bdae6"
            ]
        ]
    },
    {
        "id": "13f5ea65.9bdae6",
        "type": "delay",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "",
        "pauseType": "rate",
        "timeout": "10",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "10",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 160,
        "y": 180,
        "wires": [
            [
                "1c79d414.eb201c"
            ]
        ]
    },
    {
        "id": "710a0cfd.9b6084",
        "type": "function",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "hours",
        "func": "var nowDate = new Date();\nvar Hour = nowDate.getHours();\n\n\nif ((Hour>=8)&&(Hour<21)){\n    msg.payload = 1024;\n    msg.url =\"192.168.1.110/sendAJAX?json={'t':7,'v':\"+msg.payload+\"}\";\n    context.set(\"nightLight\",0);\n}\nelse{\n//    msg.payload = 0;\n     msg.url =\"http://192.168.1.112/ws2811AJAX?json={'from':[53,44],'to':[88,88],'type':[2,0],'dir':[0,0],'col':[218,128],'wh':[153,128],'br_':[158,128],'num':2,'sp':11,'dr':255,'fd':60,'fdt':3,'br':132}\";\n    \n     context.set(\"nightLight\",1);\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 990,
        "y": 400,
        "wires": [
            [
                "d0a0f55b.f34a48"
            ]
        ]
    },
    {
        "id": "8040b5c5.fe83b8",
        "type": "telegram sender",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "send",
        "bot": "ca786bad.5ac7a8",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1210,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "6bcf6f35.9f8da",
        "type": "function",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "message",
        "func": "if (msg.payload ==0) return;\nvar content = msg.topic+\" payload:\"+msg.payload;\nvar TelegramChatIds = global.get(\"TelegramChatIds\");\nvar ObjectPayload={\n    \"chatId\": TelegramChatIds,\n    \"type\": \"message\",\n    \"content\":content \n}\nmsg.payload=ObjectPayload;\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1080,
        "y": 40,
        "wires": [
            [
                "8040b5c5.fe83b8"
            ]
        ]
    },
    {
        "id": "7ff3c529.78e03c",
        "type": "function",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "multi unit delay",
        "func": "let delay = 300 * 1000;\nvar delayName = 'tout_light';\n    myResetFunction();\n//==================================\n\nfunction myDelayFunction() {\n  let t = setTimeout(myEndFunction, delay);\n  context.set(delayName,t);\n}\n\n\nfunction myEndFunction() {\n  //node.send({payload:Date.now()});\n  node.send({payload:msg.payload});  \n}\n\n\nfunction myResetFunction() {\n  let t = context.get(delayName);    \n  clearTimeout(t);\n  //node.send({payload:Date.now()}); \n  //node.send({payload:context.get('pl'),delay:\"reset\"});   \n}\n\n//==================================\n\n\n\n  //node.send({payload:Date.now()});\n  myDelayFunction();  \n\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "77675f42.b01e6"
            ]
        ]
    },
    {
        "id": "8df66265.84674",
        "type": "function",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "Error",
        "func": "msg.payload = msg.payload+\"\";\n\nif (msg.payload.startsWith(\"Error:\")){\n    \n    var content = msg.topic+\" :\"+msg.payload;\n    var TelegramChatIds = global.get(\"TelegramChatIds\");\n    var ObjectPayload={\n        \"chatId\": TelegramChatIds,\n        \"type\": \"message\",\n        \"content\":content \n    }\n    msg.payload=ObjectPayload;\n    \n    var nowDate = new Date();\n    var Hour = nowDate.getHours();\n    if ((Hour>2)&&(Hour<6)){\n        return null;\n    }\n    return msg;\n}\nreturn null;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 110,
        "y": 240,
        "wires": [
            [
                "a5754353.794f"
            ]
        ]
    },
    {
        "id": "a5754353.794f",
        "type": "rbe",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 270,
        "y": 240,
        "wires": [
            [
                "13084678.03de0a"
            ]
        ]
    },
    {
        "id": "13084678.03de0a",
        "type": "telegram sender",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "sender",
        "bot": "",
        "haserroroutput": false,
        "outputs": 1,
        "x": 390,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "caaab49f.00b618",
        "type": "function",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "set context to 0",
        "func": "context.set(\"nightLight\",0);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1390,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "19ab148c.73718b",
        "type": "http request",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "http://192.168.1.110/ws2811AJAX?json={%22from%22:[0],%22to%22:[88],%22type%22:[3],%22dir%22:[0],%22col%22:[128],%22wh%22:[134],%22br_%22:[255],%22num%22:1,%22sp%22:67,%22dr%22:8,%22fd%22:65,%22fdt%22:3,%22br%22:255}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1000,
        "y": 80,
        "wires": [
            [
                "3634f1cb.343bbe"
            ]
        ]
    },
    {
        "id": "3634f1cb.343bbe",
        "type": "delay",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 1160,
        "y": 80,
        "wires": [
            [
                "4697a58.e8a825c"
            ]
        ]
    },
    {
        "id": "4697a58.e8a825c",
        "type": "http request",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "http://192.168.1.110/ws2811AJAX?json={%22from%22:[0],%22to%22:[88],%22type%22:[3],%22dir%22:[0],%22col%22:[128],%22wh%22:[134],%22br_%22:[255],%22num%22:1,%22sp%22:67,%22dr%22:8,%22fd%22:65,%22fdt%22:3,%22br%22:0}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1310,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "c26ba1e0.a9fb",
        "type": "switch",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "звонок",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 830,
        "y": 80,
        "wires": [
            [
                "6bcf6f35.9f8da",
                "19ab148c.73718b"
            ]
        ]
    },
    {
        "id": "90ff16ae.6a5d38",
        "type": "switch",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "дверь открылась",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 890,
        "y": 40,
        "wires": [
            [
                "6bcf6f35.9f8da"
            ]
        ]
    },
    {
        "id": "e9876976.3e6738",
        "type": "rbe",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 730,
        "y": 40,
        "wires": [
            [
                "90ff16ae.6a5d38",
                "19ab148c.73718b",
                "d0eceeea.617d4"
            ]
        ]
    },
    {
        "id": "d0eceeea.617d4",
        "type": "http request",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "http://192.168.1.110/sendAJAX?json={%22t%22:3,%22v%22:0}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 990,
        "y": 240,
        "wires": [
            [
                "80151722.282418"
            ]
        ]
    },
    {
        "id": "7c1235c1.9cd83c",
        "type": "delay",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "",
        "pauseType": "delay",
        "timeout": "20",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 1380,
        "y": 240,
        "wires": [
            [
                "2aa4d90d.8a03a6"
            ]
        ]
    },
    {
        "id": "2aa4d90d.8a03a6",
        "type": "http request",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "http://192.168.1.110/sendAJAX?json={%22t%22:3,%22v%22:1}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1530,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "3a65dada.6bd4a6",
        "type": "switch",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "движ снаружи",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 800,
        "y": 240,
        "wires": [
            [
                "d0eceeea.617d4"
            ]
        ]
    },
    {
        "id": "80151722.282418",
        "type": "function",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "reset delay",
        "func": "msg.delay = 20*1000;\nvar m1 = {reset:true};\nreturn [[m1,msg]];",
        "outputs": 1,
        "noerr": 0,
        "x": 1210,
        "y": 240,
        "wires": [
            [
                "7c1235c1.9cd83c"
            ]
        ]
    },
    {
        "id": "5f9e0bcc.7d9844",
        "type": "http request",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "включить свет дверь",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "192.168.1.110/sendAJAX?json={\"t\":7,\"v\":{{payload}}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1240,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "22dd3bfb.89b444",
        "type": "ui_gauge",
        "z": "d8baf37f.71552",
        "name": "Temp",
        "group": "4a84c495.0fce7c",
        "order": 2,
        "width": "3",
        "height": "2",
        "gtype": "donut",
        "title": "Temp",
        "label": "C",
        "format": "{{msg.payload}}",
        "min": "-20",
        "max": "30",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 970,
        "y": 620,
        "wires": []
    },
    {
        "id": "721f5b55.02dda4",
        "type": "function",
        "z": "d8baf37f.71552",
        "name": "decode_temp",
        "func": "var weatherData = msg.payload;\n\n// Convert temperature from Kelvin to Celsius\nconst kelvinToCelsius = (kelvin) => kelvin - 273.15;\n// Convert wind speed from m/s to km/h\nconst mpsToKmph = (mps) => mps * 3.6;\n\n// Compare sunrise and sunset times with current time\nconst isTimePassed = (timestamp, timezoneOffset) => {\n    const currentTime = Math.floor(Date.now() / 1000);\n    const localTime = currentTime + timezoneOffset;\n    return localTime > timestamp;\n};\n\n// Convert UTC timestamp to local time\nconst convertUtcToLocal = (utcTimestamp, timezoneOffset) => {\n    const utcTime = new Date(utcTimestamp * 1000);\n    const localTime = new Date(utcTime.getTime() + timezoneOffset * 1000);\n    return localTime;\n};\n\n// Extract and format the data\nconst payloadTemp = {\n    payload: Math.round(kelvinToCelsius(weatherData.main.temp)),\n    topic: \"temp\"\n};\n\nconst payloadWind = {\n    payload: Math.round(mpsToKmph(weatherData.wind.speed)),\n    topic: \"wind\"\n};\n\nconst payloadCloud = {\n    payload: Math.round(weatherData.clouds.all),\n    topic: \"cloud\"\n};\n\nconst payloadSunrise = {\n    payload: convertUtcToLocal(weatherData.sys.sunrise, weatherData.timezone),\n    topic: \"sunrise\",\n    isSunrise: true,\n    isSunset: false\n};\n\nconst payloadSunset = {\n    payload: convertUtcToLocal(weatherData.sys.sunset, weatherData.timezone),\n    topic: \"sunset\",\n    isSunrise: false,\n    isSunset: true\n};\n\n// Ensure sunrise and sunset cannot both be true at the same time\nif (isTimePassed(weatherData.sys.sunrise, weatherData.timezone)) {\n    payloadSunrise.isSunrise = false;\n}\n\nif (isTimePassed(weatherData.sys.sunset, weatherData.timezone)) {\n    payloadSunset.isSunset = false;\n}\n\n// Return the formatted data\nreturn [payloadTemp, payloadWind, payloadCloud, payloadSunrise, payloadSunset];",
        "outputs": 5,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 720,
        "wires": [
            [
                "22dd3bfb.89b444"
            ],
            [
                "93b19ecc.97eda"
            ],
            [
                "b0a8dcc0.b0bdd"
            ],
            [
                "b99a2d53e11f8de7"
            ],
            [
                "fc28c4c449bdc874"
            ]
        ]
    },
    {
        "id": "b0a8dcc0.b0bdd",
        "type": "ui_text",
        "z": "d8baf37f.71552",
        "group": "4a84c495.0fce7c",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "облачность",
        "format": "{{msg.payload | uppercase}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 990,
        "y": 700,
        "wires": []
    },
    {
        "id": "69920448.0b3e6c",
        "type": "ui_slider",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "",
        "label": "свет",
        "tooltip": "",
        "group": "4b290438.730fbc",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "",
        "topicType": "str",
        "min": 0,
        "max": "1024",
        "step": 1,
        "className": "",
        "x": 910,
        "y": 280,
        "wires": [
            [
                "5f9e0bcc.7d9844"
            ]
        ]
    },
    {
        "id": "201a139.6ac00ec",
        "type": "rbe",
        "z": "d8baf37f.71552",
        "d": true,
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 670,
        "y": 380,
        "wires": [
            [
                "73b123a9.7a039c"
            ]
        ]
    },
    {
        "id": "93b19ecc.97eda",
        "type": "ui_gauge",
        "z": "d8baf37f.71552",
        "name": "",
        "group": "4a84c495.0fce7c",
        "order": 3,
        "width": "6",
        "height": "2",
        "gtype": "gage",
        "title": "ветер",
        "label": "units",
        "format": "{{msg.payload}}",
        "min": "1",
        "max": 10,
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 970,
        "y": 660,
        "wires": []
    },
    {
        "id": "27c53601.bc0ada",
        "type": "http request",
        "z": "d8baf37f.71552",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 570,
        "y": 720,
        "wires": [
            [
                "721f5b55.02dda4"
            ]
        ]
    },
    {
        "id": "1880f5db.2dcf5a",
        "type": "function",
        "z": "d8baf37f.71552",
        "name": "Request Wheather",
        "func": "var city=\"Radauti\";\nvar APIkey =\"c3e9cf7a63b7fb63e4ee7504ae3dd41e\";\nmsg.url =\"api.openweathermap.org/data/2.5/weather?q=\"+city+\"&appid=\"+APIkey+\"\";\n//https://api.openweathermap.org/data/2.5/weather?lat={lat}&lon={lon}&appid={API key}\n//47.82842571798598, 25.922105778650298\nmsg.url = \"https://api.openweathermap.org/data/2.5/weather?lat=47.83&lon=25.92&appid=\" + APIkey +\"\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 720,
        "wires": [
            [
                "27c53601.bc0ada"
            ]
        ]
    },
    {
        "id": "81119d7d.27706",
        "type": "inject",
        "z": "d8baf37f.71552",
        "name": "",
        "props": [
            {
                "p": "payload",
                "v": "",
                "vt": "date"
            },
            {
                "p": "topic",
                "v": "",
                "vt": "str"
            }
        ],
        "repeat": "240",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 720,
        "wires": [
            [
                "1880f5db.2dcf5a"
            ]
        ]
    },
    {
        "id": "b99a2d53e11f8de7",
        "type": "rbe",
        "z": "d8baf37f.71552",
        "name": "sunrise",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 980,
        "y": 740,
        "wires": [
            [
                "c9ed277fe42ae44a"
            ]
        ]
    },
    {
        "id": "fc28c4c449bdc874",
        "type": "rbe",
        "z": "d8baf37f.71552",
        "name": "sunset",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 970,
        "y": 780,
        "wires": [
            [
                "d942d8fafa19130c"
            ]
        ]
    },
    {
        "id": "c9ed277fe42ae44a",
        "type": "ui_text",
        "z": "d8baf37f.71552",
        "group": "d933d053d66f5444",
        "order": 10,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "sunrise",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 1160,
        "y": 740,
        "wires": []
    },
    {
        "id": "d942d8fafa19130c",
        "type": "ui_text",
        "z": "d8baf37f.71552",
        "group": "d933d053d66f5444",
        "order": 10,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "sunset",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 1150,
        "y": 780,
        "wires": []
    },
    {
        "id": "a2c0301c.0d567",
        "type": "inject",
        "z": "28839e10.005852",
        "d": true,
        "name": "",
        "repeat": "10",
        "crontab": "",
        "once": true,
        "onceDelay": "60",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 60,
        "wires": [
            [
                "c96d2e35.7ad56"
            ]
        ]
    },
    {
        "id": "c96d2e35.7ad56",
        "type": "http request",
        "z": "28839e10.005852",
        "name": "балкон",
        "method": "GET",
        "ret": "obj",
        "paytoqs": false,
        "url": "http://192.168.1.114/sendAJAX?json={%22t%22:127,%22v%22:0}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 280,
        "y": 220,
        "wires": [
            [
                "31a013a1.2ae06c",
                "3cd2ec02.a53314"
            ]
        ]
    },
    {
        "id": "24b6d69f.1343ca",
        "type": "ui_chart",
        "z": "28839e10.005852",
        "name": "",
        "group": "650233e5.37ad3c",
        "order": 4,
        "width": "0",
        "height": "0",
        "label": "температура",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "604800",
        "cutout": 0,
        "useOneColor": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 920,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "5dce9b60.cc5bb4",
        "type": "function",
        "z": "28839e10.005852",
        "name": "балкон",
        "func": "var parsed =(msg.payload);\nvar stat1 ={payload: parsed.stat[0]};//увлажнение\nvar stat2 ={payload: parsed.stat[1]};//полив\nvar stat3 ={payload: parsed.stat[2]};//температура\nvar stat4 ={payload: parsed.stat[3]};//влажность\nvar stat8 ={payload: parsed.stat[8]};//цветок1\nstat8.topic=\"flv1\";\nvar stat9 ={payload: parsed.stat[9]};//цветок2\nstat8.payload = (1024 - stat8.payload);\nstat9.topic=\"flv2\";\n\nreturn [ stat1, stat2, stat3 , stat4,stat8,stat9 ];",
        "outputs": 6,
        "noerr": 0,
        "x": 600,
        "y": 240,
        "wires": [
            [
                "f745f494.4819f8"
            ],
            [
                "cb6605bd.0240a8"
            ],
            [
                "763c0049.cb911"
            ],
            [
                "96cc649c.7c3618"
            ],
            [
                "633cdc35.3bdec4"
            ],
            []
        ]
    },
    {
        "id": "f2d51f17.68076",
        "type": "ui_chart",
        "z": "28839e10.005852",
        "d": true,
        "name": "",
        "group": "650233e5.37ad3c",
        "order": 1,
        "width": "0",
        "height": "0",
        "label": "увлажнение",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "604800",
        "cutout": 0,
        "useOneColor": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 910,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "ce2dbac2.9ea448",
        "type": "ui_chart",
        "z": "28839e10.005852",
        "d": true,
        "name": "",
        "group": "650233e5.37ad3c",
        "order": 3,
        "width": "0",
        "height": "0",
        "label": "полив",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "604800",
        "cutout": 0,
        "useOneColor": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 890,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "d37894e1.5fdca8",
        "type": "ui_chart",
        "z": "28839e10.005852",
        "name": "",
        "group": "650233e5.37ad3c",
        "order": 5,
        "width": "0",
        "height": "0",
        "label": "влажность",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "604800",
        "cutout": 0,
        "useOneColor": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 910,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "992bcdf6.5e3c4",
        "type": "http request",
        "z": "28839e10.005852",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": false,
        "url": "192.168.1.114",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1270,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "a95d5dc6.72e65",
        "type": "function",
        "z": "28839e10.005852",
        "name": "saveData",
        "func": "msg.headers = {\n    \"content-type\" : 'multipart/form-data'\n    };\nlet databuffer = msg.payload;\n\nmsg.payload = {\n    \"KEY\": {\n        \"value\": databuffer,\n        \"options\": {\n            \"filename\": \"myfile.png\"\n        }\n    }\n}\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1120,
        "y": 200,
        "wires": [
            [
                "992bcdf6.5e3c4"
            ]
        ]
    },
    {
        "id": "48d37ef2.031a2",
        "type": "function",
        "z": "28839e10.005852",
        "name": "reparse",
        "func": "var parsed =(msg.payload);\nvar stat1 ={payload: parsed.stat[0]};\nvar stat2 ={payload: parsed.stat[1]};\nvar stat3 ={payload: parsed.stat[2]};\nvar stat4 ={payload: parsed.stat[3]};\n\nmsg.payload ={\n\"mode\":\"on\",\n\"humidity\":stat4.payload,\n\"temperature\":stat3.payload\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 720,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "31a013a1.2ae06c",
        "type": "change",
        "z": "28839e10.005852",
        "name": "set topic",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "balcony",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 440,
        "y": 220,
        "wires": [
            [
                "5dce9b60.cc5bb4",
                "48d37ef2.031a2"
            ]
        ]
    },
    {
        "id": "633cdc35.3bdec4",
        "type": "ui_chart",
        "z": "28839e10.005852",
        "name": "цветок1",
        "group": "7caf40b8.ebe01",
        "order": 3,
        "width": 0,
        "height": 0,
        "label": "цветок1",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "604800",
        "cutout": 0,
        "useOneColor": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 900,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "763c0049.cb911",
        "type": "rbe",
        "z": "28839e10.005852",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 770,
        "y": 220,
        "wires": [
            [
                "24b6d69f.1343ca"
            ]
        ]
    },
    {
        "id": "cb6605bd.0240a8",
        "type": "rbe",
        "z": "28839e10.005852",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 770,
        "y": 200,
        "wires": [
            [
                "f2d51f17.68076"
            ]
        ]
    },
    {
        "id": "f745f494.4819f8",
        "type": "rbe",
        "z": "28839e10.005852",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 770,
        "y": 180,
        "wires": [
            [
                "ce2dbac2.9ea448"
            ]
        ]
    },
    {
        "id": "3cd2ec02.a53314",
        "type": "function",
        "z": "28839e10.005852",
        "name": "Error",
        "func": "msg.payload = msg.payload+\"\";\nif (msg.payload.startsWith(\"Error:\")){\n\nvar content = msg.topic+\" :\"+msg.payload;\nvar TelegramChatIds = global.get(\"TelegramChatIds\");\nvar ObjectPayload={\n    \"chatId\": TelegramChatIds,\n    \"type\": \"message\",\n    \"content\":content \n}\nmsg.payload=ObjectPayload;\n\n    var nowDate = new Date();\n    var Hour = nowDate.getHours();\n    if ((Hour>2)&&(Hour<6)){\n        return null;\n    }\nreturn msg;\n}\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 370,
        "y": 320,
        "wires": [
            [
                "f473187f.d45738"
            ]
        ]
    },
    {
        "id": "f473187f.d45738",
        "type": "rbe",
        "z": "28839e10.005852",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 490,
        "y": 320,
        "wires": [
            [
                "2cb691c9.014d1e"
            ]
        ]
    },
    {
        "id": "2cb691c9.014d1e",
        "type": "telegram sender",
        "z": "28839e10.005852",
        "name": "sender",
        "bot": "ca786bad.5ac7a8",
        "haserroroutput": false,
        "outputs": 1,
        "x": 610,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "96cc649c.7c3618",
        "type": "rbe",
        "z": "28839e10.005852",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 770,
        "y": 240,
        "wires": [
            [
                "d37894e1.5fdca8"
            ]
        ]
    },
    {
        "id": "97a52e06.72ca4",
        "type": "inject",
        "z": "28839e10.005852",
        "d": true,
        "name": "полив",
        "repeat": "10800",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "timestamp_interval",
        "payload": "true",
        "payloadType": "bool",
        "x": 220,
        "y": 560,
        "wires": [
            [
                "69f736d3.596688"
            ]
        ]
    },
    {
        "id": "1c87329.0078bcd",
        "type": "http request",
        "z": "28839e10.005852",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "192.168.1.114/sendAJAX?json={\"t\":0,\"v\":{{payload}}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1150,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "24514965.546da6",
        "type": "delay",
        "z": "28839e10.005852",
        "name": "",
        "pauseType": "delay",
        "timeout": "15",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 780,
        "y": 500,
        "wires": [
            [
                "3988dc38.ea6084"
            ]
        ]
    },
    {
        "id": "3988dc38.ea6084",
        "type": "change",
        "z": "28839e10.005852",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 940,
        "y": 500,
        "wires": [
            [
                "1c87329.0078bcd"
            ]
        ]
    },
    {
        "id": "391e444a.56a19c",
        "type": "function",
        "z": "28839e10.005852",
        "name": "balcony",
        "func": "var info ={\n    \"payload\":0,\n    \"topic\":\"полив\"\n}\nwatering_count=flow.get('watering_count')\nif (msg.topic==\"force_watering\"){\n     msg.payload=0; \n     info ={\n       \"payload\":\"принудительный полив \"+waterDiff,\n    \"topic\":\"полив\"  \n     }\n}else{\n\nwatering_level=global.get('watering_level');\n\nvar parsed =(msg.payload);\nvar stat1 ={payload: parsed.stat[0]};//полив\nvar stat2 ={payload: parsed.stat[1]};//увлажнение\nvar stat3 ={payload: parsed.stat[2]};//температура\nvar stat4 ={payload: parsed.stat[3]};//влажность\nvar stat8 ={payload: parsed.stat[8]};//цветок1\nstat8.topic=\"flv1\";\nvar stat9 ={payload: parsed.stat[9]};//цветок2\nstat9.topic=\"flv2\";\n    \n    //water1=100-stat8.payload*100/1024;\n    water1=1024-stat8.payload;\n    water2=stat9.payload*100/1024;\n    waterDiff=Math.round(water2-water1);\n    \n//msg.payload=1;\n\n//if ((stat8.payload<300)&&(stat9.payload<300)){\nwatering_count_msg = {}\n\n\nif (water1<watering_level){\n    watering_count++;\n    flow.set('watering_count',watering_count);\n    msg.payload=0;\n    info={\"payload\":\"полив \"+water1+\" watering_count:\" +watering_count,\n    \"topic\":\"полив\"};\n}else{\n    msg.payload=1;\n    info.payload =\"полива не было \"+waterDiff;\n    info=null;\n}\n}\nwatering_count_msg.payload = watering_count;\nreturn [msg,info,watering_count_msg];",
        "outputs": 3,
        "noerr": 0,
        "x": 540,
        "y": 480,
        "wires": [
            [
                "1c87329.0078bcd",
                "24514965.546da6"
            ],
            [
                "88dda9ca.561958"
            ],
            [
                "970c1dbd.c4ccd"
            ]
        ]
    },
    {
        "id": "69f736d3.596688",
        "type": "http request",
        "z": "28839e10.005852",
        "name": "balcony",
        "method": "GET",
        "ret": "obj",
        "paytoqs": false,
        "url": "http://192.168.1.114/sendAJAX?json={%22t%22:127,%22v%22:0}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 360,
        "y": 560,
        "wires": [
            [
                "391e444a.56a19c"
            ]
        ]
    },
    {
        "id": "7c0e305a.52c72",
        "type": "ui_button",
        "z": "28839e10.005852",
        "name": "",
        "group": "650233e5.37ad3c",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Полив",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "true",
        "payloadType": "bool",
        "topic": "force_watering",
        "x": 330,
        "y": 480,
        "wires": [
            [
                "391e444a.56a19c"
            ]
        ]
    },
    {
        "id": "103cd40c.7b73ec",
        "type": "telegram sender",
        "z": "28839e10.005852",
        "name": "send_watering",
        "bot": "ca786bad.5ac7a8",
        "haserroroutput": false,
        "outputs": 1,
        "x": 960,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "88dda9ca.561958",
        "type": "function",
        "z": "28839e10.005852",
        "name": "message",
        "func": "var content = msg.topic+\" payload:\"+msg.payload;\nvar TelegramChatIds = global.get(\"TelegramChatIds\");\nvar ObjectPayload={\n    \"chatId\": TelegramChatIds,\n    \"type\": \"message\",\n    \"content\":content \n}\nmsg.payload=ObjectPayload;\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 780,
        "y": 540,
        "wires": [
            [
                "103cd40c.7b73ec"
            ]
        ]
    },
    {
        "id": "21a20373.64c3bc",
        "type": "ui_slider",
        "z": "28839e10.005852",
        "name": "watering_level",
        "label": "вл почвы",
        "tooltip": "",
        "group": "7caf40b8.ebe01",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "",
        "min": "0",
        "max": "1024",
        "step": 1,
        "x": 740,
        "y": 420,
        "wires": [
            [
                "b3923436.280238"
            ]
        ]
    },
    {
        "id": "b3923436.280238",
        "type": "change",
        "z": "28839e10.005852",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "watering_level",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 950,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "f5d25ccf.ce731",
        "type": "change",
        "z": "28839e10.005852",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "watering_level",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 420,
        "wires": [
            [
                "21a20373.64c3bc"
            ]
        ]
    },
    {
        "id": "d2669128.7b4f",
        "type": "inject",
        "z": "28839e10.005852",
        "d": true,
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 390,
        "y": 420,
        "wires": [
            [
                "f5d25ccf.ce731"
            ]
        ]
    },
    {
        "id": "3a4fed48.834222",
        "type": "function",
        "z": "28839e10.005852",
        "name": "Decode Weather",
        "func": " var wheather=msg.payload;\n var nowDate = new Date();\n var Hour = nowDate.getHours();\n \n//var day = context.get(\"day\");   \n var nowBright=5;\n\nif ((Hour>=8)&&(Hour<21)){\n    nowBright=10;\n}\n \n \n    //var wheather = \"{\\\"coord\\\":{\\\"lon\\\":34.9833,\\\"lat\\\":48.45},\\\"weather\\\":[{\\\"id\\\":500,\\\"main\\\":\\\"Rain\\\",\\\"description\\\":\\\"light rain\\\",\\\"icon\\\":\\\"10d\\\"},{\\\"id\\\":701,\\\"main\\\":\\\"Mist\\\",\\\"description\\\":\\\"mist\\\",\\\"icon\\\":\\\"50d\\\"}],\\\"base\\\":\\\"stations\\\",\\\"main\\\":{\\\"temp\\\":279.48,\\\"feels_like\\\":275.13,\\\"temp_min\\\":279.15,\\\"temp_max\\\":279.82,\\\"pressure\\\":1002,\\\"humidity\\\":100},\\\"visibility\\\":3500,\\\"wind\\\":{\\\"speed\\\":5,\\\"deg\\\":190},\\\"rain\\\":{\\\"1h\\\":0.11},\\\"clouds\\\":{\\\"all\\\":75},\\\"dt\\\":1612449242,\\\"sys\\\":{\\\"type\\\":1,\\\"id\\\":8901,\\\"country\\\":\\\"UA\\\",\\\"sunrise\\\":1612415098,\\\"sunset\\\":1612449779},\\\"timezone\\\":7200,\\\"id\\\":709930,\\\"name\\\":\\\"Dnipro\\\",\\\"cod\\\":200}\";\n    // var wheather2=\"{\\\"coord\\\":{\\\"lon\\\":34.9833,\\\"lat\\\":48.45},\\\"weather\\\":[{\\\"id\\\":803,\\\"main\\\":\\\"Clouds\\\",\\\"description\\\":\\\"broken clouds\\\",\\\"icon\\\":\\\"04n\\\"}],\\\"base\\\":\\\"stations\\\",\\\"main\\\":{\\\"temp\\\":267.1,\\\"feels_like\\\":257.04,\\\"temp_min\\\":267.04,\\\"temp_max\\\":267.15,\\\"pressure\\\":1018,\\\"humidity\\\":73},\\\"visibility\\\":10000,\\\"wind\\\":{\\\"speed\\\":10,\\\"deg\\\":320},\\\"clouds\\\":{\\\"all\\\":75},\\\"dt\\\":1612555439,\\\"sys\\\":{\\\"type\\\":1,\\\"id\\\":8901,\\\"country\\\":\\\"UA\\\",\\\"sunrise\\\":1612501412,\\\"sunset\\\":1612536277},\\\"timezone\\\":7200,\\\"id\\\":709930,\\\"name\\\":\\\"Dnipro\\\",\\\"cod\\\":200}\";\n    // var wheather3=\"{\\\"coord\\\":{\\\"lon\\\":34.9833,\\\"lat\\\":48.45},\\\"weather\\\":[{\\\"id\\\":800,\\\"main\\\":\\\"Clear\\\",\\\"description\\\":\\\"clear sky\\\",\\\"icon\\\":\\\"01d\\\"}],\\\"base\\\":\\\"stations\\\",\\\"main\\\":{\\\"temp\\\":269.43,\\\"feels_like\\\":263.53,\\\"temp_min\\\":268.71,\\\"temp_max\\\":270.15,\\\"pressure\\\":1016,\\\"humidity\\\":59},\\\"visibility\\\":10000,\\\"wind\\\":{\\\"speed\\\":4,\\\"deg\\\":290},\\\"clouds\\\":{\\\"all\\\":0},\\\"dt\\\":1612612299,\\\"sys\\\":{\\\"type\\\":1,\\\"id\\\":8901,\\\"country\\\":\\\"UA\\\",\\\"sunrise\\\":1612587724,\\\"sunset\\\":1612622776},\\\"timezone\\\":7200,\\\"id\\\":709930,\\\"name\\\":\\\"Dnipro\\\",\\\"cod\\\":200}\";\n    var wheather_parse = JSON.parse(wheather);\n    var feels_like = Math.round(wheather_parse.main.feels_like - 273, 15);\n    var temp = Math.round(wheather_parse.main.temp - 273, 15);\n    var signigicant_wheather = 0;\n    if (wheather_parse.weather[0].main === ('Rain')) {\n        signigicant_wheather = 4;\n    } else if (wheather_parse.weather[0].main === ('Clouds')) {\n        signigicant_wheather = 1;\n    } else if (wheather_parse.weather[0].main === ('Snow')) {\n        signigicant_wheather = 5;\n    } else if (wheather_parse.weather[0].main === ('Clear')) {\n        signigicant_wheather = 0;//Clear\n    }\n\n    //console.log(wheather_parse.weather[0].main===('Clear'));\n    var main = (wheather_parse.weather)[0].description;\n    var wind = (wheather_parse.wind.speed);\n    var wind_dir = (wheather_parse.wind.deg);\n    var sunrise=(new Date(wheather_parse.sys.sunrise*1000).getHours()*60+(new Date(wheather_parse.sys.sunrise*1000).getMinutes()));\n    var sunset=(new Date(wheather_parse.sys.sunset*1000).getHours()*60+(new Date(wheather_parse.sys.sunset*1000).getMinutes()));\n    var nowtime=(new Date().getHours()*60+(new Date().getMinutes()));\n    var isSunrise = ((sunrise)<(nowtime)&&((sunset)>(nowtime)))?255:255;\n    //var isSunrise = ((sunrise)<(nowtime)&&((sunset)>(nowtime)))?:100;\n\n    function getMinMax(value, minOutput, maxOutput, maxInput) {\n        var middle = 0;\n        middle = Math.round((value - minOutput) * maxInput / (maxOutput - minOutput));\n        return middle;\n    }\n\n    var ws8211 = \"{\\\"from\\\":[0],\\\"to\\\":[88],\\\"type\\\":[1],\\\"dir\\\":[0],\\\"col\\\":[0],\\\"wh\\\":[128],\\\"br_\\\":[230],\\\"num\\\":1,\\\"sp\\\":254,\\\"dr\\\":255,\\\"fd\\\":4,\\\"fdt\\\":3,\\\"br\\\":255}\";\n    var JsonString = {};\n\n    JsonString.from = [0];\n    //JsonString.g1 = g1;\n    JsonString.to = [41];\n    JsonString.type = [signigicant_wheather];\n    JsonString.dir = [wind_dir < 180 ? 0 : 1];\n    JsonString.col = [getMinMax(temp, -20, 40, 255)];\n    JsonString.wh = [255];\n    JsonString.br_ = [isSunrise];\n    JsonString.num = 1;\n    JsonString.sp = 15-getMinMax(wind, 0, 15, 255);\n    JsonString.dr = 255;\n    JsonString.fd = ((signigicant_wheather === 1) || (signigicant_wheather === 0)) ? 100 : 100;\n    JsonString.fdt = 3;\n    JsonString.br = 10;\n    JsonString.inv = 0;\n    JsonString.ws8211_loop = 1;\n        var JsonString_bathroom = JsonString;\n        JsonString_bathroom.inv=0;\n        JsonString_bathroom.to = [88];\n        JsonString_bathroom.br = nowBright;\n// var msg_bathroom=msg;\n// var msg_balcony=msg;\n\n    var url_balcony = \"http://192.168.1.111/ws2811AJAX?json=\"+JSON.stringify(JsonString);\n    var url_bathroom = \"http://192.168.1.112/ws2811AJAX?json=\"+JSON.stringify(JsonString_bathroom);\n    // var AjaxFormat_balcony = url_balcony;\n    // var AjaxFormat_bathroom = url_bathroom;\n    //console.log(AjaxFormat_balcony);\n    var add = \"json=\";\n    msg_balcony={\n       \"url\" : url_balcony\n    }\n    msg_bathroom={\n       \"url\" : url_bathroom\n    }\n    // msg_balcony.url = AjaxFormat_balcony;\n    // msg_bathroom.url = AjaxFormat_bathroom;\n    // msg_bathroom.payload = JSON.stringify(JsonString_bathroom);\n    // msg_balcony.payload = JSON.stringify(JsonString);\n\n    //return msg;\n    //console.log(AjaxFormat);\n   // msg.url = AjaxFormat;\n    var temp_obj={\n        \"payload\":temp,\n        \"topic\":\"temp\"\n    }\n        var temp_feels_like={\n        \"payload\":feels_like,\n        \"topic\":\"feels_like\"\n    }\n    var pressure_lvl={\n        \"payload\":wheather_parse.main.pressure,\n        \"topic\":\"press\"\n    }\n\n//return [temp_obj,[msg_bathroom,msg_balcony]];\nreturn [temp_obj,msg_bathroom,temp_feels_like,pressure_lvl];",
        "outputs": 4,
        "noerr": 0,
        "x": 810,
        "y": 720,
        "wires": [
            [
                "947220b8.5ab7",
                "b00859a3.b0e688"
            ],
            [
                "f5ca3e9d.325bc",
                "7aa502be.442e6c"
            ],
            [
                "b10cc0d2.736d6"
            ],
            [
                "26faf60e.0b6f5a"
            ]
        ]
    },
    {
        "id": "f5ca3e9d.325bc",
        "type": "http request",
        "z": "28839e10.005852",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": true,
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1030,
        "y": 740,
        "wires": [
            [
                "735d5574.6d78ec"
            ]
        ]
    },
    {
        "id": "947220b8.5ab7",
        "type": "change",
        "z": "28839e10.005852",
        "name": "set temp",
        "rules": [
            {
                "t": "set",
                "p": "temp_outer",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1020,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "b00859a3.b0e688",
        "type": "ui_text",
        "z": "28839e10.005852",
        "group": "7caf40b8.ebe01",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Температура снаружи",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "x": 1040,
        "y": 660,
        "wires": []
    },
    {
        "id": "7aa502be.442e6c",
        "type": "debug",
        "z": "28839e10.005852",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 1250,
        "y": 720,
        "wires": []
    },
    {
        "id": "735d5574.6d78ec",
        "type": "debug",
        "z": "28839e10.005852",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 1250,
        "y": 760,
        "wires": []
    },
    {
        "id": "5309f0b6.903d4",
        "type": "http request",
        "z": "28839e10.005852",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "192.168.1.114/sendAJAX?json={\"t\":0,\"v\":0}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 630,
        "y": 880,
        "wires": [
            [
                "9b00bd77.0d105"
            ]
        ]
    },
    {
        "id": "9b00bd77.0d105",
        "type": "delay",
        "z": "28839e10.005852",
        "name": "",
        "pauseType": "delay",
        "timeout": "15",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 780,
        "y": 880,
        "wires": [
            [
                "46a52d1e.1164c4"
            ]
        ]
    },
    {
        "id": "46a52d1e.1164c4",
        "type": "http request",
        "z": "28839e10.005852",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "192.168.1.114/sendAJAX?json={\"t\":0,\"v\":1}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 950,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "75d9fd51.822df4",
        "type": "inject",
        "z": "28839e10.005852",
        "d": true,
        "name": "",
        "repeat": "",
        "crontab": "00 16 * * *",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "payload": "It is 4pm on a weekday!",
        "payloadType": "str",
        "x": 270,
        "y": 880,
        "wires": [
            [
                "5309f0b6.903d4"
            ]
        ]
    },
    {
        "id": "45760aec.d00ff4",
        "type": "function",
        "z": "28839e10.005852",
        "name": "Request Wheather",
        "func": "var city=\"Dnipro\";\nvar lat=\"48\";\nvar lon=\"35\";\nvar APIkey=\"c3e9cf7a63b7fb63e4ee7504ae3dd41e\";\n//msg.url =\"api.openweathermap.org/data/2.5/forecast?lat=\"+lat+\"&lon=\"+lon+\"&appid=\"+APIkey+\"\";\nmsg.url =\"api.openweathermap.org/data/2.5/forecast?q=\"+city+\"&appid=\"+APIkey+\"\";\n\n//\"api.openweathermap.org/data/2.5/forecast?lat=35&lon=139&appid={API key}\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 410,
        "y": 940,
        "wires": [
            [
                "56ce10cd.6d305"
            ]
        ]
    },
    {
        "id": "56ce10cd.6d305",
        "type": "http request",
        "z": "28839e10.005852",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "",
        "persist": false,
        "authType": "",
        "x": 630,
        "y": 940,
        "wires": [
            [
                "dc52979f.f8b648"
            ]
        ]
    },
    {
        "id": "dc52979f.f8b648",
        "type": "debug",
        "z": "28839e10.005852",
        "name": "forecast",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 820,
        "y": 940,
        "wires": []
    },
    {
        "id": "a266102.6b1fef",
        "type": "inject",
        "z": "28839e10.005852",
        "d": true,
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 220,
        "y": 940,
        "wires": [
            [
                "45760aec.d00ff4"
            ]
        ]
    },
    {
        "id": "970c1dbd.c4ccd",
        "type": "ui_text",
        "z": "28839e10.005852",
        "group": "cad186fc.6717b8",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "text",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 770,
        "y": 580,
        "wires": []
    },
    {
        "id": "b10cc0d2.736d6",
        "type": "ui_text",
        "z": "28839e10.005852",
        "group": "4b290438.730fbc",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "чувствуется как",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 1040,
        "y": 800,
        "wires": []
    },
    {
        "id": "26faf60e.0b6f5a",
        "type": "ui_text",
        "z": "28839e10.005852",
        "group": "4b290438.730fbc",
        "order": 5,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "давление",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 1030,
        "y": 840,
        "wires": []
    },
    {
        "id": "5d2d4b0b.6fa5d4",
        "type": "http request",
        "z": "c22de8d6.aec338",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "192.168.1.112/sendAJAX?json={\"t\":5,\"v\":{{payload}}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 2430,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "e3288d98.51ec",
        "type": "ui_switch",
        "z": "c22de8d6.aec338",
        "name": "",
        "label": "вентилятор в ванной",
        "tooltip": "",
        "group": "6a1fd3d5.2b832c",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "0",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "x": 1920,
        "y": 80,
        "wires": [
            [
                "ffa92552.c3da98"
            ]
        ]
    },
    {
        "id": "415281ff.6cde2",
        "type": "ui_switch",
        "z": "c22de8d6.aec338",
        "d": true,
        "name": "",
        "label": "вентилятор в ванной правый",
        "tooltip": "",
        "group": "6a1fd3d5.2b832c",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "0",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "x": 1950,
        "y": 120,
        "wires": [
            [
                "ffa92552.c3da98"
            ]
        ]
    },
    {
        "id": "6b0e4d93.7d1364",
        "type": "http request",
        "z": "c22de8d6.aec338",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "192.168.1.112/sendAJAX?json={\"t\":6,\"v\":{{payload}}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 2430,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "58f0e60.a21ef1c",
        "type": "http request",
        "z": "c22de8d6.aec338",
        "name": "ванна",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "192.168.1.112/sendAJAX?json={%22t%22:127,%22v%22:0}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 630,
        "y": 120,
        "wires": [
            [
                "b0d2b1bc.f6b7b",
                "3d0c3911.66aca6",
                "1adb7178.aefdaf",
                "11148168.90380f"
            ]
        ]
    },
    {
        "id": "b0d2b1bc.f6b7b",
        "type": "function",
        "z": "c22de8d6.aec338",
        "name": "Bathroom",
        "func": "\nvar parsed =(msg.payload);\n\nvar stat0={\n    \"payload\":0,\n    \"topic\":0\n};\nvar stat2={\n  \"payload\":0,\n    \"topic\":\"humidity\"  \n};\n\nstat0.payload =parsed.stat[0];//движение\nstat2.payload =parsed.stat[2];//влажность\n\nvar stat1 ={payload: parsed.stat[1]};//температура\nvar stat3 ={payload: parsed.stat[3]};//3\nvar stat4 ={payload: parsed.stat[4]};//колонки\nvar stat5 ={payload: parsed.stat[5]};//вентилятор леввый\nvar stat6 ={payload: parsed.stat[6]};//вентилятор правый\n\nvar DealyMessageOff={\n    topic:\"fans\",\n    payload:1};    \nif ((stat5.payload===0)||(stat6.payload===0)){\nDealyMessageOff.payload=0;    \n}else{\nDealyMessageOff.payload=1;  \n}\n\nstat0.topic = \"move\";\nstat2.topic = \"humidity\";\n\nhttpreq = {\n    \"topic\":\"\",\n    \"payload\":\"\",\n    \"url\":\"\"\n}\nhttpreq.url=\"http://192.168.1.112/sendAJAX?json={\\\"t\\\":127,\\\"v\\\":0}\";\nvar httreq_ch = false;\nhttpreq = null;\nreturn [ stat0, stat1, stat2,stat4,stat5,stat6,DealyMessageOff,httpreq ];",
        "outputs": 8,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 800,
        "y": 120,
        "wires": [
            [
                "ce779d77.68f7e",
                "1d07a799.fe9c08",
                "284a2937.bc1d46"
            ],
            [],
            [
                "284a2937.bc1d46"
            ],
            [
                "45d05603.04f3b8"
            ],
            [
                "e3288d98.51ec"
            ],
            [
                "415281ff.6cde2"
            ],
            [
                "dd0305c.c86b2f8"
            ],
            [
                "6707ea60.23c944"
            ]
        ]
    },
    {
        "id": "3d0c3911.66aca6",
        "type": "function",
        "z": "c22de8d6.aec338",
        "name": "Error",
        "func": "var nowDate = new Date();\nvar Hour = nowDate.getHours();\n\n\n\n\n\n\n\nmsg.payload = msg.payload+\"\";\nif (msg.payload.startsWith(\"Error:\")){\n    var content = msg.topic+\" :\"+msg.payload;\n    var ObjectPayload={\n        \"chatId\": \"843873284\",\n        \"type\": \"message\",\n        \"content\":content \n    }\n    msg.payload=ObjectPayload;\n    \n    if ((Hour>2)&&(Hour<6)){\n        return null;\n    }\nreturn msg;\n}\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "x": 1230,
        "y": 320,
        "wires": [
            [
                "4d33eadd.574ec4"
            ]
        ]
    },
    {
        "id": "1e6d8328.482d4d",
        "type": "telegram sender",
        "z": "c22de8d6.aec338",
        "name": "sender",
        "bot": "ca786bad.5ac7a8",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1510,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "4d33eadd.574ec4",
        "type": "rbe",
        "z": "c22de8d6.aec338",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 1370,
        "y": 320,
        "wires": [
            [
                "1e6d8328.482d4d"
            ]
        ]
    },
    {
        "id": "332fa0c1.b0916",
        "type": "delay",
        "z": "c22de8d6.aec338",
        "name": "",
        "pauseType": "delayv",
        "timeout": "1",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 1440,
        "y": 160,
        "wires": [
            [
                "54d2298b.6fead8"
            ]
        ]
    },
    {
        "id": "c63ce770.7ae7e8",
        "type": "function",
        "z": "c22de8d6.aec338",
        "name": "reset delay",
        "func": "var m1 = {\n    reset: true,\n    payload: msg.payload,\n    topic: msg.topic\n};\n\nif (msg.topic == \"move\") {\n    msg.delay = 3 * 1000 * 10;\n    if (context.get(\"fanson\") === false){\n        msg.payload = 0;\n        //return [[m1, msg]];\n    }else{\n        //return [m1];\n    }\n\n}\nelse if (msg.topic == \"Hum\") {\n    msg.delay = 15 * 1000 * 60;\n    return [[m1, msg]];\n} else if (msg.topic == \"fans\"){\n    if ((msg.payload === 0)&&(context.get(\"fanson\") === false)){\n        context.set(\"fanson\",true); // to store a variable\n        msg.delay = 30 * 1000 * 60;\n        return [[m1, msg]];\n    }\n    if (msg.payload === 1){\n        context.set(\"fanson\",false);\n        return [msg];\n    }\n}\n//flow.set(\"block_http_request\",1);\n\n//return [msg];\n",
        "outputs": 1,
        "noerr": 0,
        "x": 1210,
        "y": 160,
        "wires": [
            [
                "332fa0c1.b0916",
                "7d994b16.df55f4",
                "6529ab1c.69c634",
                "e3288d98.51ec"
            ]
        ]
    },
    {
        "id": "64f89124.725fc",
        "type": "function",
        "z": "c22de8d6.aec338",
        "name": "hours",
        "func": "var nowDate = new Date();\nvar Hour = nowDate.getHours();\n\n\nif ((Hour>=8)&&(Hour<=21)){\n    msg.payload = 0;\n    //msg.url =\"192.168.1.110/sendAJAX?json={'t':7,'v':\"+msg.payload+\"}\";\n    //context.set(\"fun\",0);\n    return msg;\n}\nelse{\n    //msg.payload = 0;\n     //msg.url =\"http://192.168.1.112/ws2811AJAX?json={'from':[53,44],'to':[88,88],'type':[2,0],'dir':[0,0],'col':[218,128],'wh':[153,128],'br_':[158,128],'num':2,'sp':11,'dr':255,'fd':60,'fdt':3,'br':132}\";\n    \n     //context.set(\"fun\",1);\n     flow.set(\"block_http_request\",0); \n     return null\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1470,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "11148168.90380f",
        "type": "delay",
        "z": "c22de8d6.aec338",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 630,
        "y": 220,
        "wires": [
            [
                "58f0e60.a21ef1c"
            ]
        ]
    },
    {
        "id": "ce779d77.68f7e",
        "type": "function",
        "z": "c22de8d6.aec338",
        "d": true,
        "name": "switch",
        "func": "var msg2 = msg;\n//context.set(\"fun_bathroom\",100);\nvar block_http_request = flow.get(\"block_http_request\");  \n\nif ((msg.payload === 0)&&(block_http_request === 0)){\n    flow.set(\"block_http_request\",1);  \n    //turn on\n    msg.payload = 1;\n    //context.set(\"fun_bathroom\",1);\n    msg2 = null;\n  return [msg,msg2];\n}\n\nif ((msg.payload === 1)&&(block_http_request === 0)){\n    msg2.payload = 1;\n    //flow.set(\"block_http_request\",1);  \n    //msg2.topic = fun_turned_on;\n    //flow.set(\"fun_bathroom_1\",1); \n    msg = null;\n   return [msg,msg2];\n}\n\n\n//return [msg,msg2];\n",
        "outputs": 2,
        "noerr": 0,
        "x": 1210,
        "y": 380,
        "wires": [
            [
                "64f89124.725fc"
            ],
            [
                "11148168.90380f"
            ]
        ]
    },
    {
        "id": "500d751f.8bff9c",
        "type": "inject",
        "z": "c22de8d6.aec338",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "10",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 410,
        "y": 100,
        "wires": [
            [
                "58f0e60.a21ef1c"
            ]
        ]
    },
    {
        "id": "de06e881.1a9898",
        "type": "inject",
        "z": "c22de8d6.aec338",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "0",
        "payloadType": "num",
        "x": 1050,
        "y": 380,
        "wires": [
            [
                "ce779d77.68f7e"
            ]
        ]
    },
    {
        "id": "7f3925e2.e6c56c",
        "type": "function",
        "z": "c22de8d6.aec338",
        "name": "Bathroom",
        "func": "\nvar parsed =(msg.payload);\n\nvar stat0={\n    \"payload\":0,\n    \"topic\":0\n};\nvar stat2={};\n\nstat0.payload =parsed.stat[0];//движение\nstat2.payload =parsed.stat[2];//влажность\n\nvar stat1 ={payload: parsed.stat[1]};//температура\nvar stat3 ={payload: parsed.stat[3]};//3\nvar stat4 ={payload: parsed.stat[4]};//колонки\nvar stat5 ={payload: parsed.stat[5]};//вентилятор леввый\nvar stat6 ={payload: parsed.stat[6]};//вентилятор правый\n\nvar DealyMessageOff={\n    topic:\"\",\n    payload:1};    \nif ((stat4.payload===0)||(stat5.payload===0)||(stat6.payload===0)){\nDealyMessageOff.payload=0;    \n}\n\nstat0.topic = \"move\";\nstat2.topic = \"humidity\";\nreturn [ stat0, stat1, stat2,stat4,stat5,DealyMessageOff ];",
        "outputs": 6,
        "noerr": 0,
        "x": 960,
        "y": 460,
        "wires": [
            [
                "9999acf2.800ba"
            ],
            [
                "cafd095e.217f68"
            ],
            [
                "79c54a55.c9c7a4"
            ],
            [],
            [],
            []
        ]
    },
    {
        "id": "1adb7178.aefdaf",
        "type": "delay",
        "z": "c22de8d6.aec338",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "outputs": 1,
        "x": 790,
        "y": 480,
        "wires": [
            [
                "7f3925e2.e6c56c"
            ]
        ]
    },
    {
        "id": "eb0f831d.f0bb7",
        "type": "ui_chart",
        "z": "c22de8d6.aec338",
        "name": "",
        "group": "cad186fc.6717b8",
        "order": 2,
        "width": "0",
        "height": "0",
        "label": "Температура в ванной",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "604800",
        "cutout": 0,
        "useOneColor": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 1310,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "3a859d97.67a8b2",
        "type": "ui_chart",
        "z": "c22de8d6.aec338",
        "name": "",
        "group": "cad186fc.6717b8",
        "order": 1,
        "width": "0",
        "height": "0",
        "label": "движение в ванной",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "604800",
        "cutout": 0,
        "useOneColor": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 1300,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "1d07a799.fe9c08",
        "type": "switch",
        "z": "c22de8d6.aec338",
        "d": true,
        "name": "switch if 0",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 960,
        "y": 320,
        "wires": [
            [
                "64f89124.725fc"
            ],
            [
                "11148168.90380f"
            ]
        ]
    },
    {
        "id": "fd92a9b4.236e48",
        "type": "function",
        "z": "c22de8d6.aec338",
        "d": true,
        "name": "multi unit delay",
        "func": "let delay = 30* 60 * 1000;\nvar delayName = 'bathroom';\n    myResetFunction();\n//==================================\n\nfunction myDelayFunction() {\n  let t = setTimeout(myEndFunction, delay);\n  context.set(delayName,t);\n}\n\n\nfunction myEndFunction() {\n  //node.send({payload:Date.now()});\n  node.send({payload:msg.payload});  \n}\n\n\nfunction myResetFunction() {\n  let t = context.get(delayName);    \n  clearTimeout(t);\n  //node.send({payload:Date.now()}); \n  //node.send({payload:context.get('pl'),delay:\"reset\"});   \n}\n\n//==================================\n\n\n\n  //node.send({payload:Date.now()});\n  myDelayFunction();  \n\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "x": 1220,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "9999acf2.800ba",
        "type": "rbe",
        "z": "c22de8d6.aec338",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 1110,
        "y": 440,
        "wires": [
            [
                "3a859d97.67a8b2"
            ]
        ]
    },
    {
        "id": "cafd095e.217f68",
        "type": "rbe",
        "z": "c22de8d6.aec338",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 1110,
        "y": 460,
        "wires": [
            [
                "eb0f831d.f0bb7"
            ]
        ]
    },
    {
        "id": "79c54a55.c9c7a4",
        "type": "rbe",
        "z": "c22de8d6.aec338",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 1110,
        "y": 480,
        "wires": [
            [
                "451296fc.c6f218"
            ]
        ]
    },
    {
        "id": "284a2937.bc1d46",
        "type": "function",
        "z": "c22de8d6.aec338",
        "name": "влажность если больше",
        "func": "var nowDate = new Date();\nvar bath = \"turned_bathroom_by_hum\"\nvar Hour = nowDate.getHours();\nvar msg1 = msg;\n\nhum_level = global.get('bath_hum');\nif ((Hour > 7) && (Hour <= 23)) {\n    if (msg.payload > hum_level) {\n        flow.set(bath, 1);\n        msg1.topic = \"Hum\";\n        msg1.payload = 0;\n        return msg1;\n    }\n    if ((msg.topic == \"move\") && (msg.payload == '0')) {\n        msg1 = msg;\n        return null;\n    }\n}\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "x": 1070,
        "y": 40,
        "wires": [
            [
                "c63ce770.7ae7e8",
                "fd92a9b4.236e48",
                "e3288d98.51ec",
                "415281ff.6cde2"
            ]
        ]
    },
    {
        "id": "34c3d0cb.6472f",
        "type": "ui_slider",
        "z": "c22de8d6.aec338",
        "name": "slider_hum",
        "label": "max Влажность",
        "tooltip": "",
        "group": "6a1fd3d5.2b832c",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "",
        "min": "40",
        "max": "100",
        "step": 1,
        "x": 2470,
        "y": 200,
        "wires": [
            [
                "106b881a.b493c8"
            ]
        ]
    },
    {
        "id": "106b881a.b493c8",
        "type": "change",
        "z": "c22de8d6.aec338",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "bath_hum",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2680,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "ecb5ff90.4eb42",
        "type": "change",
        "z": "c22de8d6.aec338",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "bath_hum",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2280,
        "y": 200,
        "wires": [
            [
                "34c3d0cb.6472f"
            ]
        ]
    },
    {
        "id": "e63cbe6.6d20a4",
        "type": "inject",
        "z": "c22de8d6.aec338",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2090,
        "y": 200,
        "wires": [
            [
                "ecb5ff90.4eb42"
            ]
        ]
    },
    {
        "id": "f8d48c34.0cbdc",
        "type": "inject",
        "z": "c22de8d6.aec338",
        "name": "at 23:20",
        "repeat": "",
        "crontab": "20 23 * * *",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "payload": "1",
        "payloadType": "str",
        "x": 1420,
        "y": 220,
        "wires": [
            [
                "54d2298b.6fead8",
                "1349b35a.eedded"
            ]
        ]
    },
    {
        "id": "7d994b16.df55f4",
        "type": "function",
        "z": "c22de8d6.aec338",
        "d": true,
        "name": "variable set bathroom",
        "func": "msg.payload = msg.payload+\"\";\n\n\nvar content = \"включение вентилятора :\"+msg.payload;\nvar ObjectPayload={\n    \"chatId\": \"843873284\",\n    \"type\": \"message\",\n    \"content\":content \n}\nmsg.payload=ObjectPayload;\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 1700,
        "y": 240,
        "wires": [
            [
                "c3d1b48d.749068"
            ]
        ]
    },
    {
        "id": "c3d1b48d.749068",
        "type": "telegram sender",
        "z": "c22de8d6.aec338",
        "name": "sender",
        "bot": "ca786bad.5ac7a8",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1870,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "1349b35a.eedded",
        "type": "function",
        "z": "c22de8d6.aec338",
        "name": "send by seq",
        "func": "var numbers = [4,5,6];\nvar value = 1;\n/////pasrsing answer\nvar parsed =(msg.payload);\nvar actualCount = flow.get(\"actualCount\")||0;\nvar actualNumber = numbers[actualCount];\nif (msg.topic == \"exit\"){\n    return null;\n}\n\nif (typeof msg.payload != \"object\"){\n   msg.url = \"192.168.1.112/sendAJAX?json={\\\"t\\\":\"+actualNumber+\",\\\"v\\\":\"+value+\"}\";\n   msg.topic = \"request\";\n   flow.set(\"actualCount\",0);\n   return msg;\n}\n\n\nvar stat4 ={payload: parseInt(parsed.stat[actualNumber])};//колонки\n// var stat5 ={payload: parsed.stat[5]};//вентилятор леввый\n// var stat6 ={payload: parsed.stat[6]};//вентилятор правый\n\nif (stat4.payload === 0){//dont get it\n    msg.url = \"192.168.1.112/sendAJAX?json={\\\"t\\\":\"+actualNumber+\",\\\"v\\\":\"+value+\"}\";\n    return msg;\n}\nif (stat4.payload === 1){//move to next\n    actualCount += 1;\n    if (actualCount < numbers.length){\n        \n        actualNumber = numbers[actualCount];\n        flow.set(\"actualCount\", actualCount);\n        msg.url = \"192.168.1.112/sendAJAX?json={\\\"t\\\":\"+actualNumber+\",\\\"v\\\":\"+value+\"}\";\n        return msg;\n    }\n    else{\n        //exit from loop\n        msg.topic = \"exit\";\n        flow.set(\"actualCount\",0);\n        return msg;      \n    }\n}\n\n\n\n//return msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1710,
        "y": 180,
        "wires": [
            [
                "3a2b0ebf.367c82"
            ]
        ]
    },
    {
        "id": "3a2b0ebf.367c82",
        "type": "http request",
        "z": "c22de8d6.aec338",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": false,
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1890,
        "y": 180,
        "wires": [
            [
                "1349b35a.eedded"
            ]
        ]
    },
    {
        "id": "54d2298b.6fead8",
        "type": "change",
        "z": "c22de8d6.aec338",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "1",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1600,
        "y": 140,
        "wires": [
            [
                "e3288d98.51ec",
                "415281ff.6cde2"
            ]
        ]
    },
    {
        "id": "45d05603.04f3b8",
        "type": "ui_switch",
        "z": "c22de8d6.aec338",
        "name": "",
        "label": "музыка",
        "tooltip": "",
        "group": "6a1fd3d5.2b832c",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "0",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "x": 1960,
        "y": 40,
        "wires": [
            [
                "5e3d222f.71156c"
            ]
        ]
    },
    {
        "id": "131899d8.2c22a6",
        "type": "http request",
        "z": "c22de8d6.aec338",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "192.168.1.112/sendAJAX?json={\"t\":4,\"v\":{{payload}}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 2350,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "ffa92552.c3da98",
        "type": "rbe",
        "z": "c22de8d6.aec338",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 2200,
        "y": 80,
        "wires": [
            [
                "5d2d4b0b.6fa5d4",
                "6b0e4d93.7d1364"
            ]
        ]
    },
    {
        "id": "b6f38ab4.cd8d18",
        "type": "rbe",
        "z": "c22de8d6.aec338",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 2210,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "5e3d222f.71156c",
        "type": "rbe",
        "z": "c22de8d6.aec338",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 2190,
        "y": 40,
        "wires": [
            [
                "131899d8.2c22a6"
            ]
        ]
    },
    {
        "id": "6529ab1c.69c634",
        "type": "debug",
        "z": "c22de8d6.aec338",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 1760,
        "y": 500,
        "wires": []
    },
    {
        "id": "451296fc.c6f218",
        "type": "ui_text",
        "z": "c22de8d6.aec338",
        "group": "6a1fd3d5.2b832c",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "влажность",
        "format": "{{msg.payload | uppercase}}",
        "layout": "row-spread",
        "x": 1270,
        "y": 480,
        "wires": []
    },
    {
        "id": "dd0305c.c86b2f8",
        "type": "rbe",
        "z": "c22de8d6.aec338",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 1010,
        "y": 160,
        "wires": [
            [
                "c63ce770.7ae7e8"
            ]
        ]
    },
    {
        "id": "6707ea60.23c944",
        "type": "http request",
        "z": "c22de8d6.aec338",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 820,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "b8f073ca.a7d93",
        "type": "inject",
        "z": "a5eb6fcc.fc0cb",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "10",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 240,
        "wires": [
            [
                "e2170356.e2ada"
            ]
        ]
    },
    {
        "id": "e2170356.e2ada",
        "type": "http request",
        "z": "a5eb6fcc.fc0cb",
        "name": "TCPU",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "http://192.168.1.100:8085/api",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 370,
        "y": 240,
        "wires": [
            [
                "34ba8edd.86eb82"
            ]
        ]
    },
    {
        "id": "34ba8edd.86eb82",
        "type": "function",
        "z": "a5eb6fcc.fc0cb",
        "name": "replace",
        "func": "var TCPU={};\nvar TGPU={};\nvar TMOBO={};\nvar changestring;\nvar str;\nstr=msg.payload;\n\n        function findValue(str, value, endvalue) {\n           // value=\"label\";\n            var found = {};\n            var index = 0;\n\n              //str.slice(str.search(value));\n            str.trim();\n            while(str.indexOf(value)!==-1) {\n                var n= str.indexOf(value);\n                str = str.slice(n+value.length);\n                n=str.indexOf(endvalue);\n                found[index++] =parseInt(str.substr(0,n));\n                str = str.slice(str.indexOf(endvalue));\n\n            }\n\n                //found[index++] = str;\n                //found=str.substring(0,str.search(endvalue));\n            //}\n            return found;\n        }\n        var foundedObject=findValue(str,\"value: \\\"\",\"\\\",\");  \n    TCPU.payload=foundedObject[0];\n    TGPU.payload=foundedObject[1];\n    TMOBO.payload=foundedObject[2];\n\n    var gpu={};\n    var cpu={};\n    var system={};\n    gpu.payload = (TGPU.payload-35)*1024/(60-35);\n    cpu.payload = (TCPU.payload-54)*1024/(60-54);\n    system.payload = (TMOBO.payload-20)*1024/(48-20);\n    system.payload=768;\n    gpu.payload=0?1024:gpu.payload;\n    cpu.payload=0?1024:cpu.payload;\n    system.payload=0?1024:system.payload;\n    \nflow.set('TCPU',TCPU);    \n//return [cpu,gpu,system];\nreturn [TCPU,TGPU,TMOBO];",
        "outputs": 3,
        "noerr": 0,
        "x": 520,
        "y": 240,
        "wires": [
            [
                "e053d84a.45df18",
                "1797d227.cdd15e"
            ],
            [
                "d3fecb4b.0136a8",
                "375322bc.5426ee"
            ],
            [
                "b968619e.b1277"
            ]
        ]
    },
    {
        "id": "ef06d5ef.10ab58",
        "type": "http request",
        "z": "a5eb6fcc.fc0cb",
        "name": "GPU",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "http://192.168.1.113/sendAJAX?json={\"t\":3,\"v\":{{payload}}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 870,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "662b6864.c53628",
        "type": "http request",
        "z": "a5eb6fcc.fc0cb",
        "name": "system",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "http://192.168.1.113/sendAJAX?json={\"t\":4,\"v\":{{payload}}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 880,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "d337bcb4.6153a",
        "type": "http request",
        "z": "a5eb6fcc.fc0cb",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1030,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "a5a3d621.d90cb8",
        "type": "function",
        "z": "a5eb6fcc.fc0cb",
        "name": "ws8211",
        "func": "var col=msg.payload;\ncol=(col-0)*255/(1024-0);\nvar AjaxFormat=\"http://192.168.1.113/ws2811AJAX?json={%22from%22:[0],%22to%22:[7],%22type%22:[2],%22dir%22:[0],%22col%22:[\"+col+\"],%22wh%22:[0],%22br_%22:[255],%22num%22:1,%22sp%22:19,%22dr%22:255,%22fd%22:72,%22fdt%22:3,%22br%22:149}\";\nmsg.url=AjaxFormat;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 880,
        "y": 320,
        "wires": [
            [
                "d337bcb4.6153a"
            ]
        ]
    },
    {
        "id": "d3fecb4b.0136a8",
        "type": "delay",
        "z": "a5eb6fcc.fc0cb",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 710,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "b968619e.b1277",
        "type": "delay",
        "z": "a5eb6fcc.fc0cb",
        "name": "",
        "pauseType": "delay",
        "timeout": "200",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 710,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "375322bc.5426ee",
        "type": "delay",
        "z": "a5eb6fcc.fc0cb",
        "name": "",
        "pauseType": "delay",
        "timeout": "300",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 710,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "7b7a97eb.07ad18",
        "type": "http request",
        "z": "a5eb6fcc.fc0cb",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1030,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "966e39b4.f8e798",
        "type": "function",
        "z": "a5eb6fcc.fc0cb",
        "name": "ws8211",
        "func": "var TCPU={};\nvar TGPU={};\nvar TMOBO={};\nvar changestring;\nvar str;\nstr=msg.payload;\n\n        function findValue(str, value, endvalue) {\n           // value=\"label\";\n            var found = {};\n            var index = 0;\n\n              //str.slice(str.search(value));\n            str.trim();\n            while(str.indexOf(value)!==-1) {\n                var n= str.indexOf(value);\n                str = str.slice(n+value.length);\n                n=str.indexOf(endvalue);\n                found[index++] =parseInt(str.substr(0,n));\n                str = str.slice(str.indexOf(endvalue));\n\n            }\n\n                //found[index++] = str;\n                //found=str.substring(0,str.search(endvalue));\n            //}\n            return found;\n        }\n        var foundedObject=findValue(str,\"value: \\\"\",\"\\\",\");  \n    TCPU.payload=foundedObject[0];\n    TGPU.payload=foundedObject[1];\n    TMOBO.payload=foundedObject[2];\n\n    var gpu={};\n    var cpu={};\n    var system={};\n    gpu.payload = (TGPU.payload-35)*255/(60-35);\n    cpu.payload = (TCPU.payload-54)*1024/(60-54);\n    system.payload = (TMOBO.payload-20)*1024/(48-20);\n    system.payload=768;\n    gpu.payload=0?1024:gpu.payload;\n    cpu.payload=0?1024:cpu.payload;\n    system.payload=0?1024:system.payload;\n    \n\n\n\n\n\nvar col=gpu.payload;\nvar url=\"http://192.168.1.113/ws2811AJAX?json=\";\n//col=parseInt((col-0)*255/(1024-0));\nvar AjaxFormat=url+'{\"from\":[0],\"to\":[88],\"type\":[2],\"dir\":[0],\"col\":['+col+'],\"wh\":[254],\"br_\":[255],\"num\":1,\"sp\":100,\"dr\":255,\"fd\":45,\"fdt\":3,\"br\":12}';\nmsg.url=AjaxFormat;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 880,
        "y": 360,
        "wires": [
            [
                "7b7a97eb.07ad18"
            ]
        ]
    },
    {
        "id": "a9835a89.858198",
        "type": "function",
        "z": "a5eb6fcc.fc0cb",
        "name": "bathroomTime",
        "func": "    var g1 = [], g2 = [], g3 = [];\n    var num = 88;\n    var wh = 1;\n    var FullLight = 255;\n    var LowLight = 125;\n    var color =255;\nvar StartEndPosition=122;\n\n    function binIndex(dec, maxSize) {\n        var bin = (dec >>> 0).toString(2);\n        var binchar = [];\n        var i = 0;\n        while (bin.length > 0) {\n            var char = parseInt(bin.charAt(0)) === 1 ? LowLight : FullLight;\n            bin = bin.slice(1);\n            binchar[i] = char;\n            i++;\n        }\n        while (i < maxSize) {\n            binchar[i] = LowLight;\n            i++;\n        }\n        return binchar;\n    }\n\n    var date = new Date();\n    var hour = date.getHours();\n\n    var concatBin;\n    var dempfer = [];\n    var i1 = 0;\n    while (i1 < 17) {\n        dempfer[i1] = FullLight;\n        i1++;\n    }\n    concatBin = dempfer.concat(binIndex(hour, 5)).concat(binIndex(date.getMinutes(), 11)\n        .concat(binIndex(date.getSeconds(), 6)));\n    //console.log(concatBin);\n    for (var i = 0; i < num; i++) {\n\n        g1[i] = 255;\n        g3[i] = concatBin[i] != null ? concatBin[i] : FullLight;\n        //g3[i] = concatBin[i];\n    }\n    //console.log(g1.toString());\n    var JsonString = {};\n    JsonString.num = num;\n    //JsonString.g1 = g1;\n    JsonString.g1 = color;\n    JsonString.g3 = g3;\n    JsonString.wh = wh;\n\n    var Stringify = JSON.stringify(JsonString);\n    var length_str=Stringify.length/200;\n    console.log(length_str);\n    var link = \"192.168.1.112/ws2811AJAXset?json=\" + JSON.stringify(JsonString);\n        msg.url=link;\n    return msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 780,
        "y": 460,
        "wires": [
            [
                "83bc4779.1ebae8"
            ]
        ]
    },
    {
        "id": "83bc4779.1ebae8",
        "type": "http request",
        "z": "a5eb6fcc.fc0cb",
        "name": "bath",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 980,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "16828a7a.6482d6",
        "type": "inject",
        "z": "a5eb6fcc.fc0cb",
        "d": true,
        "name": "10sec",
        "repeat": "10",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 580,
        "y": 460,
        "wires": [
            [
                "f574935.c44607"
            ]
        ]
    },
    {
        "id": "f574935.c44607",
        "type": "function",
        "z": "a5eb6fcc.fc0cb",
        "name": "bathroom",
        "func": "   function getRandomArbitrary(min, max) {\n        return Math.floor(Math.random() * (max - min) + min);\n    }\n       var JsonString = {};\n    JsonString.from = [0];\n    //JsonString.g1 = g1;\n    JsonString.to = [88];\n    JsonString.type = [getRandomArbitrary(1,13)];\n    JsonString.dir = [0];\n    JsonString.col = [0];\n    JsonString.wh = [1];\n    JsonString.br_ = [255];\n    JsonString.num = 1;\n    JsonString.sp = getRandomArbitrary(1,20);\n    JsonString.dr = 255;\n    JsonString.fd = getRandomArbitrary(1,100);\n    JsonString.fdt = 3;\n    JsonString.br = getRandomArbitrary(100,255);\n\n\n\n    var Stringify = JSON.stringify(JsonString);\n    //var length_str = Stringify.length / 200;\n    //console.log(length_str);\n    //msg=function?json={'ws2811_setup':1}\", function (callback) {\n    var link = \"192.168.1.112/ws2811AJAX?json=\" + JSON.stringify(JsonString);\n    msg.url=link;\n    return msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 760,
        "y": 520,
        "wires": [
            [
                "83bc4779.1ebae8"
            ]
        ]
    },
    {
        "id": "c7bcc3bd.0a5b7",
        "type": "function",
        "z": "a5eb6fcc.fc0cb",
        "name": "Bathroom",
        "func": "var parsed =(msg.payload);\nvar stat0={};\nvar stat2={};\n\nstat0.payload =parsed.stat[0];//движение\nstat2.payload =parsed.stat[2];//влажность\n\nvar stat1 ={payload: parsed.stat[1]};//температура\nvar stat3 ={payload: parsed.stat[3]};//3\nvar stat4 ={payload: parsed.stat[4]};//4\nvar stat5 ={payload: parsed.stat[5]};//вентилятор леввый\nvar stat6 ={payload: parsed.stat[6]};//вентилятор правый\nstat0.topic = \"move\";\nstat2.topic = \"humidity\";\n\nvar nowDate = new Date();\nvar Hour = nowDate.getHours();\n\n\nvar switch_bathroom = flow.get(\"$fan.switch_bathroom\");\nswitch_bathroom=1;\nif (stat2.payload>60){\n    if ((Hour>8)&&(Hour<22)&&(switch_bathroom==1)){\n    msg.payload = 0;\n    }\n}else{\n    msg.payload = 1;\n}\n\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 460,
        "y": 520,
        "wires": [
            [
                "4dc0c70b.0892b8"
            ]
        ]
    },
    {
        "id": "4dc0c70b.0892b8",
        "type": "link out",
        "z": "a5eb6fcc.fc0cb",
        "name": "to_fan_bathroom",
        "links": [],
        "x": 555,
        "y": 520,
        "wires": []
    },
    {
        "id": "a2a61a52.121178",
        "type": "function",
        "z": "a5eb6fcc.fc0cb",
        "name": "Decode Weather",
        "func": " var wheather=msg.payload;\n \n    //var wheather = \"{\\\"coord\\\":{\\\"lon\\\":34.9833,\\\"lat\\\":48.45},\\\"weather\\\":[{\\\"id\\\":500,\\\"main\\\":\\\"Rain\\\",\\\"description\\\":\\\"light rain\\\",\\\"icon\\\":\\\"10d\\\"},{\\\"id\\\":701,\\\"main\\\":\\\"Mist\\\",\\\"description\\\":\\\"mist\\\",\\\"icon\\\":\\\"50d\\\"}],\\\"base\\\":\\\"stations\\\",\\\"main\\\":{\\\"temp\\\":279.48,\\\"feels_like\\\":275.13,\\\"temp_min\\\":279.15,\\\"temp_max\\\":279.82,\\\"pressure\\\":1002,\\\"humidity\\\":100},\\\"visibility\\\":3500,\\\"wind\\\":{\\\"speed\\\":5,\\\"deg\\\":190},\\\"rain\\\":{\\\"1h\\\":0.11},\\\"clouds\\\":{\\\"all\\\":75},\\\"dt\\\":1612449242,\\\"sys\\\":{\\\"type\\\":1,\\\"id\\\":8901,\\\"country\\\":\\\"UA\\\",\\\"sunrise\\\":1612415098,\\\"sunset\\\":1612449779},\\\"timezone\\\":7200,\\\"id\\\":709930,\\\"name\\\":\\\"Dnipro\\\",\\\"cod\\\":200}\";\n    // var wheather2=\"{\\\"coord\\\":{\\\"lon\\\":34.9833,\\\"lat\\\":48.45},\\\"weather\\\":[{\\\"id\\\":803,\\\"main\\\":\\\"Clouds\\\",\\\"description\\\":\\\"broken clouds\\\",\\\"icon\\\":\\\"04n\\\"}],\\\"base\\\":\\\"stations\\\",\\\"main\\\":{\\\"temp\\\":267.1,\\\"feels_like\\\":257.04,\\\"temp_min\\\":267.04,\\\"temp_max\\\":267.15,\\\"pressure\\\":1018,\\\"humidity\\\":73},\\\"visibility\\\":10000,\\\"wind\\\":{\\\"speed\\\":10,\\\"deg\\\":320},\\\"clouds\\\":{\\\"all\\\":75},\\\"dt\\\":1612555439,\\\"sys\\\":{\\\"type\\\":1,\\\"id\\\":8901,\\\"country\\\":\\\"UA\\\",\\\"sunrise\\\":1612501412,\\\"sunset\\\":1612536277},\\\"timezone\\\":7200,\\\"id\\\":709930,\\\"name\\\":\\\"Dnipro\\\",\\\"cod\\\":200}\";\n    // var wheather3=\"{\\\"coord\\\":{\\\"lon\\\":34.9833,\\\"lat\\\":48.45},\\\"weather\\\":[{\\\"id\\\":800,\\\"main\\\":\\\"Clear\\\",\\\"description\\\":\\\"clear sky\\\",\\\"icon\\\":\\\"01d\\\"}],\\\"base\\\":\\\"stations\\\",\\\"main\\\":{\\\"temp\\\":269.43,\\\"feels_like\\\":263.53,\\\"temp_min\\\":268.71,\\\"temp_max\\\":270.15,\\\"pressure\\\":1016,\\\"humidity\\\":59},\\\"visibility\\\":10000,\\\"wind\\\":{\\\"speed\\\":4,\\\"deg\\\":290},\\\"clouds\\\":{\\\"all\\\":0},\\\"dt\\\":1612612299,\\\"sys\\\":{\\\"type\\\":1,\\\"id\\\":8901,\\\"country\\\":\\\"UA\\\",\\\"sunrise\\\":1612587724,\\\"sunset\\\":1612622776},\\\"timezone\\\":7200,\\\"id\\\":709930,\\\"name\\\":\\\"Dnipro\\\",\\\"cod\\\":200}\";\n    var wheather_parse = JSON.parse(wheather);\n    var feels_like = Math.round(wheather_parse.main.feels_like - 273, 15);\n    var temp = Math.round(wheather_parse.main.temp - 273, 15);\n    var signigicant_wheather = 0;\n    if (wheather_parse.weather[0].main === ('Rain')) {\n        signigicant_wheather = 4;\n    } else if (wheather_parse.weather[0].main === ('Clouds')) {\n        signigicant_wheather = 1;\n    } else if (wheather_parse.weather[0].main === ('Snow')) {\n        signigicant_wheather = 5;\n    } else if (wheather_parse.weather[0].main === ('Clear')) {\n        signigicant_wheather = 0;//Clear\n    }\n\n    //console.log(wheather_parse.weather[0].main===('Clear'));\n    var main = (wheather_parse.weather)[0].description;\n    var wind = (wheather_parse.wind.speed);\n    var wind_dir = (wheather_parse.wind.deg);\n    var sunrise=(new Date(wheather_parse.sys.sunrise*1000).getHours()*60+(new Date(wheather_parse.sys.sunrise*1000).getMinutes()));\n    var sunset=(new Date(wheather_parse.sys.sunset*1000).getHours()*60+(new Date(wheather_parse.sys.sunset*1000).getMinutes()));\n    var nowtime=(new Date().getHours()*60+(new Date().getMinutes()));\n    var isSunrise = ((sunrise)<(nowtime)&&((sunset)>(nowtime)))?255:100;\n\n    function getMinMax(value, minOutput, maxOutput, maxInput) {\n        var middle = 0;\n        middle = Math.round((value - minOutput) * maxInput / (maxOutput - minOutput));\n        return middle;\n    }\n\n    var ws8211 = \"{\\\"from\\\":[0],\\\"to\\\":[88],\\\"type\\\":[1],\\\"dir\\\":[0],\\\"col\\\":[0],\\\"wh\\\":[128],\\\"br_\\\":[230],\\\"num\\\":1,\\\"sp\\\":254,\\\"dr\\\":255,\\\"fd\\\":4,\\\"fdt\\\":3,\\\"br\\\":255}\";\n    var JsonString = {};\n    JsonString.from = [0];\n    //JsonString.g1 = g1;\n    JsonString.to = [41];\n    JsonString.type = [signigicant_wheather];\n    JsonString.dir = [wind_dir < 180 ? 0 : 1];\n    JsonString.col = [getMinMax(temp, -20, 40, 255)];\n    JsonString.wh = [255];\n    JsonString.br_ = [isSunrise];\n    JsonString.num = 1;\n    JsonString.sp = getMinMax(wind, 0, 15, 255);\n    JsonString.dr = 255;\n    JsonString.fd = ((signigicant_wheather == 1) || (signigicant_wheather == 0)) ? 100 : 100;\n    JsonString.fdt = 3;\n    JsonString.br = 255;\n\n    var url = \"http://192.168.1.111/ws2811AJAX?json=\";\n    var AjaxFormat = url + JSON.stringify(JsonString);\n    console.log(AjaxFormat);\n    msg.url = AjaxFormat;\n    return msg;\n    console.log(AjaxFormat);\n    msg.url = AjaxFormat;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1090,
        "y": 660,
        "wires": [
            [
                "2fa56b82.57dd14"
            ]
        ]
    },
    {
        "id": "2fa56b82.57dd14",
        "type": "http request",
        "z": "a5eb6fcc.fc0cb",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1290,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "5882108e.aa06d",
        "type": "telegram sender",
        "z": "a5eb6fcc.fc0cb",
        "name": "send_watering",
        "bot": "ca786bad.5ac7a8",
        "haserroroutput": false,
        "outputs": 1,
        "x": 380,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "c3b0e73.fb45918",
        "type": "function",
        "z": "a5eb6fcc.fc0cb",
        "name": "message",
        "func": "var content = msg.topic+\" payload:\"+msg.payload;\nvar ObjectPayload={\n    \"chatId\": \"843873284\",\n    \"type\": \"message\",\n    \"content\":content \n}\nmsg.payload=ObjectPayload;\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 220,
        "y": 460,
        "wires": [
            [
                "5882108e.aa06d"
            ]
        ]
    },
    {
        "id": "4b30a613.66ff58",
        "type": "rbe",
        "z": "a5eb6fcc.fc0cb",
        "name": "",
        "func": "deadband",
        "gap": "10",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 300,
        "y": 520,
        "wires": [
            [
                "c7bcc3bd.0a5b7"
            ]
        ]
    },
    {
        "id": "3ea14a5d.c76086",
        "type": "inject",
        "z": "a5eb6fcc.fc0cb",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 320,
        "y": 1540,
        "wires": [
            [
                "e4e814e.4e3dbe8"
            ]
        ]
    },
    {
        "id": "9641d964.f78c18",
        "type": "inject",
        "z": "a5eb6fcc.fc0cb",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 320,
        "y": 1620,
        "wires": [
            [
                "4ebaafae.1cbc5"
            ]
        ]
    },
    {
        "id": "e4e814e.4e3dbe8",
        "type": "change",
        "z": "a5eb6fcc.fc0cb",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "dividend",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 500,
        "y": 1540,
        "wires": [
            [
                "1dec84bb.1327db"
            ]
        ]
    },
    {
        "id": "4ebaafae.1cbc5",
        "type": "change",
        "z": "a5eb6fcc.fc0cb",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "divisor",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 500,
        "y": 1620,
        "wires": [
            [
                "1dec84bb.1327db"
            ]
        ]
    },
    {
        "id": "1dec84bb.1327db",
        "type": "function",
        "z": "a5eb6fcc.fc0cb",
        "name": "",
        "func": "\nreturn {payload:(flow.get('dividend')/flow.get('divisor'))};",
        "outputs": 1,
        "noerr": 0,
        "x": 710,
        "y": 1580,
        "wires": [
            []
        ]
    },
    {
        "id": "710f56b0.80d628",
        "type": "link in",
        "z": "a5eb6fcc.fc0cb",
        "name": "Bathroom_out_deadband",
        "links": [],
        "x": 175,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "e053d84a.45df18",
        "type": "ui_chart",
        "z": "a5eb6fcc.fc0cb",
        "name": "",
        "group": "ce3b49b9.4b9e18",
        "order": 1,
        "width": 0,
        "height": 0,
        "label": "TCPU",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 990,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "1797d227.cdd15e",
        "type": "http request",
        "z": "a5eb6fcc.fc0cb",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": false,
        "url": "http://192.168.1.115/sendAJAX?json={%22t%22:127,%22v%22:0}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 570,
        "y": 140,
        "wires": [
            [
                "826444eb.be0678"
            ]
        ]
    },
    {
        "id": "826444eb.be0678",
        "type": "function",
        "z": "a5eb6fcc.fc0cb",
        "name": "cpu 192.168.1.115",
        "func": "var parsed =(msg.payload);\n\n\nvar prevTemp;\nvar nowTemp;\nif (flow.get(\"prevTemp\")!==0){\n    prevTemp = flow.get(\"prevTemp\");\n}\n\nif (parsed.stat[0]!==0){\n    flow.set(\"prevTemp\",parsed.stat[0]);\n    nowTemp = parsed.stat[0];\n}else{\n    nowTemp = flow.get(\"prevTemp\");\n}\nvar stat0 ={topic:\"temp\", payload: nowTemp};//температура\n\nvar TCPU=flow.get('TCPU');\nvar difference = {payload: (TCPU.payload - nowTemp)};\n\nreturn [difference,stat0];",
        "outputs": 2,
        "noerr": 0,
        "x": 790,
        "y": 60,
        "wires": [
            [
                "b7e89044.7eb01"
            ],
            [
                "1699b447.145a4c"
            ]
        ]
    },
    {
        "id": "b7e89044.7eb01",
        "type": "ui_chart",
        "z": "a5eb6fcc.fc0cb",
        "d": true,
        "name": "",
        "group": "fc599eb8.f87e",
        "order": 2,
        "width": 0,
        "height": 0,
        "label": "TCPU-difference",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 1010,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "1699b447.145a4c",
        "type": "ui_chart",
        "z": "a5eb6fcc.fc0cb",
        "name": "",
        "group": "ce3b49b9.4b9e18",
        "order": 1,
        "width": 0,
        "height": 0,
        "label": "TCPU-sensor",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 1000,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "cb60b23b.cf492",
        "type": "http request",
        "z": "af702991.bdca58",
        "name": "192.168.1.150",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "192.168.1.150/function?json={reboot:1}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 440,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "de173a76.586b08",
        "type": "inject",
        "z": "af702991.bdca58",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "00 12 * * *",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "payload": "12:00",
        "payloadType": "str",
        "x": 70,
        "y": 120,
        "wires": [
            [
                "cb60b23b.cf492",
                "dd2454e0.28fe48"
            ]
        ]
    },
    {
        "id": "dd2454e0.28fe48",
        "type": "function",
        "z": "af702991.bdca58",
        "name": "set to 0",
        "func": "flow.set('watering_count',0);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "1255807b67a6a79c",
        "type": "mqtt in",
        "z": "af702991.bdca58",
        "name": "",
        "topic": "node-red/reboot",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "a7804332c06e238f",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 80,
        "y": 240,
        "wires": [
            [
                "cb60b23b.cf492",
                "dc08f8062205ce2f"
            ]
        ]
    },
    {
        "id": "dc08f8062205ce2f",
        "type": "http request",
        "z": "af702991.bdca58",
        "name": "192.168.1.151",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "192.168.1.151/function?json={reboot:1}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 440,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "ed27cae4.70b728",
        "type": "inject",
        "z": "772e6979.67cd08",
        "name": "update",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "30",
        "crontab": "",
        "once": true,
        "onceDelay": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 220,
        "y": 240,
        "wires": [
            [
                "f25a9b1d.c6fce8",
                "21faa622.8c25da",
                "7cf01d46.a3cad4",
                "7780c9ca.7581b8",
                "c63cb373.ce94f",
                "4e1aaf390d435b7f",
                "77da6657aaf50832"
            ]
        ]
    },
    {
        "id": "240a76f3.9953ea",
        "type": "function",
        "z": "772e6979.67cd08",
        "name": "",
        "func": "msg.payload = msg.payload.loadavg[0];\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 459,
        "y": 100,
        "wires": [
            [
                "51dfac0c.fdc9c4"
            ]
        ]
    },
    {
        "id": "5d85387c.957fb8",
        "type": "function",
        "z": "772e6979.67cd08",
        "name": "",
        "func": "msg.payload = msg.payload.loadavg[1];\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 138,
        "wires": [
            [
                "79d3dbc8.390014"
            ]
        ]
    },
    {
        "id": "b33d4d45.a6673",
        "type": "function",
        "z": "772e6979.67cd08",
        "name": "",
        "func": "msg.payload = msg.payload.loadavg[2];\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 459,
        "y": 181,
        "wires": [
            [
                "1ff0080f.4e10c8"
            ]
        ]
    },
    {
        "id": "51dfac0c.fdc9c4",
        "type": "ui_gauge",
        "z": "772e6979.67cd08",
        "name": "CPU Load 1",
        "group": "7853403.230cdc",
        "order": 1,
        "width": "0",
        "height": "0",
        "gtype": "gage",
        "title": "1 Minute",
        "label": "load",
        "format": "{{value | number:2}}",
        "min": 0,
        "max": "4",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "x": 627,
        "y": 99,
        "wires": []
    },
    {
        "id": "79d3dbc8.390014",
        "type": "ui_gauge",
        "z": "772e6979.67cd08",
        "name": "CPU Load 2",
        "group": "7853403.230cdc",
        "order": 2,
        "width": "3",
        "height": "3",
        "gtype": "gage",
        "title": "5 Minutes",
        "label": "load",
        "format": "{{value | number:2}}",
        "min": 0,
        "max": "4",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "x": 627,
        "y": 140,
        "wires": []
    },
    {
        "id": "1ff0080f.4e10c8",
        "type": "ui_gauge",
        "z": "772e6979.67cd08",
        "name": "CPU Load 3",
        "group": "7853403.230cdc",
        "order": 4,
        "width": "3",
        "height": "3",
        "gtype": "gage",
        "title": "15 Minutes",
        "label": "load",
        "format": "{{value | number:2}}",
        "min": 0,
        "max": "4",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "x": 625,
        "y": 182,
        "wires": []
    },
    {
        "id": "e6b8a679.aff648",
        "type": "function",
        "z": "772e6979.67cd08",
        "name": "",
        "func": "msg.payload = msg.payload.memusage;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 242,
        "y": 694,
        "wires": [
            [
                "cc57cdea.f9387"
            ]
        ]
    },
    {
        "id": "cc57cdea.f9387",
        "type": "ui_gauge",
        "z": "772e6979.67cd08",
        "name": "Memory Usage",
        "group": "1d1da0fc.6ab84f",
        "order": 1,
        "width": "0",
        "height": "0",
        "gtype": "gage",
        "title": "1 Minute",
        "label": "Usage",
        "format": "{{value | number:2}}",
        "min": 0,
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "x": 426,
        "y": 698,
        "wires": []
    },
    {
        "id": "dd0cca19.6f90a8",
        "type": "function",
        "z": "772e6979.67cd08",
        "name": "",
        "func": "function formatBytes(bytes,decimals) {\n   if(bytes === 0) return '0 Byte';\n   var k = 1000; // or 1024 for binary\n   var dm = decimals + 1 || 3;\n   var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n   var i = Math.floor(Math.log(bytes) / Math.log(k));\n   return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n}\n\nmsg.payload = formatBytes(msg.payload.totalmem);\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 244,
        "y": 737,
        "wires": [
            [
                "4aeaebd1.24f4c4"
            ]
        ]
    },
    {
        "id": "308d683f.10ab08",
        "type": "function",
        "z": "772e6979.67cd08",
        "name": "",
        "func": "function formatBytes(bytes,decimals) {\n   if(bytes === 0) return '0 Byte';\n   var k = 1000; // or 1024 for binary\n   var dm = decimals + 1 || 3;\n   var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n   var i = Math.floor(Math.log(bytes) / Math.log(k));\n   return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n}\n\nmsg.payload = formatBytes(msg.payload.freemem);\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 242,
        "y": 783,
        "wires": [
            [
                "ef649e9b.dce7d"
            ]
        ]
    },
    {
        "id": "4aeaebd1.24f4c4",
        "type": "ui_text",
        "z": "772e6979.67cd08",
        "group": "1d1da0fc.6ab84f",
        "order": 2,
        "width": "0",
        "height": "0",
        "name": "",
        "label": "Total Memory",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 425,
        "y": 741,
        "wires": []
    },
    {
        "id": "ef649e9b.dce7d",
        "type": "ui_text",
        "z": "772e6979.67cd08",
        "group": "1d1da0fc.6ab84f",
        "order": 3,
        "width": "0",
        "height": "0",
        "name": "",
        "label": "Free Memory",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 410,
        "y": 780,
        "wires": []
    },
    {
        "id": "20567afa.bd4466",
        "type": "function",
        "z": "772e6979.67cd08",
        "name": "",
        "func": "function timeConversion(millisec) {\n\n    var seconds = (millisec / 1000).toFixed(1);\n\n    var minutes = (millisec / (1000 * 60)).toFixed(1);\n\n    var hours = (millisec / (1000 * 60 * 60)).toFixed(1);\n\n    var days = (millisec / (1000 * 60 * 60 * 24)).toFixed(1);\n\n    if (seconds < 60) {\n        return seconds + \" Sec\";\n    } else if (minutes < 60) {\n        return minutes + \" Min\";\n    } else if (hours < 24) {\n        return hours + \" Hrs\";\n    } else {\n        return days + \" Days\"\n    }\n}\n\nmsg.payload = timeConversion(msg.payload.uptime * 1000);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 532,
        "y": 348,
        "wires": [
            [
                "91bb24ba.6dba48"
            ]
        ]
    },
    {
        "id": "91bb24ba.6dba48",
        "type": "ui_text",
        "z": "772e6979.67cd08",
        "group": "a9912d64.97094",
        "order": 1,
        "width": "0",
        "height": "0",
        "name": "",
        "label": "Uptime",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 687,
        "y": 347,
        "wires": []
    },
    {
        "id": "f745cace.30f2d8",
        "type": "function",
        "z": "772e6979.67cd08",
        "name": "",
        "func": "msg.payload = msg.payload.hostname;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 531,
        "y": 385,
        "wires": [
            [
                "f9bfd652.4be908"
            ]
        ]
    },
    {
        "id": "f9bfd652.4be908",
        "type": "ui_text",
        "z": "772e6979.67cd08",
        "group": "a9912d64.97094",
        "order": 1,
        "width": "0",
        "height": "0",
        "name": "",
        "label": "Hostname",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 699,
        "y": 387,
        "wires": []
    },
    {
        "id": "3153bd68.82b782",
        "type": "function",
        "z": "772e6979.67cd08",
        "name": "",
        "func": "msg.payload = msg.payload.platform;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 533,
        "y": 423,
        "wires": [
            [
                "6c7dc269.a0180c"
            ]
        ]
    },
    {
        "id": "6c7dc269.a0180c",
        "type": "ui_text",
        "z": "772e6979.67cd08",
        "group": "a9912d64.97094",
        "order": 1,
        "width": "0",
        "height": "0",
        "name": "",
        "label": "Platform",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 695,
        "y": 426,
        "wires": []
    },
    {
        "id": "7eec4b7e.c15ad4",
        "type": "function",
        "z": "772e6979.67cd08",
        "name": "",
        "func": "msg.payload = msg.payload.arch;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 534,
        "y": 462,
        "wires": [
            [
                "a6e5bcd3.7c90e"
            ]
        ]
    },
    {
        "id": "a6e5bcd3.7c90e",
        "type": "ui_text",
        "z": "772e6979.67cd08",
        "group": "a9912d64.97094",
        "order": 1,
        "width": "0",
        "height": "0",
        "name": "",
        "label": "Arch",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 683,
        "y": 466,
        "wires": []
    },
    {
        "id": "6b4d7f76.271fb",
        "type": "function",
        "z": "772e6979.67cd08",
        "name": "",
        "func": "msg.payload = msg.payload.release;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 535,
        "y": 498,
        "wires": [
            [
                "f7e2d4a1.f3acf8"
            ]
        ]
    },
    {
        "id": "f7e2d4a1.f3acf8",
        "type": "ui_text",
        "z": "772e6979.67cd08",
        "group": "a9912d64.97094",
        "order": 1,
        "width": "0",
        "height": "0",
        "name": "",
        "label": "Release",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 695,
        "y": 504,
        "wires": []
    },
    {
        "id": "8a945e71.8626b",
        "type": "function",
        "z": "772e6979.67cd08",
        "name": "",
        "func": "msg.payload = msg.payload.cpus[0].model;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 534,
        "y": 539,
        "wires": [
            [
                "6ce3fe6a.0088f"
            ]
        ]
    },
    {
        "id": "6ce3fe6a.0088f",
        "type": "ui_text",
        "z": "772e6979.67cd08",
        "group": "a9912d64.97094",
        "order": 1,
        "width": "0",
        "height": "0",
        "name": "",
        "label": "CPU",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "Courier,monospace",
        "fontSize": "14",
        "color": "#ffffff",
        "x": 686,
        "y": 547,
        "wires": []
    },
    {
        "id": "a25b88bc.6ead88",
        "type": "function",
        "z": "772e6979.67cd08",
        "name": "",
        "func": "msg.payload = msg.payload.loadavg[0];\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 464,
        "y": 224,
        "wires": [
            [
                "a978ef7f.6851a"
            ]
        ]
    },
    {
        "id": "a978ef7f.6851a",
        "type": "ui_chart",
        "z": "772e6979.67cd08",
        "name": "CPU Load - Historical",
        "group": "7853403.230cdc",
        "order": 0,
        "width": "0",
        "height": "0",
        "label": "24 Hours",
        "chartType": "line",
        "legend": "false",
        "xformat": "%H:%M:%S",
        "interpolate": "linear",
        "nodata": "",
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderUnit": "86400",
        "outputs": 1,
        "x": 656,
        "y": 224,
        "wires": [
            []
        ]
    },
    {
        "id": "fbd3e7db.8ca558",
        "type": "function",
        "z": "772e6979.67cd08",
        "name": "",
        "func": "msg.payload = msg.payload.memusage;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 239,
        "y": 655,
        "wires": [
            [
                "ae72c338.cf1ff"
            ]
        ]
    },
    {
        "id": "ae72c338.cf1ff",
        "type": "ui_chart",
        "z": "772e6979.67cd08",
        "name": "Memory - 24 Hours",
        "group": "1d1da0fc.6ab84f",
        "order": 0,
        "width": "0",
        "height": "0",
        "label": "24 Hours",
        "chartType": "line",
        "legend": "false",
        "xformat": "%H:%M:%S",
        "interpolate": "linear",
        "nodata": "",
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderUnit": "86400",
        "outputs": 1,
        "x": 437,
        "y": 658,
        "wires": [
            []
        ]
    },
    {
        "id": "6d8c1a68.736494",
        "type": "comment",
        "z": "772e6979.67cd08",
        "name": "CPU Load",
        "info": "",
        "x": 614,
        "y": 52,
        "wires": []
    },
    {
        "id": "c759448a.854258",
        "type": "comment",
        "z": "772e6979.67cd08",
        "name": "Memory Usage",
        "info": "",
        "x": 420,
        "y": 600,
        "wires": []
    },
    {
        "id": "ff2b3794.382148",
        "type": "comment",
        "z": "772e6979.67cd08",
        "name": "System Information",
        "info": "",
        "x": 713,
        "y": 297,
        "wires": []
    },
    {
        "id": "f25a9b1d.c6fce8",
        "type": "OS",
        "z": "772e6979.67cd08",
        "name": "",
        "x": 360,
        "y": 393,
        "wires": [
            [
                "f745cace.30f2d8",
                "3153bd68.82b782",
                "7eec4b7e.c15ad4",
                "6b4d7f76.271fb"
            ]
        ]
    },
    {
        "id": "c63cb373.ce94f",
        "type": "Uptime",
        "z": "772e6979.67cd08",
        "name": "",
        "x": 371,
        "y": 348,
        "wires": [
            [
                "20567afa.bd4466"
            ]
        ]
    },
    {
        "id": "21faa622.8c25da",
        "type": "CPUs",
        "z": "772e6979.67cd08",
        "name": "",
        "x": 360,
        "y": 438,
        "wires": [
            [
                "8a945e71.8626b"
            ]
        ]
    },
    {
        "id": "7780c9ca.7581b8",
        "type": "Loadavg",
        "z": "772e6979.67cd08",
        "name": "",
        "x": 297,
        "y": 160,
        "wires": [
            [
                "240a76f3.9953ea",
                "5d85387c.957fb8",
                "b33d4d45.a6673",
                "a25b88bc.6ead88",
                "a53265a63a596b0c"
            ]
        ]
    },
    {
        "id": "7cf01d46.a3cad4",
        "type": "Memory",
        "z": "772e6979.67cd08",
        "name": "",
        "x": 260,
        "y": 500,
        "wires": [
            [
                "e6b8a679.aff648",
                "dd0cca19.6f90a8",
                "308d683f.10ab08",
                "fbd3e7db.8ca558",
                "a53265a63a596b0c"
            ]
        ]
    },
    {
        "id": "4e1aaf390d435b7f",
        "type": "Drives",
        "z": "772e6979.67cd08",
        "name": "",
        "x": 230,
        "y": 880,
        "wires": [
            [
                "64f704f90b4d1376",
                "a53265a63a596b0c"
            ]
        ]
    },
    {
        "id": "45ce266042c71c11",
        "type": "ui_text",
        "z": "772e6979.67cd08",
        "group": "1d1da0fc.6ab84f",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Dsik usage capacity",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 660,
        "y": 880,
        "wires": []
    },
    {
        "id": "64f704f90b4d1376",
        "type": "function",
        "z": "772e6979.67cd08",
        "name": "function",
        "func": "// Function to calculate available size percentage for /dev/sda1\nlet data = msg.payload;\nfunction getAvailablePercentage(filesystems) {\n    for (let fs of filesystems) {\n        if (fs.filesystem === \"/dev/sda3\") {\n            let availablePercentage = (fs.available / fs.size) * 100;\n            return availablePercentage.toFixed(2) + \"%\";\n        }\n    }\n    return \"Filesystem not found\";\n}\n\n// Get the available size percentage for /dev/sda1\nlet availablePercentage = getAvailablePercentage(data);\nmsg.payload = availablePercentage\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 880,
        "wires": [
            [
                "45ce266042c71c11"
            ]
        ]
    },
    {
        "id": "f831be3391c39a83",
        "type": "function",
        "z": "772e6979.67cd08",
        "name": "convert to inno DB",
        "func": "let fields = {};\nlet payload = msg.payload;\n\n//node.warn(\"Incoming payload: \" + JSON.stringify(payload));\n\n// 1. Disk Usage\nif (Array.isArray(payload)) {\n    for (let fs of payload) {\n        if (fs.filesystem === \"/dev/sda3\") {\n            fields[\"disk_total_MB\"] = +(fs.size / 1024 / 1024);\n            fields[\"disk_available_MB\"] = +(fs.available / 1024 / 1024);\n            fields[\"disk_used_MB\"] = +(fs.used / 1024 / 1024);\n            fields[\"disk_used_percent\"] = +(fs.capacity * 100);\n        }\n    }\n}\n\n// 2. CPU Load Average\nif (typeof payload === \"object\" && Array.isArray(payload.loadavg)) {\n    for (let i = 0; i < payload.loadavg.length; i++) {\n        fields[\"cpu_load_\" + i] = +payload.loadavg[i];\n    }\n}\n\n// 3. Memory Info\nif (typeof payload === \"object\" && payload.totalmem !== undefined && payload.memusage !== undefined) {\n    fields[\"memory_total_MB\"] = +(payload.totalmem / 1024 / 1024);\n    fields[\"memory_free_MB\"] = +(payload.freemem / 1024 / 1024);\n    fields[\"memory_used_percent\"] = +payload.memusage;\n}\n\n// 4. Проверка наличия полей\nif (Object.keys(fields).length === 0) {\n    node.warn(\"No valid fields found in payload: \" + JSON.stringify(payload));\n    return null;\n}\n\n// 5. Подготовка Influx-сообщения\nmsg.payload = [\n    {\n        measurement: \"system_monitor\",\n        fields: fields,\n        tags: {\n            location: \"ubuntu-server\"\n        },\n        timestamp: new Date()\n    }\n];\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 440,
        "wires": [
            [
                "26778a47b0b0bf5e"
            ]
        ]
    },
    {
        "id": "26778a47b0b0bf5e",
        "type": "influxdb batch",
        "z": "772e6979.67cd08",
        "influxdb": "8818288d473df902",
        "precision": "",
        "retentionPolicy": "",
        "name": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "organisation",
        "bucket": "bucket",
        "x": 1330,
        "y": 440,
        "wires": []
    },
    {
        "id": "a53265a63a596b0c",
        "type": "delay",
        "z": "772e6979.67cd08",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 950,
        "y": 320,
        "wires": [
            [
                "f831be3391c39a83"
            ]
        ]
    },
    {
        "id": "77da6657aaf50832",
        "type": "cpu",
        "z": "772e6979.67cd08",
        "name": "",
        "msgCore": true,
        "msgOverall": false,
        "msgArray": false,
        "msgTemp": false,
        "x": 470,
        "y": 1040,
        "wires": [
            [
                "6663746e2a8da655"
            ]
        ]
    },
    {
        "id": "6663746e2a8da655",
        "type": "function",
        "z": "772e6979.67cd08",
        "name": "convert to inno DB",
        "func": "let fields = {};\nlet payload = msg.payload;\n\nfields[msg.topic] = parseInt(msg.payload)\n\n\nmsg.payload = [\n    {\n        measurement: \"system_monitor\",\n        fields: fields,\n        tags: {\n            location: \"ubuntu-server\"\n        },\n        timestamp: new Date()\n    }\n];\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 1040,
        "wires": [
            [
                "29a52314d00f05a1"
            ]
        ]
    },
    {
        "id": "29a52314d00f05a1",
        "type": "influxdb batch",
        "z": "772e6979.67cd08",
        "influxdb": "8818288d473df902",
        "precision": "",
        "retentionPolicy": "",
        "name": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "organisation",
        "bucket": "bucket",
        "x": 970,
        "y": 1040,
        "wires": []
    },
    {
        "id": "40e35cf99b1b1190",
        "type": "function",
        "z": "86d9b15ce96130b5",
        "d": true,
        "name": "reset delay",
        "func": "msg.delay = 20*1000;\nvar m1 = {reset:true};\nreturn [[m1,msg]];",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 160,
        "wires": [
            [
                "a03a56921aa2cf03"
            ]
        ]
    },
    {
        "id": "525f79bc2048bd56",
        "type": "comment",
        "z": "86d9b15ce96130b5",
        "name": "Example Reset Delay",
        "info": "",
        "x": 180,
        "y": 100,
        "wires": []
    },
    {
        "id": "a03a56921aa2cf03",
        "type": "delay",
        "z": "86d9b15ce96130b5",
        "d": true,
        "name": "",
        "pauseType": "delay",
        "timeout": "20",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 380,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "0ff243b97851757c",
        "type": "comment",
        "z": "86d9b15ce96130b5",
        "name": "Get external IP",
        "info": "",
        "x": 140,
        "y": 320,
        "wires": []
    },
    {
        "id": "128a6d8d.ae3d52",
        "type": "inject",
        "z": "86d9b15ce96130b5",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload",
                "v": "",
                "vt": "date"
            },
            {
                "p": "topic",
                "v": "",
                "vt": "str"
            }
        ],
        "repeat": "86400",
        "crontab": "",
        "once": true,
        "onceDelay": "30",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 400,
        "wires": [
            [
                "70ccde70.77381"
            ]
        ]
    },
    {
        "id": "70ccde70.77381",
        "type": "http request",
        "z": "86d9b15ce96130b5",
        "d": true,
        "name": "IP",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://api.ipify.org?format=json",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 310,
        "y": 400,
        "wires": [
            [
                "f185365a.278e48",
                "a492b93f.a1b348"
            ]
        ]
    },
    {
        "id": "ac450f9c.5ad57",
        "type": "e-mail",
        "z": "86d9b15ce96130b5",
        "d": true,
        "server": "smtp.gmail.com",
        "port": "465",
        "secure": true,
        "tls": true,
        "name": "spspider95@gmail.com",
        "dname": "spspider95",
        "x": 650,
        "y": 400,
        "wires": []
    },
    {
        "id": "f185365a.278e48",
        "type": "function",
        "z": "86d9b15ce96130b5",
        "d": true,
        "name": "mail",
        "func": "\nmsg.topic=\"IP\";\nmsg.to=\"spspider95@gmail.com\";\nmsg.from=\"IPAdress\";\n\nvar thatIP= msg.payload.ip;\n\nvar storedIP = context.get ('ip') || 0;\nif(storedIP!==thatIP){\ncontext.set(\"ip\",thatIP);\nmsg.payload=\"http://\"+thatIP+\":1880/ui\";\n}\nelse{\n    return null;\n}\nif (thatIP===undefined){return null;}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 400,
        "wires": [
            [
                "ac450f9c.5ad57"
            ]
        ]
    },
    {
        "id": "9a81fe6e.7b3c3",
        "type": "telegram sender",
        "z": "86d9b15ce96130b5",
        "d": true,
        "name": "sender",
        "bot": "ca786bad.5ac7a8",
        "haserroroutput": false,
        "outputs": 1,
        "x": 670,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "a492b93f.a1b348",
        "type": "function",
        "z": "86d9b15ce96130b5",
        "d": true,
        "name": "message",
        "func": "var thatIP = msg.payload.ip;\n\nvar storedIP = context.get('ip') || 0;\nif (storedIP !== thatIP) {\n    context.set(\"ip\", thatIP);\n    msg.payload = \"http://\" + thatIP + \":1880/ui\";\n}\nelse {\n    return null;\n}\nif (thatIP === undefined) {\n    return null;\n}\n\n\nvar content = msg.topic + \" :\" + msg.payload;\nvar TelegramChatIds = global.get(\"TelegramChatIds\");\nvar ObjectPayload = {\n    \"chatId\": TelegramChatIds,\n    \"type\": \"message\",\n    \"content\": content\n}\nmsg.payload = ObjectPayload;\n\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 460,
        "wires": [
            [
                "9a81fe6e.7b3c3"
            ]
        ]
    },
    {
        "id": "http",
        "type": "http request",
        "z": "1",
        "name": "Upload to ESP8266",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "192.168.1.140/edit",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 890,
        "y": 140,
        "wires": [
            [
                "727585544c47c9cb"
            ]
        ]
    },
    {
        "id": "debug",
        "type": "debug",
        "z": "1",
        "name": "ESP Response",
        "active": true,
        "tosidebar": true,
        "x": 1280,
        "y": 140,
        "wires": []
    },
    {
        "id": "8528f12ac61ae5c2",
        "type": "inject",
        "z": "1",
        "name": "Send wav",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "1",
        "topic": "",
        "x": 160,
        "y": 120,
        "wires": [
            [
                "70f524363819ab2f"
            ]
        ]
    },
    {
        "id": "70f524363819ab2f",
        "type": "file in",
        "z": "1",
        "name": "Read audio.wav",
        "filename": "/data/adds/audio.wav",
        "filenameType": "str",
        "format": "",
        "chunk": false,
        "sendError": false,
        "allProps": false,
        "x": 360,
        "y": 120,
        "wires": [
            [
                "68a1c66113a63293"
            ]
        ]
    },
    {
        "id": "727585544c47c9cb",
        "type": "http request",
        "z": "1",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "192.168.1.140/play?filename=audio.wav",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1090,
        "y": 140,
        "wires": [
            [
                "debug"
            ]
        ]
    },
    {
        "id": "68a1c66113a63293",
        "type": "function",
        "z": "1",
        "name": "function 5",
        "func": "const boundary = \"----NodeBoundary\";\nconst fileName = \"audio.wav\";\n\n// Convert preamble and postamble to Buffers\nconst preamble = Buffer.from(\n  `--${boundary}\\r\\n` +\n  `Content-Disposition: form-data; name=\"file\"; filename=\"${fileName}\"\\r\\n` +\n  `Content-Type: audio/wav\\r\\n\\r\\n`\n);\n\nconst postamble = Buffer.from(`\\r\\n--${boundary}--\\r\\n`);\n\n// Combine all into a single Buffer\nconst parts = Buffer.concat([preamble, msg.payload, postamble]);\n\nmsg.payload = parts;\n\nmsg.headers = {\n  \"Content-Type\": `multipart/form-data; boundary=${boundary}`\n};\nmsg.url = \"192.168.1.140/edit\"\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 140,
        "wires": [
            [
                "http"
            ]
        ]
    },
    {
        "id": "370d5268abb5b849",
        "type": "inject",
        "z": "1",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 200,
        "wires": [
            [
                "2dada6c2e564459d"
            ]
        ]
    },
    {
        "id": "2b0d1d5551b483c6",
        "type": "http request",
        "z": "1",
        "name": "",
        "method": "GET",
        "ret": "bin",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 490,
        "y": 200,
        "wires": [
            [
                "68a1c66113a63293"
            ]
        ]
    },
    {
        "id": "2dada6c2e564459d",
        "type": "function",
        "z": "1",
        "name": "function 3",
        "func": "let text = \"внимание внимание кто-то нажал кнопку у двери\";//\"%D0%BF%D1%80%D0%B8%D0%B2%D0%B5%D1%82&\";\n\nmsg.url = \"http://192.168.1.160:5500/api/tts?voice=espeak%3Aru&text=\"+text+\"&vocoder=high&denoiserStrength=0.03&cache=false\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 200,
        "wires": [
            [
                "2b0d1d5551b483c6"
            ]
        ]
    },
    {
        "id": "7cd3bb9d25ee6638",
        "type": "inject",
        "z": "1",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 320,
        "wires": [
            [
                "5828a269d9b44f6a"
            ]
        ]
    },
    {
        "id": "566031d714724c4f",
        "type": "debug",
        "z": "1",
        "name": "ESP Response",
        "active": true,
        "tosidebar": true,
        "x": 580,
        "y": 320,
        "wires": []
    },
    {
        "id": "5828a269d9b44f6a",
        "type": "http request",
        "z": "1",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "192.168.1.154/play?filename=close-door1.wav",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 390,
        "y": 320,
        "wires": [
            [
                "566031d714724c4f"
            ]
        ]
    }
]